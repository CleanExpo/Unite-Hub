# Orchestrator Agent - Master Coordinator
FROM node:20-alpine

WORKDIR /app

# Install dependencies
COPY package*.json ./
RUN npm ci --only=production

# Copy agent code
COPY src/lib/agents ./src/lib/agents
COPY src/lib/supabase.ts ./src/lib/supabase.ts
COPY src/lib/openrouter.ts ./src/lib/openrouter.ts

# Copy orchestrator entrypoint
COPY docker/agents/entrypoints/orchestrator.mjs ./entrypoint.mjs

# Health check
HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
  CMD node -e "process.exit(0)"

# Run orchestrator
CMD ["node", "entrypoint.mjs"]
