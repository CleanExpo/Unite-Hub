#!/bin/sh

# =============================================================================
# Git Post-Merge Hook
# =============================================================================
# Auto-regenerates TypeScript types after pulling remote changes
# This ensures types stay in sync with database schema migrations
# =============================================================================

# Colors
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo "${BLUE}üîÑ Post-merge hook triggered${NC}"

# Check if package.json changed (dependencies might need reinstall)
CHANGED_FILES="$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)"

if echo "$CHANGED_FILES" | grep --quiet "package.json"; then
  echo "${YELLOW}üì¶ package.json changed - consider running: npm install${NC}"
fi

# Check if migrations changed (schema might have changed)
if echo "$CHANGED_FILES" | grep --quiet "supabase/migrations"; then
  echo "${BLUE}üîÑ Database migrations detected - regenerating types...${NC}"

  # Regenerate types
  if npm run types:generate; then
    echo "${GREEN}‚úÖ Types regenerated successfully${NC}"
  else
    echo "${YELLOW}‚ö†Ô∏è  Type generation failed - run manually: npm run types:generate${NC}"
  fi
else
  echo "${GREEN}‚úÖ No migrations changed - skipping type generation${NC}"
fi

echo "${GREEN}‚úÖ Post-merge hook complete${NC}"
