# Unite-Hub Evolution Specification v2.0

**Created**: January 23, 2026
**Priority**: HIGHEST
**Status**: PLANNING
**Goal**: Transform Unite-Hub into the founder's unified SaaS command center with all Anthropic 2025-2026 developer capabilities

---

## Executive Summary

This specification defines the next evolution of Unite-Hub - integrating cutting-edge Anthropic developer tools and Brave Search to create a unified CRM capable of managing multiple SaaS projects and businesses from a single platform.

---

## Part 1: Brave Search Integration

### 1.1 Installation

```bash
pnpm add brave-search
```

**API Key**: `BSAgY199EVij0Mzt5vfKp4VwnTWxy46`

### 1.2 Implementation

**Location**: `src/lib/integrations/brave-search.ts`

```typescript
import { BraveSearch } from "brave-search";

const BRAVE_API_KEY = process.env.BRAVE_API_KEY;
const braveSearch = new BraveSearch(BRAVE_API_KEY);

// Web Search
const webResults = await braveSearch.webSearch(query, {
  count: 10,
  safesearch: "moderate",
  search_lang: "en",
  country: "AU"
});

// News Search
const newsResults = await braveSearch.newsSearch(query);

// Image Search
const imageResults = await braveSearch.imageSearch(query);

// Local POI Search
const localResults = await braveSearch.localPoiSearch(query, { lat, lng });

// AI Summary (polling for completion)
const summary = await braveSearch.getSummary(query);
```

### 1.3 Brave Search MCP Server (Optional)

```bash
pnpm add @brave/brave-search-mcp-server
```

**Tools Available**:
- `brave_web_search` - Comprehensive web searches
- `brave_local_search` - Local business/POI searches
- `brave_news_search` - News searches
- `brave_image_search` - Image searches
- `brave_video_search` - Video searches
- AI-powered summarization

### 1.4 Use Cases for Unite-Hub

| Feature | Use Case |
|---------|----------|
| **SEO Intelligence** | Real-time competitor SERP analysis |
| **Lead Research** | Company/contact background research |
| **Content Research** | Topic research for content generation |
| **Market Radar** | Industry news monitoring |
| **Local SEO** | Local business competitive analysis |

---

## Part 2: Anthropic Developer Features (Jul 2025 - Jan 2026)

### 2.1 Model Updates

| Model | ID | Released | Key Capabilities |
|-------|-----|----------|------------------|
| **Claude Opus 4.5** | `claude-opus-4-5-20251101` | Nov 2025 | Flagship intelligence, effort parameter, computer use excellence |
| **Claude Sonnet 4.5** | `claude-sonnet-4-5-20250929` | Sep 2025 | Best coding model, 1M token context, agent capabilities |
| **Claude Haiku 4.5** | `claude-haiku-4-5-20251001` | Oct 2025 | Speed optimization, structured outputs |
| **Claude Opus 4.1** | `claude-opus-4-1-20250805` | Aug 2025 | Extended thinking, interleaved thinking |
| **Claude Opus 4** | `claude-opus-4-20250514` | May 2025 | Tool use, complex reasoning |

### 2.2 Pricing (Current as of Jan 2026)

| Model | Input | Output | Cache Hits |
|-------|-------|--------|------------|
| Opus 4.5 | $5/MTok | $25/MTok | $0.50/MTok |
| Sonnet 4.5 | $3/MTok | $15/MTok | $0.30/MTok |
| Haiku 4.5 | $1/MTok | $5/MTok | $0.10/MTok |

### 2.3 New API Features to Integrate

#### A. Extended Thinking (CRITICAL)

**Status**: Already partially implemented
**Enhancement**: Add interleaved thinking for tool use

```typescript
const response = await client.messages.create({
  model: "claude-opus-4-5-20251101",
  max_tokens: 16000,
  thinking: {
    type: "enabled",
    budget_tokens: 10000  // Can go up to context window with interleaved
  },
  messages: [{ role: "user", content: prompt }]
});
```

**Beta Header for Interleaved**: `interleaved-thinking-2025-05-14`

#### B. Prompt Caching (CRITICAL - Cost Savings)

**5-minute TTL** (default) or **1-hour TTL** (extended)

```typescript
system: [
  {
    type: "text",
    text: "System instructions...",
    cache_control: { type: "ephemeral" }  // 5-minute
  },
  {
    type: "text",
    text: largeContext,
    cache_control: { type: "ephemeral", ttl: "1h" }  // 1-hour
  }
]
```

**Cost Impact**:
- Cache writes: 1.25x base (5m) or 2x base (1h)
- Cache hits: 0.1x base (90% savings!)

#### C. MCP Connector (NEW - May 2025)

Connect to remote MCP servers directly from Messages API:

```typescript
const response = await client.messages.create({
  model: "claude-sonnet-4-5",
  max_tokens: 4096,
  tools: [],
  mcp_servers: {
    "brave-search": {
      url: "https://mcp.brave.com",
      api_key: process.env.BRAVE_API_KEY
    }
  },
  messages: [{ role: "user", content: "Search for..." }]
});
```

#### D. Code Execution Tool (NEW - May 2025)

Sandboxed Python execution:

```typescript
tools: [
  {
    type: "code_execution",
    name: "python_sandbox"
  }
]
```

#### E. Files API (NEW - May 2025)

Upload once, reference across sessions:

```typescript
// Upload
const file = await client.files.create({
  file: fs.createReadStream("document.pdf"),
  purpose: "assistants"
});

// Reference in messages
messages: [{
  role: "user",
  content: [
    { type: "file", file_id: file.id },
    { type: "text", text: "Analyze this document" }
  ]
}]
```

#### F. Tool Search & Programmatic Tool Calling (NEW - Nov 2025)

For large tool libraries (like MCP with 1000+ tools):

```typescript
tools: [
  {
    type: "tool_search",
    name: "search_tools",
    tool_library: registeredTools  // Array of tool definitions
  }
]
```

#### G. Effort Parameter (NEW - Nov 2025, Opus 4.5 only)

Control thoroughness vs speed:

```typescript
const response = await client.messages.create({
  model: "claude-opus-4-5-20251101",
  effort: "high",  // "low" | "medium" | "high"
  // ...
});
```

#### H. Structured Outputs with Strict Mode

Guaranteed schema conformance:

```typescript
tools: [{
  name: "extract_data",
  description: "Extract structured data",
  input_schema: { /* JSON Schema */ },
  strict: true  // Guarantees exact schema match
}]
```

#### I. Server-Side Tools

**Web Search Tool** (`web_search_20250305`):
```typescript
tools: [{
  type: "web_search_20250305",
  name: "web_search",
  max_uses: 5
}]
```

**Web Fetch Tool** (for URL content extraction)

### 2.4 Model Context Protocol (MCP) Updates

**December 2025**: MCP donated to Agentic AI Foundation (Linux Foundation)

**Key Updates**:
- 10,000+ active public MCP servers
- Desktop Extensions (one-click `.mcpb` installation)
- Connector Directory with 75+ integrations
- Tool Search for dynamic discovery

**Unite-Hub MCP Servers** (existing):
- Database Server (port 3102)
- Filesystem Server
- Git Server
- Process Server
- Gateway Server

---

## Part 3: Unified SaaS Command Center Vision

### 3.1 Core Concept

Unite-Hub becomes the **single pane of glass** for managing:
- Multiple GitHub repositories
- Multiple SaaS products
- Multiple business entities
- All marketing & sales activities

### 3.2 GitHub Repository Integration

**New Feature**: `src/app/founder/repos/`

| Component | Purpose |
|-----------|---------|
| **Repo Dashboard** | Overview of all connected repos |
| **Issue Tracker** | Cross-repo issue aggregation |
| **PR Monitor** | Pull request status across repos |
| **Deploy Status** | Deployment health per repo |
| **Code Intelligence** | AI analysis of codebases |

**Database Tables**:
```sql
CREATE TABLE founder_github_repos (
  id UUID PRIMARY KEY,
  workspace_id UUID NOT NULL REFERENCES workspaces(id),
  repo_url TEXT NOT NULL,
  repo_name TEXT NOT NULL,
  repo_owner TEXT NOT NULL,
  access_token_encrypted TEXT,
  sync_status TEXT DEFAULT 'pending',
  last_sync_at TIMESTAMP,
  metadata JSONB DEFAULT '{}',
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE founder_repo_metrics (
  id UUID PRIMARY KEY,
  repo_id UUID REFERENCES founder_github_repos(id),
  metric_date DATE NOT NULL,
  commits_count INTEGER DEFAULT 0,
  prs_open INTEGER DEFAULT 0,
  prs_merged INTEGER DEFAULT 0,
  issues_open INTEGER DEFAULT 0,
  issues_closed INTEGER DEFAULT 0,
  contributors_active INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### 3.3 Multi-Business Management

**Founder OS Enhancement**: `src/app/founder/businesses/`

| Component | Purpose |
|-----------|---------|
| **Business Registry** | All SaaS products & businesses |
| **Revenue Dashboard** | Cross-business revenue tracking |
| **Customer Insights** | Unified customer view |
| **Resource Allocation** | Time/budget across projects |

### 3.4 AI Agent Enhancements

**New Agents**:

| Agent | Purpose | Model |
|-------|---------|-------|
| **Repo Intelligence Agent** | Codebase analysis, issue triage | Opus 4.5 |
| **Cross-Project Coordinator** | Multi-repo task orchestration | Sonnet 4.5 |
| **Business Health Monitor** | Revenue/growth anomaly detection | Haiku 4.5 |
| **Research Agent** | Brave Search powered research | Sonnet 4.5 |

---

## Part 4: Implementation Phases

### Phase 1: Foundation (Week 1-2)

- [ ] Install `brave-search` package
- [ ] Create `src/lib/integrations/brave-search.ts`
- [ ] Add environment variable `BRAVE_API_KEY`
- [ ] Update Anthropic client with new features
- [ ] Implement prompt caching across existing agents
- [ ] Add 1-hour cache TTL for long-running agents

### Phase 2: Search Integration (Week 3-4)

- [ ] Create `/api/search/web` endpoint
- [ ] Create `/api/search/news` endpoint
- [ ] Create `/api/search/local` endpoint
- [ ] Integrate with SEO Leak agent
- [ ] Integrate with Pre-Client agent
- [ ] Add search UI components

### Phase 3: Repository Management (Week 5-6)

- [ ] Create `founder_github_repos` table
- [ ] Create `founder_repo_metrics` table
- [ ] Build GitHub OAuth flow
- [ ] Create Repo Dashboard page
- [ ] Build Repo Intelligence Agent
- [ ] Add webhook handlers for GitHub events

### Phase 4: Multi-Business Features (Week 7-8)

- [ ] Enhance Founder OS with business registry
- [ ] Build cross-business analytics
- [ ] Create unified customer view
- [ ] Build resource allocation tools
- [ ] Integrate with existing Cognitive Twin

### Phase 5: Advanced AI Features (Week 9-10)

- [ ] Implement MCP Connector for remote tools
- [ ] Add Code Execution tool for data analysis
- [ ] Implement Files API for document management
- [ ] Add Tool Search for dynamic tool discovery
- [ ] Implement effort parameter for Opus 4.5

---

## Part 5: File Changes Summary

### New Files

| File | Purpose |
|------|---------|
| `src/lib/integrations/brave-search.ts` | Brave Search client |
| `src/lib/anthropic/features/prompt-cache.ts` | Prompt caching utilities |
| `src/lib/anthropic/features/extended-thinking.ts` | Extended thinking helpers |
| `src/lib/anthropic/features/mcp-connector.ts` | MCP connector utilities |
| `src/app/api/search/web/route.ts` | Web search API |
| `src/app/api/search/news/route.ts` | News search API |
| `src/app/founder/repos/page.tsx` | Repo dashboard |
| `src/app/founder/businesses/page.tsx` | Business registry |
| `src/lib/agents/repo-intelligence.ts` | Repo analysis agent |
| `src/lib/agents/research-agent.ts` | Search-powered research |
| `supabase/migrations/XXX_github_repos.sql` | GitHub repos schema |

### Modified Files

| File | Changes |
|------|---------|
| `src/lib/anthropic/client.ts` | Add caching, effort param |
| `src/lib/agents/seo-leak/` | Integrate Brave Search |
| `src/lib/agents/pre-client/` | Add research capabilities |
| `CLAUDE.md` | Reference this spec |
| `.env.example` | Add `BRAVE_API_KEY` |

---

## Part 6: Environment Variables

```env
# Brave Search (NEW)
BRAVE_API_KEY=BSAgY199EVij0Mzt5vfKp4VwnTWxy46

# Anthropic (existing, verify models)
ANTHROPIC_API_KEY=your_key
ANTHROPIC_MODEL_OPUS=claude-opus-4-5-20251101
ANTHROPIC_MODEL_SONNET=claude-sonnet-4-5-20250929
ANTHROPIC_MODEL_HAIKU=claude-haiku-4-5-20251001

# GitHub Integration (NEW)
GITHUB_CLIENT_ID=your_client_id
GITHUB_CLIENT_SECRET=your_client_secret
```

---

## Part 7: Success Metrics

| Metric | Target |
|--------|--------|
| API cost reduction (caching) | 50%+ |
| Research query latency | <3s |
| Agent task completion | >95% |
| Cross-repo visibility | 100% |
| Business health coverage | All entities |

---

## Part 8: Dependencies

```json
{
  "dependencies": {
    "brave-search": "^0.9.0",
    "@anthropic-ai/sdk": "latest"
  }
}
```

---

## Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **GitHub Integration** | GitHub App | Production-ready, org-level access, webhooks |
| **Brave Search Tier** | Free ($0) | 2,000 queries/month for development, upgrade later |
| **Spec Location** | `.claude/plans/` | Keep with planning docs |
| **Pilot Repos** | All repos | Full integration from start |

## Remaining Questions

1. **Multi-tenant repos**: How do we handle repos that span multiple workspaces?

2. **MCP server hosting**: Should we host our own Brave MCP server or use Anthropic's connector?

3. **Effort parameter scope**: Which agents should use "high" effort (more thorough, slower)?

---

## References

- [Brave Search API](https://brave.com/search/api/)
- [Anthropic Developer Platform](https://platform.claude.com/docs)
- [MCP Documentation](https://modelcontextprotocol.io)
- [Agentic AI Foundation](https://www.anthropic.com/news/donating-the-model-context-protocol-and-establishing-of-the-agentic-ai-foundation)
- [Claude Opus 4.5 Announcement](https://www.anthropic.com/news/claude-opus-4-5)
- [Advanced Tool Use](https://www.anthropic.com/engineering/advanced-tool-use)
