
> unite-hub@1.0.0 test
> vitest run


[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mD:/Unite-Hub[39m

[baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [32mâœ“[39m tests/integration/cognitive-twin.test.ts [2m ([22m[2m31 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32mâœ“[39m tests/integration/seo-leak.test.ts [2m ([22m[2m32 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32mâœ“[39m tests/integration/ai-phill.test.ts [2m ([22m[2m28 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32mâœ“[39m tests/integration/orchestrator-routing.test.ts [2m ([22m[2m39 tests[22m[2m)[22m[90m 11[2mms[22m[39m
 [32mâœ“[39m tests/integration/synthex-platform.test.ts [2m ([22m[2m46 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32mâœ“[39m src/lib/__tests__/billing.test.ts [2m ([22m[2m31 tests[22m[2m)[22m[90m 10[2mms[22m[39m
 [32mâœ“[39m tests/integration/multi-channel.test.ts [2m ([22m[2m42 tests[22m[2m)[22m[90m 15[2mms[22m[39m
 [32mâœ“[39m tests/integration/framework-alerts.test.ts [2m ([22m[2m57 tests[22m[2m)[22m[90m 14[2mms[22m[39m
 [32mâœ“[39m src/lib/__tests__/financial-reporting.test.ts [2m ([22m[2m40 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/deltaEngine.test.ts [2m ([22m[2m26 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 30[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/deltaEngine.test.ts[2m > [22mDeltaEngine - Edge Cases[2m > [22mshould handle zero values without division errors[39m
[31m     â†’ expected 'STABLE' to be 'IMPROVING' // Object.is equality[39m
 [33mâ¯[39m src/lib/__tests__/guardrailPolicyService.test.ts [2m ([22m[2m19 tests[22m [2m|[22m [31m19 failed[39m[2m)[22m[90m 29[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould return ALLOW when no rules match[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould apply BLOCK action when rule conditions match[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould apply REQUIRE_QUORUM action with quorum size[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould collect coaching hints from COACHING rules[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould apply more restrictive action between multiple rules[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould set sandboxOnly when in sandbox mode[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould match operator_score < threshold[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould not match when operator_score >= threshold[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould match domain condition[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould not match when domain differs[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould simulate EMAIL_SEND execution[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould fail EMAIL_SEND simulation when missing fields[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould simulate CONTENT_PUBLISH with warnings[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould simulate DATA_UPDATE execution[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCoaching Hints[2m > [22mshould record coaching hints when shown[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCoaching Hints[2m > [22mshould record hint feedback[39m
[31m     â†’ promise rejected "TypeError: supabase.from is not a function" instead of resolving[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox History[2m > [22mshould fetch sandbox history for organization[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox History[2m > [22mshould filter history by operator[39m
[31m     â†’ supabase.from is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mRule Precedence[2m > [22mshould skip inactive rules[39m
[31m     â†’ supabase.from is not a function[39m
 [32mâœ“[39m src/lib/__tests__/backlinkEngine.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[90m 21[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/stp-compliance-service.test.ts [2m ([22m[2m39 tests[22m[2m)[22m[90m 21[2mms[22m[39m
 [33mâ¯[39m tests/integration/stp-compliance.test.ts [2m ([22m[2m16 tests[22m [2m|[22m [31m9 failed[39m[2m)[22m[90m 122[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mEmployee Management[2m > [22mshould get employee by ID[39m
[31m     â†’ supabase.from(...).select(...).eq(...).eq(...).single is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould create pay run with automatic calculations[39m
[31m     â†’ supabase.from(...).insert is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould finalize pay run[39m
[31m     â†’ supabase.from(...).update is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould calculate PAYG correctly for weekly pay[39m
[31m     â†’ supabase.from(...).insert is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould calculate super guarantee correctly[39m
[31m     â†’ supabase.from(...).insert is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mYTD Tracking[2m > [22mshould update YTD summary after pay run[39m
[31m     â†’ supabase.from(...).select(...).eq(...).eq(...).eq is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mSTP Submissions[2m > [22mshould create STP submission[39m
[31m     â†’ supabase.from(...).insert is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mFinancial Year Boundaries[2m > [22mshould handle pay runs across FY boundary[39m
[31m     â†’ supabase.from(...).insert is not a function[39m
[31m   [33mâ¯[31m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mWorkspace Isolation[2m > [22mshould filter employees by workspace[39m
[31m     â†’ supabase.from(...).select(...).eq(...).eq(...).order is not a function[39m
 [33mâ¯[39m src/lib/__tests__/timeService.test.ts [2m ([22m[2m36 tests[22m [2m|[22m [31m9 failed[39m[2m)[22m[90m 60[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould return entries with totals[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by status[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by date range[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by project[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by staff[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeSummary[2m > [22mshould calculate today totals[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeSummary[2m > [22mshould calculate week totals[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeSummary[2m > [22mshould calculate month totals[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetPendingApprovals[2m > [22mshould return pending entries[39m
[31m     â†’ expected false to be true // Object.is equality[39m
 [32mâœ“[39m tests/unit/extended-thinking-engine.test.ts [2m ([22m[2m53 tests[22m[2m)[22m[90m 43[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [33mâ¯[39m tests/integration/framework-templates.test.ts [2m ([22m[2m44 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 29[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/framework-templates.test.ts[2m > [22mFramework Template Library[2m > [22mTemplate Rating[2m > [22mshould validate rating range (1-5)[39m
[31m     â†’ expected true to be false // Object.is equality[39m
 [33mâ¯[39m src/lib/__tests__/trustModeService.test.ts [2m ([22m[2m20 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[90m 35[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22mrevokeTrustedMode[2m > [22mshould set status to REVOKED[39m
[31m     â†’ Trusted mode request not found[39m
[31m   [33mâ¯[31m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould allow change within scope[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould reject if Trusted Mode not active[39m
[31m     â†’ expected true to be false // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould reject if risk level exceeds maximum[39m
[31m     â†’ expected 'Trusted Mode is not active for this câ€¦' to contain 'exceeds maximum'[39m
[31m   [33mâ¯[31m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould reject forbidden change types[39m
[31m     â†’ expected 'Risk level HIGH exceeds maximum allowâ€¦' to contain 'forbidden'[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [33mâ¯[39m tests/integration/framework-insights.test.ts [2m ([22m[2m54 tests[22m [2m|[22m [31m8 failed[39m[2m)[22m[90m 26[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight Generation[2m > [22mshould forecast trends accurately[39m
[31m     â†’ expected undefined not to be undefined[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight Generation[2m > [22mshould identify optimization opportunities[39m
[31m     â†’ expected undefined not to be undefined[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight Metrics & Data[2m > [22mshould include related data context[39m
[31m     â†’ expected undefined not to be undefined[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mRecommendation Generation[2m > [22mshould include action items[39m
[31m     â†’ expected undefined not to be undefined[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mRecommendation Generation[2m > [22mshould define success metrics[39m
[31m     â†’ expected undefined not to be undefined[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight & Recommendation Linking[2m > [22mshould link insights to recommendations[39m
[31m     â†’ expected undefined not to be undefined[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight & Recommendation Linking[2m > [22mshould reference related insights[39m
[31m     â†’ expected undefined to be an instance of Array[39m
[31m   [33mâ¯[31m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight & Recommendation Linking[2m > [22mshould maintain referential integrity[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
 [32mâœ“[39m tests/unit/lib/sales-order-calculations.test.ts [2m ([22m[2m42 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/financial-tracking-engine.test.ts [2m ([22m[2m60 tests[22m[2m)[22m[90m 33[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/xeroSync.test.ts [2m ([22m[2m20 tests[22m [2m|[22m [31m7 failed[39m[2m)[22m[90m 37[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Line Items Preparation[2m > [22mshould prepare line items from time entries[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Line Items Preparation[2m > [22mshould handle no approved entries found[39m
[31m     â†’ expected 'supabase.from(...).select(...).in(...â€¦' to be 'No approved, unsynced entries found' // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Line Items Preparation[2m > [22mshould handle database errors[39m
[31m     â†’ expected 'supabase.from(...).select(...).in(...â€¦' to be 'Database error' // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Sync Operation (Stub)[2m > [22mshould simulate successful sync[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Sync Operation (Stub)[2m > [22mshould handle sync of multiple entries[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Edge Cases[2m > [22mshould handle entries without hourly rate[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Edge Cases[2m > [22mshould only sync approved entries[39m
[31m     â†’ expected 'supabase.from(...).select(...).in(...â€¦' to be 'No approved, unsynced entries found' // Object.is equality[39m
 [33mâ¯[39m src/lib/__tests__/operatorInsightsService.test.ts [2m ([22m[2m22 tests[22m [2m|[22m [31m7 failed[39m[2m)[22m[90m 37[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mOutcome Recording[2m > [22mshould update outcome and trigger score recalculation[39m
[31m     â†’ promise rejected "TypeError: supabase.from(...).select(...)â€¦" instead of resolving[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mOutcome Recording[2m > [22mshould log DECISION_OVERTURNED event for overturned outcomes[39m
[31m     â†’ supabase.from(...).select(...).eq(...).single is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mDecay-Weighted Scoring[2m > [22mshould create default scores for operators with no history[39m
[31m     â†’ expected undefined to be +0 // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould detect APPROVAL_BIAS when approval rate exceeds 85%[39m
[31m     â†’ Failed to update bias signal: undefined[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould detect REJECTION_BIAS when rejection rate exceeds 85%[39m
[31m     â†’ Failed to update bias signal: undefined[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould detect SPEED_BIAS when avg review time under 30 seconds[39m
[31m     â†’ Failed to update bias signal: undefined[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould not detect biases with insufficient review history[39m
[31m     â†’ expected [ Array(2) ] to have a length of +0 but got 2[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [33mâ¯[39m tests/unit/lib/email-ingestion/emailIdeaExtractor.test.ts [2m ([22m[2m14 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 86[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/lib/email-ingestion/emailIdeaExtractor.test.ts[2m > [22mEmailIdeaExtractor[2m > [22mextractIdeas[2m > [22mshould include processing time in result[39m
[31m     â†’ expected 0 to be greater than 0[39m
 [33mâ¯[39m src/lib/__tests__/strategySimulation.test.ts [2m ([22m[2m26 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[90m 43[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySimulation.test.ts[2m > [22mStrategySimulationService[2m > [22mSimulation Results[2m > [22mshould get simulations list for organization[39m
[31m     â†’ expected [] to have a length of 2 but got +0[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySimulation.test.ts[2m > [22mStrategySimulationService[2m > [22mSimulation Results[2m > [22mshould filter simulations by status[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

 [33mâ¯[39m src/lib/__tests__/strategyGraph.test.ts [2m ([22m[2m24 tests[22m [2m|[22m [31m6 failed[39m[2m)[22m[90m 46[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould get full graph for organization[39m
[31m     â†’ supabase.from(...).select(...).eq(...).order is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould get dependencies of a node[39m
[31m     â†’ supabase.from(...).select(...).eq(...).eq is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould get dependents of a node[39m
[31m     â†’ supabase.from(...).select(...).eq(...).eq is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould return empty array when no dependencies[39m
[31m     â†’ supabase.from(...).select(...).eq(...).eq is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyPlannerService[2m > [22mProposal Management[2m > [22mshould get proposals for organization[39m
[31m     â†’ expected [ { id: 'n1', â€¦(12) }, â€¦(1) ] to have a length of 1 but got 2[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyPlannerService[2m > [22mProposal Management[2m > [22mshould filter proposals by status[39m
[31m     â†’ query.eq is not a function[39m
 [32mâœ“[39m tests/integration/founder-os.test.ts [2m ([22m[2m28 tests[22m[2m)[22m[90m 24[2mms[22m[39m
 [33mâ¯[39m tests/integration/autonomy-lifecycle.test.ts [2m ([22m[2m15 tests[22m [2m|[22m [31m15 failed[39m[2m)[22m[90m 34[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould complete full lifecycle for LOW risk proposal[39m
[31m     â†’ Cannot read properties of undefined (reading 'restore_email')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould require manual approval for HIGH risk proposal[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould reject forbidden change types[39m
[31m     â†’ expected [Function] to throw error including 'Validation failed' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould enforce rollback deadline[39m
[31m     â†’ expected [Function] to throw error including 'Rollback deadline has passed' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould prevent duplicate rollbacks[39m
[31m     â†’ expected [Function] to throw error including 'already been rolled back' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mTrust Mode Status Enforcement[2m > [22mshould reject proposals when trust mode is not ACTIVE[39m
[31m     â†’ expected [Function] to throw error including 'Trusted mode not active' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mTrust Mode Status Enforcement[2m > [22mshould reject execution when trust mode is suspended[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould allow SEO meta_update changes[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould reject ADS budget_increase changes[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould reject CONTENT mass_content_delete changes[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould reject CRO variant_mass_delete changes[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mExecution Limits[2m > [22mshould enforce daily execution limit[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mRollback Type Selection[2m > [22mshould select SOFT_UNDO for recent LOW risk[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mRollback Type Selection[2m > [22mshould select HARD_UNDO for older executions[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
[31m   [33mâ¯[31m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mAudit Trail[2m > [22mshould log proposal creation[39m
[31m     â†’ Cannot read properties of undefined (reading 'from')[39m
 [32mâœ“[39m tests/integration/framework-versioning.test.ts [2m ([22m[2m56 tests[22m[2m)[22m[90m 16[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/email/email-service.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[33m 359[2mms[22m[39m
 [32mâœ“[39m src/lib/__tests__/enterprise-integration.test.ts [2m ([22m[2m32 tests[22m[2m)[22m[90m 37[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/consensusService.test.ts [2m ([22m[2m24 tests[22m [2m|[22m [31m19 failed[39m[2m)[22m[90m 56[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould assign weight 10 to OWNER votes[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould assign weight 2 to MANAGER votes[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould throw error for ANALYST vote attempts[39m
[31m     â†’ expected [Function] to throw error matching /Analysts can/ but got 'Queue item not found'[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould assign weight 100 for OWNER override[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould reject MANAGER override attempts[39m
[31m     â†’ expected [Function] to throw error matching /owners|override/i but got 'Queue item not found'[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould require min 1 vote and weight 2 for LOW_RISK[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould require min 2 votes and weight 4 for MEDIUM_RISK[39m
[31m     â†’ expected undefined to be 'PENDING' // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould meet MEDIUM_RISK quorum with 2 MANAGER votes[39m
[31m     â†’ expected undefined to be 4 // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould require min 2 votes and weight 6 for HIGH_RISK[39m
[31m     â†’ expected true to be false // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould meet HIGH_RISK quorum with OWNER vote[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould approve when all votes are APPROVE[39m
[31m     â†’ expected undefined to be 'APPROVED' // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould reject when reject weight exceeds approve weight[39m
[31m     â†’ expected undefined to be 'REJECTED' // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould return PENDING when no votes cast[39m
[31m     â†’ expected undefined to be 'PENDING' // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould handle DEFER votes as neutral[39m
[31m     â†’ expected undefined to be 1 // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould handle ABSTAIN votes[39m
[31m     â†’ expected undefined to be 1 // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould detect CONFLICTING_VOTES between managers[39m
[31m     â†’ supabase.from(...).select(...).eq(...).order is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould detect EXPIRED_REVIEW for old pending items[39m
[31m     â†’ supabase.from(...).select(...).eq(...).order is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould not flag EXPIRED_REVIEW for recent items[39m
[31m     â†’ supabase.from(...).select(...).eq(...).order is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould detect QUORUM_DEADLOCK with equal weights[39m
[31m     â†’ supabase.from(...).select(...).eq(...).order is not a function[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/integration/framework-analytics.test.ts [2m ([22m[2m54 tests[22m[2m)[22m[90m 25[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m src/lib/__tests__/enterpriseTeams.test.ts [2m ([22m[2m24 tests[22m[2m)[22m[90m 21[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/reports-calculations.test.ts [2m ([22m[2m30 tests[22m[2m)[22m[90m 35[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/leviathan.test.ts [2m ([22m[2m43 tests[22m [2m|[22m [31m11 failed[39m[2m)[22m[90m 33[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould generate valid JSON-LD schema[39m
[31m     â†’ fabricator.generateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould map entity types correctly[39m
[31m     â†’ Cannot read properties of undefined (reading 'call')[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould include @id for canonical URL[39m
[31m     â†’ fabricator.generateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould add type-specific properties for organization[39m
[31m     â†’ fabricator.generateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould validate complete schema[39m
[31m     â†’ fabricator.validateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould detect missing @context[39m
[31m     â†’ fabricator.validateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould detect missing name[39m
[31m     â†’ fabricator.validateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould detect invalid URL[39m
[31m     â†’ fabricator.validateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould validate sameAs URLs[39m
[31m     â†’ fabricator.validateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mHTML Generation[2m > [22mshould generate HTML with title[39m
[31m     â†’ fabricator.generateSchema is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mHTML Generation[2m > [22mshould escape HTML entities[39m
[31m     â†’ fabricator.escapeHtml is not a function[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/integration/synthex-experiments.test.ts [2m ([22m[2m27 tests[22m[2m)[22m[90m 20[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/unit/lib/dashboard-calculations.test.ts [2m ([22m[2m26 tests[22m[2m)[22m[90m 17[2mms[22m[39m
 [32mâœ“[39m tests/unit/cost-optimization.test.ts [2m ([22m[2m42 tests[22m[2m)[22m[90m 23[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [32mâœ“[39m src/lib/__tests__/enterpriseFoundation.test.ts [2m ([22m[2m25 tests[22m[2m)[22m[90m 20[2mms[22m[39m
 [32mâœ“[39m tests/integration/framework-alert-analytics.test.ts [2m ([22m[2m52 tests[22m[2m)[22m[90m 21[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/rollbackEngine.test.ts [2m ([22m[2m15 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 27[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/rollbackEngine.test.ts[2m > [22mRollbackEngine[2m > [22mreverse diff generation[2m > [22mshould correctly reverse old_value/new_value pairs[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'Reverse diff:', â€¦(1) ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   "Reverse diff:",[90m
[32m-   StringContaining "Original Title",[90m
[31m+   "Applying soft undo for proposal proposal-uuid",[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  Array [[22m
[2m    "Reverse diff:",[22m
[32m-   StringContaining "Original Title",[90m
[31m+   "{[90m
[31m+   \"old_value\": \"New Title\",[90m
[31m+   \"new_value\": \"New Title\"[90m
[31m+ }",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m2[22m
[31m[39m
 [33mâ¯[39m src/lib/__tests__/strategyRefinement.test.ts [2m ([22m[2m42 tests[22m [2m|[22m [31m35 failed[39m[2m)[22m[90m 70[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mstartRefinementCycle[2m > [22mshould create a new refinement cycle[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mstartRefinementCycle[2m > [22mshould increment cycle number[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return A for achievement >= 90%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return B for achievement >= 80%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return C for achievement >= 70%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return D for achievement >= 60%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return F for achievement < 60%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return CRITICAL for drift > 30%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return HIGH for drift > 20%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return MEDIUM for drift > 10%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return LOW for drift <= 10%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould return positive score for over-achievement[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould return negative score for under-achievement[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould cap at -100[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould cap at +100[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mgetDomainDependencies[2m > [22mshould return all dependencies when no domain specified[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mgetDomainDependencies[2m > [22mshould filter dependencies by domain[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mgetDomainDependencies[2m > [22mshould include CONTENT -> SEO dependency[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateEntropy[2m > [22mshould return 1 for perfectly balanced allocation[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateEntropy[2m > [22mshould return 0 for completely unbalanced allocation[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateEntropy[2m > [22mshould return intermediate value for partial balance[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateGini[2m > [22mshould return 0 for perfect equality[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateGini[2m > [22mshould return high value for high inequality[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22midentifyImbalances[2m > [22mshould identify over-optimized domains[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22midentifyImbalances[2m > [22mshould identify under-invested domains[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate positive signal for exceeding target[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate negative signal for under-achievement[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate negative signal for missed deadline[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate signal for resource over-utilization[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateSimulationSignals[2m > [22mshould generate positive signal for high confidence best path[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateSimulationSignals[2m > [22mshould generate negative signal for low confidence[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return STRENGTHEN for strongly positive signals[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return WEAKEN for moderately negative signals[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return PAUSE for strongly negative signals[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return MAINTAIN for neutral signals[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
 [32mâœ“[39m tests/integration/ab-testing/statistical-analysis.test.ts [2m ([22m[2m21 tests[22m[2m)[22m[90m 26[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/market-radar-engine.test.ts [2m ([22m[2m44 tests[22m[2m)[22m[90m 31[2mms[22m[39m
 [32mâœ“[39m src/lib/services/leviathan/__tests__/quad-cloud-engine.test.ts [2m ([22m[2m29 tests[22m[2m)[22m[33m 2092[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [33mâ¯[39m src/lib/__tests__/horizonPlanning.test.ts [2m ([22m[2m29 tests[22m [2m|[22m [31m18 failed[39m[2m)[22m[90m 61[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mcreatePlan[2m > [22mshould create a horizon plan with correct defaults[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mcreatePlan[2m > [22mshould handle custom horizon type with specified days[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 30 days for SHORT horizon[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 60 days for MEDIUM horizon[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 90 days for LONG horizon[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 90 days for QUARTERLY horizon[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mgeneratePlan[2m > [22mshould generate steps for all priority domains[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mresolveDependencies[2m > [22mshould identify critical path[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcreateSnapshot[2m > [22mshould create snapshot with calculated change percent[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcalculateTrend[2m > [22mshould return UP for positive change > 5%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcalculateTrend[2m > [22mshould return DOWN for negative change < -5%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcalculateTrend[2m > [22mshould return STABLE for change between -5% and 5%[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould return all definitions when no domain specified[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould filter definitions by domain[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould include expected SEO metrics[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould include expected CRO metrics[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetDomainSummary[2m > [22mshould calculate overall score and health status[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[31m   [33mâ¯[31m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mprojectKPIs[2m > [22mshould generate projections for specified number of days[39m
[31m     â†’ Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [33mâ¯[39m src/lib/__tests__/proposalEngine.test.ts [2m ([22m[2m20 tests[22m [2m|[22m [31m17 failed[39m[2m)[22m[90m 52[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject when change type is forbidden[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject ADS domain budget changes[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject CRO domain mass deletes[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject CONTENT domain major schema changes[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould validate allowed change types[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould create a proposal with calculated risk level[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould auto-approve LOW risk proposals with ACTIVE trust[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould set PENDING for MEDIUM/HIGH risk with approval[39m
[31m     â†’ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould throw error for invalid change type[39m
[31m     â†’ expected [Function] to throw error including 'Validation failed' but got 'Cannot destructure property \'data\' â€¦'[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould require ACTIVE trusted mode for proposals[39m
[31m     â†’ expected [Function] to throw error including 'Trusted mode not active' but got 'Cannot destructure property \'data\' â€¦'[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mapproveProposal[2m > [22mshould throw error for non-PENDING proposal[39m
[31m     â†’ expected [Function] to throw error including 'Only PENDING proposals can be approved' but got 'Cannot approve proposal in status: APâ€¦'[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mrejectProposal[2m > [22mshould throw error for non-PENDING proposal[39m
[31m     â†’ expected [Function] to throw error including 'Only PENDING proposals can be rejected' but got 'Cannot destructure property \'data\' â€¦'[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mgenerateFromDelta[2m > [22mshould create proposals from delta changes[39m
[31m     â†’ expected [] to have a length of 2 but got +0[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mrisk assessment[2m > [22mshould assess HIGH risk for robots.txt changes[39m
[31m     â†’ Proposal validation failed: undefined autonomy is not enabled[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mrisk assessment[2m > [22mshould assess MEDIUM risk for large diffs[39m
[31m     â†’ Proposal validation failed: undefined autonomy is not enabled[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mgetProposalsByStatus[2m > [22mshould return proposals filtered by status[39m
[31m     â†’ engine.getProposalsByStatus is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mgetProposalsByStatus[2m > [22mshould return empty array on error[39m
[31m     â†’ engine.getProposalsByStatus is not a function[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m src/lib/__tests__/seoCore.test.ts [2m ([22m[2m41 tests[22m[2m)[22m[90m 29[2mms[22m[39m
 [33mâ¯[39m tests/unit/api/media/transcribe.test.ts [2m ([22m[2m10 tests[22m [2m|[22m [31m8 failed[39m[2m)[22m[90m 55[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould successfully transcribe an audio file[39m
[31m     â†’ expected 400 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould reject non-audio/video files[39m
[31m     â†’ expected 500 to be 400 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould handle already transcribed files[39m
[31m     â†’ expected 500 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould handle OpenAI API errors gracefully[39m
[31m     â†’ expected 400 to be 500 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould enforce workspace isolation[39m
[31m     â†’ expected 500 to be 404 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould log to audit trail on success[39m
[31m     â†’ expected 400 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mGET /api/media/transcribe[2m > [22mshould retrieve existing transcription[39m
[31m     â†’ expected 500 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/transcribe.test.ts[2m > [22mGET /api/media/transcribe[2m > [22mshould return 404 if transcription not found[39m
[31m     â†’ expected 500 to be 404 // Object.is equality[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [33mâ¯[39m src/lib/__tests__/operatorRoleService.test.ts [2m ([22m[2m19 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[90m 20[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorRoleService.test.ts[2m > [22mOperatorRoleService[2m > [22mgetApproversForRisk[2m > [22mshould return operators who can approve LOW risk[39m
[31m     â†’ query.eq is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/operatorRoleService.test.ts[2m > [22mOperatorRoleService[2m > [22mgetApproversForRisk[2m > [22mshould filter by HIGH risk permission[39m
[31m     â†’ query.eq is not a function[39m
 [32mâœ“[39m src/lib/__tests__/entityEngine.test.ts [2m ([22m[2m12 tests[22m[2m)[22m[90m 23[2mms[22m[39m
 [32mâœ“[39m tests/integration/market-radar.test.ts [2m ([22m[2m24 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m src/lib/__tests__/mvp-dashboard.test.ts [2m ([22m[2m21 tests[22m[2m)[22m[90m 29[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

 [33mâ¯[39m src/lib/__tests__/projectCreator.test.ts [2m ([22m[2m21 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[90m 44[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/projectCreator.test.ts[2m > [22mprojectCreator[2m > [22mcreateProjectFromProposal[2m > [22mshould create project with correct metadata[39m
[31m     â†’ expected 'Restaurant Management App - Better Paâ€¦' to be 'Restaurant Management App - Better Paâ€¦' // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/projectCreator.test.ts[2m > [22mprojectCreator[2m > [22mTask Generation - With Deliverables[2m > [22mshould set task priorities[39m
[31m     â†’ expected 'high' to be 'medium' // Object.is equality[39m
 [32mâœ“[39m tests/unit/ml-engines.test.ts [2m ([22m[2m30 tests[22m[2m)[22m[90m 29[2mms[22m[39m
 [32mâœ“[39m src/lib/services/leviathan/__tests__/orchestrator.test.ts [2m ([22m[2m42 tests[22m[2m)[22m[90m 47[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [33mâ¯[39m tests/unit/api/media/upload.test.ts [2m ([22m[2m11 tests[22m [2m|[22m [31m8 failed[39m[2m)[22m[90m 124[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould successfully upload a video file[39m
[31m     â†’ expected 500 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould enforce workspace access[39m
[31m     â†’ expected 500 to be 403 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould rollback storage upload on database error[39m
[31m     â†’ expected 'Internal server error' to contain 'database'[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould accept valid tags[39m
[31m     â†’ expected 500 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould list all media files for workspace[39m
[31m     â†’ expected 500 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould filter by file type[39m
[31m     â†’ expected 500 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould require workspace_id parameter[39m
[31m     â†’ expected 500 to be 400 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould require authentication[39m
[31m     â†’ expected 500 to be 401 // Object.is equality[39m
 [33mâ¯[39m tests/integration/ato-integration.test.ts [2m ([22m[2m13 tests[22m [2m|[22m [31m7 failed[39m[2m)[22m[90m 44[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mOAuth2 M2M Authentication Flow[2m > [22mshould fetch access token using client credentials[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m   [33mâ¯[31m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mOAuth2 M2M Authentication Flow[2m > [22mshould include required OAuth2 parameters[39m
[31m     â†’ fetchCall is not iterable[39m
[31m   [33mâ¯[31m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mABN Validation Pipeline[2m > [22mshould cache ABN lookup results[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'abn_lookups' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [33mâ¯[31m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mBAS Lodgement Flow[2m > [22mshould store lodgement record in database[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'bas_lodgements' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [33mâ¯[31m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mTax Obligations Sync[2m > [22mshould sync obligations to database[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'tax_obligations' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [33mâ¯[31m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mConnection Management[2m > [22mshould disconnect gracefully[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'ato_credentials' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [33mâ¯[31m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mError Scenarios[2m > [22mshould handle network errors[39m
[31m     â†’ promise resolved "'mock-token'" instead of rejecting[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [33mâ¯[39m tests/integration/features/workspace-isolation.test.ts [2m ([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [32mâœ“[39m src/lib/__tests__/proposalService.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[90m 19[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/bas-automation-service.test.ts [2m ([22m[2m31 tests[22m[2m)[22m[90m 17[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/executionEngine.test.ts [2m ([22m[2m12 tests[22m [2m|[22m [31m10 failed[39m[2m)[22m[90m 29[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould execute an approved proposal successfully[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould reject non-APPROVED proposals[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould reject when trusted mode is not ACTIVE[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould enforce daily execution limit[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould return proposal not found error[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould calculate correct rollback deadline for LOW risk[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mgetExecutionHistory[2m > [22mshould return execution history with limit[39m
[31m     â†’ supabase.from(...).select(...).eq(...).order(...).limit is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mgetExecutionHistory[2m > [22mshould return empty array on error[39m
[31m     â†’ supabase.from(...).select(...).eq(...).order(...).limit is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22msnapshot handling[2m > [22mshould create before and after snapshots[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
[31m   [33mâ¯[31m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecution window[2m > [22mshould check execution is within allowed time window[39m
[31m     â†’ Cannot read properties of undefined (reading 'status')[39m
 [32mâœ“[39m src/lib/__tests__/signatureProvider.test.ts [2m ([22m[2m16 tests[22m[2m)[22m[90m 26[2mms[22m[39m
 [2m[90mâ†“[39m[22m tests/integration/api/media-pipeline.test.ts [2m ([22m[2m2 tests[22m [2m|[22m [33m2 skipped[39m[2m)[22m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [33mâ¯[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts [2m ([22m[2m22 tests[22m [2m|[22m [31m9 failed[39m[2m)[22m[90m 76[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22mimport_client_emails intent[2m > [22mshould classify email import requests[39m
[31m     â†’ expected 'unknown' to be 'import_client_emails' // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22mimport_client_emails intent[2m > [22mshould classify email sync requests[39m
[31m     â†’ expected 'unknown' to be 'import_client_emails' // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22msummarise_client_ideas intent[2m > [22mshould classify idea summary requests[39m
[31m     â†’ expected 'unknown' to be 'summarise_client_ideas' // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22msummarise_client_ideas intent[2m > [22mshould classify intelligence requests[39m
[31m     â†’ expected 'import_client_emails' to be 'summarise_client_ideas' // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22mimport_client_emails plan[2m > [22mshould generate correct plan for import_client_emails[39m
[31m     â†’ expected 'unknown' to be 'import_client_emails' // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22mimport_client_emails plan[2m > [22mshould have sequential dependencies[39m
[31m     â†’ Cannot read properties of undefined (reading 'dependsOn')[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22msummarise_client_ideas plan[2m > [22mshould generate correct plan for summarise_client_ideas[39m
[31m     â†’ expected 'unknown' to be 'summarise_client_ideas' // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22msummarise_client_ideas plan[2m > [22mshould include clientId in inputs[39m
[31m     â†’ expected { Object (prompt) } to have property "clientId" with value 'contact-789'[39m
[31m   [33mâ¯[31m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22mestimated tokens[2m > [22mshould estimate tokens based on step count[39m
[31m     â†’ expected 2000 to be greater than 6000[39m
 [32mâœ“[39m src/lib/__tests__/braveClient.test.ts [2m ([22m[2m26 tests[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/integration/operator-lifecycle.test.ts [2m ([22m[2m33 tests[22m[2m)[22m[90m 22[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/tenantProvisioner.test.ts [2m ([22m[2m17 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 32[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantProvisioner.test.ts[2m > [22mTenant Provisioner - Provisioning[2m > [22mshould provision tenant successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/unit/lib/connected-apps/tokenVault.test.ts [2m ([22m[2m19 tests[22m [2m|[22m [33m2 skipped[39m[2m)[22m[90m 30[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/scopeService.ai.test.ts [2m ([22m[2m12 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 34[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/scopeService.ai.test.ts[2m > [22mscopeService AI Integration[2m > [22mgenerateAIScope[2m > [22mshould handle malformed responses[39m
[31m     â†’ expected 'Unknown error' to contain 'API error: 400'[39m
 [32mâœ“[39m tests/unit/lib/purchase-order-calculations.test.ts [2m ([22m[2m30 tests[22m[2m)[22m[90m 18[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/inventory-calculations.test.ts [2m ([22m[2m26 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32mâœ“[39m tests/unit/prediction-engines.test.ts [2m ([22m[2m21 tests[22m[2m)[22m[90m 24[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/integration/financial-tracking.test.ts [2m ([22m[2m23 tests[22m[2m)[22m[90m 20[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/synthex-offer-engine.test.ts [2m ([22m[2m41 tests[22m[2m)[22m[90m 22[2mms[22m[39m
 [33mâ¯[39m tests/integration/api/content.test.ts [2m ([22m[2m15 tests[22m [2m|[22m [31m6 failed[39m[2m)[22m[90m 189[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/api/content.test.ts[2m > [22mContent API - GET /api/content[2m > [22mshould return 401 when not authenticated[39m
[31m     â†’ expected 400 to be 401 // Object.is equality[39m
[31m   [33mâ¯[31m tests/integration/api/content.test.ts[2m > [22mContent API - GET /api/content[2m > [22mshould return content list for authenticated user[39m
[31m     â†’ expected 400 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/integration/api/content.test.ts[2m > [22mContent API - GET /api/content[2m > [22mshould filter content by workspace ID[39m
[31m     â†’ expected 400 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/integration/api/content.test.ts[2m > [22mContent API - POST /api/content[2m > [22mshould return 401 when not authenticated[39m
[31m     â†’ expected 400 to be 401 // Object.is equality[39m
[31m   [33mâ¯[31m tests/integration/api/content.test.ts[2m > [22mContent API - POST /api/content[2m > [22mshould create new content when authenticated[39m
[31m     â†’ expected [ 200, 201 ] to include 400[39m
[31m   [33mâ¯[31m tests/integration/api/content.test.ts[2m > [22mContent API - Error Handling[2m > [22mshould handle database errors gracefully[39m
[31m     â†’ expected [ 500, 200 ] to include 400[39m
 [32mâœ“[39m tests/integration/abn-tfn-verification.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[90m 19[2mms[22m[39m
 [32mâœ“[39m tests/integration/api/contacts.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[90m 41[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [33mâ¯[39m src/lib/__tests__/projectService.test.ts [2m ([22m[2m18 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[90m 37[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectsForClient[2m > [22mshould fetch projects successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectsForClient[2m > [22mshould filter by status[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectsForClient[2m > [22mshould respect limit parameter[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectById[2m > [22mshould fetch project details successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22massignStaff[2m > [22mshould validate role[39m
[31m     â†’ expected true to be false // Object.is equality[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m src/lib/__tests__/gscClient.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[90m 14[2mms[22m[39m
 [32mâœ“[39m src/lib/rbac/__tests__/permissions.test.ts [2m ([22m[2m33 tests[22m[2m)[22m[90m 26[2mms[22m[39m
 [32mâœ“[39m src/lib/db/__tests__/connection-pool.test.ts [2m ([22m[2m21 tests[22m[2m)[22m[33m 1467[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [32mâœ“[39m tests/unit/lib/env-validation.test.ts [2m ([22m[2m30 tests[22m[2m)[22m[90m 46[2mms[22m[39m
 [32mâœ“[39m src/lib/__tests__/pnlGenerator.test.ts [2m ([22m[2m10 tests[22m[2m)[22m[90m 20[2mms[22m[39m
 [32mâœ“[39m src/lib/services/leviathan/__tests__/social-stack.test.ts [2m ([22m[2m27 tests[22m[2m)[22m[33m 2553[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [33mâ¯[39m src/lib/__tests__/strategySignoff.test.ts [2m ([22m[2m16 tests[22m [2m|[22m [31m16 failed[39m[2m)[22m[90m 23[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate recommendations from audit data[39m
[31m     â†’ service.generateRecommendations is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould prioritize critical health score drops[39m
[31m     â†’ service.generateRecommendations is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate keyword recommendations for significant losses[39m
[31m     â†’ service.generateRecommendations is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate backlink recommendations for significant losses[39m
[31m     â†’ service.generateRecommendations is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate technical recommendations for critical issues[39m
[31m     â†’ service.generateRecommendations is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould return empty array for healthy audit with no issues[39m
[31m     â†’ service.generateRecommendations is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mcreateSnapshot[2m > [22mshould create a strategy snapshot with all fields[39m
[31m     â†’ service.createSnapshot is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould record an APPROVED decision[39m
[31m     â†’ service.submitSignoff is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould record a REJECTED decision with notes[39m
[31m     â†’ service.submitSignoff is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould record a MODIFIED decision with changes[39m
[31m     â†’ service.submitSignoff is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould handle signoff for entire audit (no recommendation_id)[39m
[31m     â†’ service.submitSignoff is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgetSignoffHistory[2m > [22mshould return signoff history for a client[39m
[31m     â†’ service.getSignoffHistory is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgetSignoffHistory[2m > [22mshould filter by audit_id[39m
[31m     â†’ service.getSignoffHistory is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mupdateSnapshotStatus[2m > [22mshould update status to APPROVED when all recommendations approved[39m
[31m     â†’ service.updateSnapshotStatus is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mupdateSnapshotStatus[2m > [22mshould update status to PARTIAL when some approved[39m
[31m     â†’ service.updateSnapshotStatus is not a function[39m
[31m   [33mâ¯[31m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mupdateSnapshotStatus[2m > [22mshould update status to REJECTED when all rejected[39m
[31m     â†’ service.updateSnapshotStatus is not a function[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m src/lib/__tests__/bingClient.test.ts [2m ([22m[2m27 tests[22m[2m)[22m[90m 14[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m src/lib/__tests__/strategyIntegration.test.ts [2m ([22m[2m22 tests[22m[2m)[22m[90m 12[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m tests/unit/lib/email-ingestion/clientEmailMapper.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[90m 25[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

 [33mâ¯[39m tests/unit/lib/tfn-validator.test.ts [2m ([22m[2m31 tests[22m [2m|[22m [31m9 failed[39m[2m)[22m[90m 41[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidateCheckDigit[2m > [22mshould validate 8-digit TFN check digit[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidateCheckDigit[2m > [22mshould validate 9-digit TFN check digit[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidate[2m > [22mshould validate correct 8-digit TFN[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidate[2m > [22mshould validate correct 9-digit TFN[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidate[2m > [22mshould handle TFN with spaces[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidateBatch[2m > [22mshould validate multiple TFNs[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mCheck digit algorithm[2m > [22mshould use correct weighting factors for 8-digit[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mCheck digit algorithm[2m > [22mshould use correct weighting factors for 9-digit[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mCheck digit algorithm[2m > [22mshould handle check digit > 9 subtraction rule[39m
[31m     â†’ expected false to be true // Object.is equality[39m
 [32mâœ“[39m src/lib/__tests__/anomalyDetector.test.ts [2m ([22m[2m22 tests[22m[2m)[22m[90m 21[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/invoicing-calculations.test.ts [2m ([22m[2m20 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/autoAction/criticalPointGuard.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[90m 17[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/tenantOrchestrator.test.ts [2m ([22m[2m13 tests[22m [2m|[22m [31m8 failed[39m[2m)[22m[90m 33[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Container Lifecycle[2m > [22mshould start container successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Container Lifecycle[2m > [22mshould stop container successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Container Lifecycle[2m > [22mshould restart container successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould get container status when running[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould perform health check successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould detect unhealthy container[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould handle health check timeout[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Resource Metrics[2m > [22mshould get resource metrics successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/unit/lib/autoAction/sandboxConfig.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[90m 20[2mms[22m[39m
 [32mâœ“[39m tests/unit/agents/contact-intelligence.test.ts [2m ([22m[2m10 tests[22m[2m)[22m[90m 39[2mms[22m[39m
 [33mâ¯[39m tests/integration/api/auth.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [31m2 failed[39m [2m|[22m [33m5 skipped[39m[2m)[22m[90m 243[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/api/auth.test.ts[2m > [22mAuthentication API Integration Tests[2m > [22mPOST /api/auth/initialize-user[2m > [22mshould return 200 and skip initialization without authentication[39m
[31m     â†’ expected 500 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/integration/api/auth.test.ts[2m > [22mAuthentication API Integration Tests[2m > [22mError Handling[2m > [22mshould return JSON response when not authenticated[39m
[31m     â†’ expected { success: false, â€¦(3) } to have property "message"[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  override existing env vars with { override: true }

 [33mâ¯[39m tests/integration/multi-channel/channel-manager.test.ts [2m ([22m[2m18 tests[22m [2m|[22m [31m3 failed[39m[2m)[22m[90m 63[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/multi-channel/channel-manager.test.ts[2m > [22mChannelManager Integration Tests[2m > [22mChannel Execution[2m > [22mshould execute email channel successfully[39m
[31m     â†’ expected undefined to be 'email' // Object.is equality[39m
[31m   [33mâ¯[31m tests/integration/multi-channel/channel-manager.test.ts[2m > [22mChannelManager Integration Tests[2m > [22mChannel Execution[2m > [22mshould execute SMS channel with phone validation[39m
[31m     â†’ expected undefined to be 'sms' // Object.is equality[39m
[31m   [33mâ¯[31m tests/integration/multi-channel/channel-manager.test.ts[2m > [22mChannelManager Integration Tests[2m > [22mError Handling[2m > [22mshould handle invalid channel type[39m
[31m     â†’ promise resolved "{ success: false, â€¦(2) }" instead of rejecting[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m src/lib/services/engines/__tests__/engines.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[33m 540[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [33mâ¯[39m tests/unit/lib/ato-client.test.ts [2m ([22m[2m21 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 26[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/lib/ato-client.test.ts[2m > [22mATOClient[2m > [22mEnvironment factory[2m > [22mshould create client from environment variables[39m
[31m     â†’ Cannot find module '@/lib/integrations/ato/ato-client'
Require stack:
- D:\Unite-Hub\tests\unit\lib\ato-client.test.ts[39m
 [33mâ¯[39m src/lib/__tests__/financialReportEngine.test.ts [2m ([22m[2m11 tests[22m [2m|[22m [31m8 failed[39m[2m)[22m[90m 34[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Project Financials[2m > [22mshould fetch all project financials[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Project Financials[2m > [22mshould filter by project ID[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Client Billing[2m > [22mshould fetch all client billing summaries[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Client Billing[2m > [22mshould filter by contact ID[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - AI Costs[2m > [22mshould aggregate AI costs by provider and model[39m
[31m     â†’ expected 0 to be greater than 0[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - AI Cost Recording[2m > [22mshould record AI cost with correct calculation[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - AI Cost Recording[2m > [22mshould include cache tokens in cost calculation[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Materialized Views[2m > [22mshould refresh materialized views successfully[39m
[31m     â†’ expected false to be true // Object.is equality[39m
 [33mâ¯[39m tests/unit/lib/supabase.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[90m 33[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser Client[2m > [22mshould create browser client with correct config[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'https://test.supabase.co', â€¦(2) ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [33mâ¯[31m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser Client[2m > [22mshould use lazy initialization for browser client[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m   [33mâ¯[31m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser Client[2m > [22mshould throw error if environment variables missing[39m
[31m     â†’ expected [Function] to throw an error[39m
[31m   [33mâ¯[31m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mServer Client[2m > [22mshould create server client with cookie handling[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'https://test.supabase.co', â€¦(2) ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [33mâ¯[31m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser vs Server Usage[2m > [22mshould use getSupabaseServer for server-side operations[39m
[31m     â†’ expected undefined not to be undefined[39m
 [32mâœ“[39m tests/unit/selfHealing/errorClassifier.test.ts [2m ([22m[2m18 tests[22m[2m)[22m[90m 17[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/csrf.test.ts [2m ([22m[2m20 tests[22m[2m)[22m[90m 40[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/rate-limit.test.ts [2m ([22m[2m12 tests[22m[2m)[22m[90m 43[2mms[22m[39m
 [33mâ¯[39m tests/unit/services/credential-alert-service.test.ts [2m ([22m[2m6 tests[22m [2m|[22m [31m6 failed[39m[2m)[22m[90m 18[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mcheckAndSendAlerts[2m > [22mshould generate alerts for expiring credentials[39m
[31m     â†’ Synthex not initialized. Run: synthex init[39m
[31m   [33mâ¯[31m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mcheckAndSendAlerts[2m > [22mshould not create duplicate alerts within 24 hours[39m
[31m     â†’ Synthex not initialized. Run: synthex init[39m
[31m   [33mâ¯[31m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mcheckAndSendAlerts[2m > [22mshould classify alerts by severity correctly[39m
[31m     â†’ Synthex not initialized. Run: synthex init[39m
[31m   [33mâ¯[31m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mconfigureAlertRule[2m > [22mshould create alert rule successfully[39m
[31m     â†’ Synthex not initialized. Run: synthex init[39m
[31m   [33mâ¯[31m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22macknowledgeAlert[2m > [22mshould acknowledge alert successfully[39m
[31m     â†’ Synthex not initialized. Run: synthex init[39m
[31m   [33mâ¯[31m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mgetAlerts[2m > [22mshould retrieve unacknowledged alerts[39m
[31m     â†’ Synthex not initialized. Run: synthex init[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/unit/lib/sanitize.test.ts [2m ([22m[2m16 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32mâœ“[39m src/lib/__tests__/scope-planner.test.ts [2m ([22m[2m10 tests[22m[2m)[22m[90m 11[2mms[22m[39m
 [32mâœ“[39m tests/integration/auth/roleRouting.test.ts [2m ([22m[2m27 tests[22m[2m)[22m[90m 22[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m src/lib/__tests__/seoCredentialService.test.ts [2m ([22m[2m8 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32mâœ“[39m src/lib/__tests__/xero-invoicing.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/phase2/client-auth.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m src/lib/__tests__/paymentService.test.ts [2m ([22m[2m4 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32mâœ“[39m tests/routing/layouts.test.ts [2m ([22m[2m16 tests[22m[2m)[22m[90m 28[2mms[22m[39m
 [32mâœ“[39m tests/rls/client-ownership.rls.test.ts [2m ([22m[2m1 test[22m[2m)[22m[90m 4[2mms[22m[39m
 [32mâœ“[39m tests/rls/xero-multi-tenant.rls.test.ts [2m ([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m src/lib/__tests__/cache.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32mâœ“[39m src/lib/__tests__/staffService.test.ts [2m ([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m src/lib/__tests__/clientService.test.ts [2m ([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
 [33mâ¯[39m tests/unit/multi-channel-autonomy.test.ts [2m ([22m[2m48 tests[22m [2m|[22m [31m7 failed[39m[2m)[22m[33m 4690[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify social inbox intent[39m
[31m     â†’ [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
[31m   [33mâ¯[31m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify ads optimization intent[39m
[31m     â†’ [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
[31m   [33mâ¯[31m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify search audit intent[39m
[31m     â†’ [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
[31m   [33mâ¯[31m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify browser replay intent[39m
[31m     â†’ [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
[31m   [33mâ¯[31m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify pattern learning intent[39m
[31m     â†’ [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
[31m   [33mâ¯[31m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mgeneratePlan[2m > [22mshould generate plan for social inbox management[39m
[31m     â†’ [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
[31m   [33mâ¯[31m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mgeneratePlan[2m > [22mshould generate plan for ads optimization[39m
[31m     â†’ [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
 [33mâ¯[39m src/lib/__tests__/scopeAI.test.ts [2m ([22m[2m12 tests[22m [2m|[22m [31m4 failed[39m[2m)[22m[33m 1951[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mPrompt Generation[2m > [22mshould generate structure check prompt[39m
[31m     â†’ expected '\nYou are a technical validator ensurâ€¦' to contain 'validate'[39m
[31m   [33mâ¯[31m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mIntegration Tests (requires OPENROUTER_API_KEY)[2m > [22mshould generate complete scope via hybrid pipeline[39m
[31m     â†’ OpenRouter API error (draft_generation): {"error":{"message":"No cookie auth credentials found","code":401}}[39m
[31m   [33mâ¯[31m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mIntegration Tests (requires OPENROUTER_API_KEY)[2m > [22mshould track costs for all pipeline stages[39m
[31m     â†’ OpenRouter API error (draft_generation): {"error":{"message":"No cookie auth credentials found","code":401}}[39m
[31m   [33mâ¯[31m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mIntegration Tests (requires OPENROUTER_API_KEY)[2m > [22mshould generate increasing scope for Good â†’ Better â†’ Best[39m
[31m     â†’ OpenRouter API error (draft_generation): {"error":{"message":"No cookie auth credentials found","code":401}}[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m src/components/__tests__/ErrorBoundary.test.tsx [2m ([22m[2m1 test[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | _log (D:\Unite-Hub\node_modules\dotenv\lib\main.js:142:11)[22m[39m
[dotenv@17.2.3] injecting env (11) from .env.test -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m src/components/__tests__/ToastContext.test.tsx [2m ([22m[2m1 test[22m[2m)[22m[90m 2[2mms[22m[39m
 [32mâœ“[39m tests/unit/components/error-pages.test.tsx [2m ([22m[2m8 tests[22m[2m)[22m[90m 124[2mms[22m[39m
 [33mâ¯[39m tests/unit/components/skeletons.test.tsx [2m ([22m[2m17 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[90m 138[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/components/skeletons.test.tsx[2m > [22mContentListSkeleton[2m > [22mshould render default number of skeletons (6)[39m
[31m     â†’ expected 24 to be 6 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/components/skeletons.test.tsx[2m > [22mContentListSkeleton[2m > [22mshould render custom number of skeletons[39m
[31m     â†’ expected 12 to be 3 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/components/skeletons.test.tsx[2m > [22mContentListSkeleton[2m > [22mshould handle large count[39m
[31m     â†’ expected 80 to be 20 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/components/skeletons.test.tsx[2m > [22mStatsGridSkeleton[2m > [22mshould render default number of stat cards (4)[39m
[31m     â†’ expected 16 to be 4 // Object.is equality[39m
[31m   [33mâ¯[31m tests/unit/components/skeletons.test.tsx[2m > [22mStatsGridSkeleton[2m > [22mshould render custom number of stat cards[39m
[31m     â†’ expected 24 to be 6 // Object.is equality[39m
 [32mâœ“[39m tests/unit/components/loading-skeletons.test.tsx [2m ([22m[2m6 tests[22m[2m)[22m[90m 129[2mms[22m[39m
 [32mâœ“[39m tests/unit/components/EmptyState.test.tsx [2m ([22m[2m21 tests[22m[2m)[22m[33m 432[2mms[22m[39m
 [32mâœ“[39m tests/unit/components/ErrorState.test.tsx [2m ([22m[2m21 tests[22m[2m)[22m[33m 559[2mms[22m[39m
 [32mâœ“[39m tests/components/HotLeadsPanel.test.tsx [2m ([22m[2m12 tests[22m[2m)[22m[33m 556[2mms[22m[39m
 [32mâœ“[39m src/components/seo/__tests__/SeoModeToggle.test.tsx [2m ([22m[2m7 tests[22m[2m)[22m[90m 227[2mms[22m[39m
 [32mâœ“[39m src/components/seo/__tests__/SeoDashboardShell.test.tsx [2m ([22m[2m9 tests[22m[2m)[22m[33m 626[2mms[22m[39m
 [32mâœ“[39m src/lib/services/system/__tests__/finalization.test.ts [2m ([22m[2m50 tests[22m[2m)[22m[33m 25880[2mms[22m[39m
 [33mâ¯[39m src/lib/__tests__/integration/api.test.ts [2m ([22m[2m6 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[33m 43390[2mms[22m[39m
[31m   [33mâ¯[31m src/lib/__tests__/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mHealth Check Endpoint[2m > [22mshould include latency measurements[39m
[31m     â†’ Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[31m   [33mâ¯[31m src/lib/__tests__/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mHealth Check Endpoint[2m > [22mshould handle rate limiting[39m
[31m     â†’ expected false to be true // Object.is equality[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1m[7m Failed Suites 1 [27m[22mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/features/workspace-isolation.test.ts [2m[ tests/integration/features/workspace-isolation.test.ts ][22m
[31m[1mTypeError[22m: createMockWorkspace is not a function[39m
[36m [2mâ¯[22m tests/integration/features/workspace-isolation.test.ts:[2m12:22[22m[39m
    [90m 10| [39m
    [90m 11| [39m[34mdescribe[39m([32m'Workspace Isolation - Contacts API'[39m[33m,[39m () [33m=>[39m {
    [90m 12| [39m  [35mconst[39m workspace1 [33m=[39m [34mcreateMockWorkspace[39m({ id[33m:[39m workspaceIsolation[33m.[39mworkâ€¦
    [90m   | [39m                     [31m^[39m
    [90m 13| [39m  [35mconst[39m workspace2 [33m=[39m [34mcreateMockWorkspace[39m({ id[33m:[39m workspaceIsolation[33m.[39mworkâ€¦
    [90m 14| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/327]âŽ¯[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1m[7m Failed Tests 326 [27m[22mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mOAuth2 M2M Authentication Flow[2m > [22mshould fetch access token using client credentials
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m tests/integration/ato-integration.test.ts:[2m179:21[22m[39m
    [90m177| [39m      [35mconst[39m token [33m=[39m [35mawait[39m client[33m.[39m[34mgetAccessToken[39m()[33m;[39m
    [90m178| [39m      [34mexpect[39m(token)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m179| [39m      [34mexpect[39m(fetch)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m180| [39m    })[33m;[39m
    [90m181| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mOAuth2 M2M Authentication Flow[2m > [22mshould include required OAuth2 parameters
[31m[1mTypeError[22m: fetchCall is not iterable[39m
[36m [2mâ¯[22m tests/integration/ato-integration.test.ts:[2m189:30[22m[39m
    [90m187| [39m
    [90m188| [39m      [35mconst[39m fetchCall [33m=[39m (fetch [35mas[39m any)[33m.[39mmock[33m.[39mcalls[[34m0[39m][33m;[39m
    [90m189| [39m      [35mconst[39m [url[33m,[39m options] [33m=[39m fetchCall[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m190| [39m
    [90m191| [39m      [34mexpect[39m(options[33m.[39mmethod)[33m.[39m[34mtoBe[39m([32m'POST'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mABN Validation Pipeline[2m > [22mshould cache ABN lookup results
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'abn_lookups' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m tests/integration/ato-integration.test.ts:[2m241:29[22m[39m
    [90m239| [39m      [35mconst[39m { createClient } [33m=[39m [35mawait[39m [35mimport[39m([32m'@/lib/supabase/server'[39m)[33m;[39m
    [90m240| [39m      [35mconst[39m supabase [33m=[39m [35mawait[39m [34mcreateClient[39m()[33m;[39m
    [90m241| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'abn_lookups'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m242| [39m    })[33m;[39m
    [90m243| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mBAS Lodgement Flow[2m > [22mshould store lodgement record in database
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'bas_lodgements' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m tests/integration/ato-integration.test.ts:[2m302:29[22m[39m
    [90m300| [39m      [35mconst[39m { createClient } [33m=[39m [35mawait[39m [35mimport[39m([32m'@/lib/supabase/server'[39m)[33m;[39m
    [90m301| [39m      [35mconst[39m supabase [33m=[39m [35mawait[39m [34mcreateClient[39m()[33m;[39m
    [90m302| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'bas_lodgements'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m303| [39m    })[33m;[39m
    [90m304| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mTax Obligations Sync[2m > [22mshould sync obligations to database
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'tax_obligations' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m tests/integration/ato-integration.test.ts:[2m328:29[22m[39m
    [90m326| [39m      [35mconst[39m { createClient } [33m=[39m [35mawait[39m [35mimport[39m([32m'@/lib/supabase/server'[39m)[33m;[39m
    [90m327| [39m      [35mconst[39m supabase [33m=[39m [35mawait[39m [34mcreateClient[39m()[33m;[39m
    [90m328| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'tax_obligations'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m329| [39m    })[33m;[39m
    [90m330| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mConnection Management[2m > [22mshould disconnect gracefully
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'ato_credentials' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m tests/integration/ato-integration.test.ts:[2m354:29[22m[39m
    [90m352| [39m      [35mconst[39m { createClient } [33m=[39m [35mawait[39m [35mimport[39m([32m'@/lib/supabase/server'[39m)[33m;[39m
    [90m353| [39m      [35mconst[39m supabase [33m=[39m [35mawait[39m [34mcreateClient[39m()[33m;[39m
    [90m354| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'ato_credentials'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m355| [39m    })[33m;[39m
    [90m356| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/ato-integration.test.ts[2m > [22mATO Integration[2m > [22mError Scenarios[2m > [22mshould handle network errors
[31m[1mAssertionError[22m: promise resolved "'mock-token'" instead of rejecting[39m

[32m- Expected:[39m 
[Error: rejected promise]

[31m+ Received:[39m 
"mock-token"

[36m [2mâ¯[22m tests/integration/ato-integration.test.ts:[2m382:43[22m[39m
    [90m380| [39m      [35mawait[39m client[33m.[39m[34minitialize[39m([32m'workspace-1'[39m)[33m;[39m
    [90m381| [39m
    [90m382| [39m      [35mawait[39m [34mexpect[39m(client[33m.[39m[34mgetAccessToken[39m())[33m.[39mrejects[33m.[39m[34mtoThrow[39m([32m'Network e[39mâ€¦
    [90m   | [39m                                          [31m^[39m
    [90m383| [39m    })[33m;[39m
    [90m384| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould complete full lifecycle for LOW risk proposal
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'restore_email')[39m
[36m [2mâ¯[22m TrustModeService.initializeTrustedMode src/lib/trust/trustModeService.ts:[2m83:32[22m[39m
    [90m 81| [39m        organization_id[33m:[39m organizationId[33m,[39m
    [90m 82| [39m        status[33m:[39m [32m"PENDING_IDENTITY"[39m[33m,[39m
    [90m 83| [39m        restore_email[33m:[39m options[33m.[39mrestore_email[33m,[39m
    [90m   | [39m                               [31m^[39m
    [90m 84| [39m        emergency_phone[33m:[39m options[33m.[39memergency_phone [33m||[39m [35mnull[39m[33m,[39m
    [90m 85| [39m        nightly_backup_enabled[33m:[39m options[33m.[39mnightly_backup_enabled [33m??[39m [35mtrue[39m[33m,[39m
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m87:28[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould require manual approval for HIGH risk proposal
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m514:8[22m[39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m   | [39m       [31m^[39m
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
    [90m516| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m ProposalEngine.createProposal src/lib/autonomy/proposalEngine.ts:[2m64:24[22m[39m
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m208:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould reject forbidden change types
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Validation failed' but got 'Cannot read properties of undefined (â€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Validation failed[39m
[31m+ Cannot read properties of undefined (reading 'from')[39m

[36m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m242:7[22m[39m
    [90m240| [39m
    [90m241| [39m    [34mit[39m([32m"should reject forbidden change types"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m242| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m243| [39m        proposalEngine[33m.[39m[34mcreateProposal[39m({
    [90m244| [39m          client_id[33m:[39m testClientId[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould enforce rollback deadline
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Rollback deadline has passed' but got 'Cannot read properties of undefined (â€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Rollback deadline has passed[39m
[31m+ Cannot read properties of undefined (reading 'from')[39m

[36m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m275:7[22m[39m
    [90m273| [39m        })[33m;[39m
    [90m274| [39m
    [90m275| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m276| [39m        rollbackEngine[33m.[39m[34mrollback[39m({
    [90m277| [39m          rollback_token_id[33m:[39m [32m"token-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mComplete Trust Mode â†’ Proposal â†’ Execution â†’ Rollback Flow[2m > [22mshould prevent duplicate rollbacks
[31m[1mAssertionError[22m: expected [Function] to throw error including 'already been rolled back' but got 'Cannot read properties of undefined (â€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- already been rolled back[39m
[31m+ Cannot read properties of undefined (reading 'from')[39m

[36m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m298:7[22m[39m
    [90m296| [39m        })[33m;[39m
    [90m297| [39m
    [90m298| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m299| [39m        rollbackEngine[33m.[39m[34mrollback[39m({
    [90m300| [39m          rollback_token_id[33m:[39m [32m"token-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mTrust Mode Status Enforcement[2m > [22mshould reject proposals when trust mode is not ACTIVE
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Trusted mode not active' but got 'Cannot read properties of undefined (â€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Trusted mode not active[39m
[31m+ Cannot read properties of undefined (reading 'from')[39m

[36m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m315:7[22m[39m
    [90m313| [39m      })[33m;[39m
    [90m314| [39m
    [90m315| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m316| [39m        proposalEngine[33m.[39m[34mcreateProposal[39m({
    [90m317| [39m          client_id[33m:[39m testClientId[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mTrust Mode Status Enforcement[2m > [22mshould reject execution when trust mode is suspended
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m343:44[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould allow SEO meta_update changes
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m514:8[22m[39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m   | [39m       [31m^[39m
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
    [90m516| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m355:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould reject ADS budget_increase changes
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m514:8[22m[39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m   | [39m       [31m^[39m
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
    [90m516| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m366:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould reject CONTENT mass_content_delete changes
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m514:8[22m[39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m   | [39m       [31m^[39m
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
    [90m516| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m377:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mDomain-Specific Validation[2m > [22mshould reject CRO variant_mass_delete changes
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m514:8[22m[39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m   | [39m       [31m^[39m
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
    [90m516| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m388:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mExecution Limits[2m > [22mshould enforce daily execution limit
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m423:44[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mRollback Type Selection[2m > [22mshould select SOFT_UNDO for recent LOW risk
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m RollbackEngine.rollback src/lib/autonomy/rollbackEngine.ts:[2m46:8[22m[39m
    [90m 44| [39m    [90m// Find the execution by rollback token[39m
    [90m 45| [39m    [35mconst[39m { data[33m:[39m execution[33m,[39m error[33m:[39m execError } [33m=[39m [35mawait[39m supabase
    [90m 46| [39m      [33m.[39m[35mfrom[39m([32m"autonomy_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m 47| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m 48| [39m      [33m.[39m[34meq[39m([32m"rollback_token_id"[39m[33m,[39m request[33m.[39mrollback_token_id)
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m462:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mRollback Type Selection[2m > [22mshould select HARD_UNDO for older executions
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m RollbackEngine.rollback src/lib/autonomy/rollbackEngine.ts:[2m46:8[22m[39m
    [90m 44| [39m    [90m// Find the execution by rollback token[39m
    [90m 45| [39m    [35mconst[39m { data[33m:[39m execution[33m,[39m error[33m:[39m execError } [33m=[39m [35mawait[39m supabase
    [90m 46| [39m      [33m.[39m[35mfrom[39m([32m"autonomy_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m 47| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m 48| [39m      [33m.[39m[34meq[39m([32m"rollback_token_id"[39m[33m,[39m request[33m.[39mrollback_token_id)
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m498:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/autonomy-lifecycle.test.ts[2m > [22mAutonomy Lifecycle Integration Tests[2m > [22mAudit Trail[2m > [22mshould log proposal creation
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'from')[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m514:8[22m[39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m   | [39m       [31m^[39m
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
    [90m516| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m ProposalEngine.createProposal src/lib/autonomy/proposalEngine.ts:[2m64:24[22m[39m
[90m [2mâ¯[22m tests/integration/autonomy-lifecycle.test.ts:[2m524:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight Generation[2m > [22mshould forecast trends accurately
[31m[1mAssertionError[22m: expected undefined not to be undefined[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m129:31[22m[39m
    [90m127| [39m      [35mconst[39m insight [33m=[39m { [33m...[39mmockInsights[33m.[39mtrend }[33m;[39m
    [90m128| [39m      [34mexpect[39m(insight[33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'trend'[39m)[33m;[39m
    [90m129| [39m      [34mexpect[39m(insight[33m.[39mmetrics)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m130| [39m    })[33m;[39m
    [90m131| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight Generation[2m > [22mshould identify optimization opportunities
[31m[1mAssertionError[22m: expected undefined not to be undefined[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m135:35[22m[39m
    [90m133| [39m      [35mconst[39m insight [33m=[39m { [33m...[39mmockInsights[33m.[39mopportunity }[33m;[39m
    [90m134| [39m      [34mexpect[39m(insight[33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'opportunity'[39m)[33m;[39m
    [90m135| [39m      [34mexpect[39m(insight[33m.[39mrelatedData)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m136| [39m    })[33m;[39m
    [90m137| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight Metrics & Data[2m > [22mshould include related data context
[31m[1mAssertionError[22m: expected undefined not to be undefined[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m193:35[22m[39m
    [90m191| [39m    [34mit[39m([32m'should include related data context'[39m[33m,[39m () [33m=>[39m {
    [90m192| [39m      [35mconst[39m insight [33m=[39m { [33m...[39mmockInsights[33m.[39mpattern }[33m;[39m
    [90m193| [39m      [34mexpect[39m(insight[33m.[39mrelatedData)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m194| [39m    })[33m;[39m
    [90m195| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mRecommendation Generation[2m > [22mshould include action items
[31m[1mAssertionError[22m: expected undefined not to be undefined[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m259:31[22m[39m
    [90m257| [39m    [34mit[39m([32m'should include action items'[39m[33m,[39m () [33m=>[39m {
    [90m258| [39m      [35mconst[39m rec [33m=[39m { [33m...[39mmockRecommendations[33m.[39mquickWin }[33m;[39m
    [90m259| [39m      [34mexpect[39m(rec[33m.[39mactionItems)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m260| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(rec[33m.[39mactionItems))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m261| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mRecommendation Generation[2m > [22mshould define success metrics
[31m[1mAssertionError[22m: expected undefined not to be undefined[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m265:34[22m[39m
    [90m263| [39m    [34mit[39m([32m'should define success metrics'[39m[33m,[39m () [33m=>[39m {
    [90m264| [39m      [35mconst[39m rec [33m=[39m { [33m...[39mmockRecommendations[33m.[39mquickWin }[33m;[39m
    [90m265| [39m      [34mexpect[39m(rec[33m.[39msuccessMetrics)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m266| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(rec[33m.[39msuccessMetrics))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m267| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight & Recommendation Linking[2m > [22mshould link insights to recommendations
[31m[1mAssertionError[22m: expected undefined not to be undefined[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m304:35[22m[39m
    [90m302| [39m    [34mit[39m([32m'should link insights to recommendations'[39m[33m,[39m () [33m=>[39m {
    [90m303| [39m      [35mconst[39m rec [33m=[39m { [33m...[39mmockRecommendations[33m.[39mquickWin }[33m;[39m
    [90m304| [39m      [34mexpect[39m(rec[33m.[39mrelatedInsights)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m305| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(rec[33m.[39mrelatedInsights))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m306| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight & Recommendation Linking[2m > [22mshould reference related insights
[31m[1mAssertionError[22m: expected undefined to be an instance of Array[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m310:35[22m[39m
    [90m308| [39m    [34mit[39m([32m'should reference related insights'[39m[33m,[39m () [33m=>[39m {
    [90m309| [39m      [35mconst[39m rec [33m=[39m { [33m...[39mmockRecommendations[33m.[39mstrategic }[33m;[39m
    [90m310| [39m      [34mexpect[39m(rec[33m.[39mrelatedInsights)[33m.[39m[34mtoBeInstanceOf[39m([33mArray[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m311| [39m    })[33m;[39m
    [90m312| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-insights.test.ts[2m > [22mFramework Insights & Recommendations[2m > [22mInsight & Recommendation Linking[2m > [22mshould maintain referential integrity
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m tests/integration/framework-insights.test.ts:[2m315:31[22m[39m
    [90m313| [39m    [34mit[39m([32m'should maintain referential integrity'[39m[33m,[39m () [33m=>[39m {
    [90m314| [39m      [35mconst[39m rec [33m=[39m { [33m...[39mmockRecommendations[33m.[39mquickWin }[33m;[39m
    [90m315| [39m      [35mif[39m (rec[33m.[39mrelatedInsights[33m.[39mlength [33m>[39m [34m0[39m) {
    [90m   | [39m                              [31m^[39m
    [90m316| [39m        rec[33m.[39mrelatedInsights[33m.[39m[34mforEach[39m((insightId) [33m=>[39m {
    [90m317| [39m          [34mexpect[39m([35mtypeof[39m insightId)[33m.[39m[34mtoBe[39m([32m'string'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/framework-templates.test.ts[2m > [22mFramework Template Library[2m > [22mTemplate Rating[2m > [22mshould validate rating range (1-5)
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2mâ¯[22m tests/integration/framework-templates.test.ts:[2m262:34[22m[39m
    [90m260| [39m
    [90m261| [39m      invalidRatings[33m.[39m[34mforEach[39m((r) [33m=>[39m {
    [90m262| [39m        [34mexpect[39m(r [33m>=[39m [34m1[39m [33m&&[39m r [33m<=[39m [34m5[39m)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m263| [39m      })[33m;[39m
    [90m264| [39m    })[33m;[39m
[90m [2mâ¯[22m tests/integration/framework-templates.test.ts:[2m261:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mEmployee Management[2m > [22mshould get employee by ID
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).eq(...).single is not a function[39m
[36m [2mâ¯[22m getEmployee src/lib/integrations/ato/stpComplianceService.ts:[2m392:6[22m[39m
    [90m390| [39m    [33m.[39m[34meq[39m([32m'workspace_id'[39m[33m,[39m workspaceId)
    [90m391| [39m    [33m.[39m[34meq[39m([32m'id'[39m[33m,[39m employeeId)
    [90m392| [39m    [33m.[39m[34msingle[39m()[33m;[39m
    [90m   | [39m     [31m^[39m
    [90m393| [39m
    [90m394| [39m  [35mif[39m (error) {
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m161:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould create pay run with automatic calculations
[31m[1mTypeError[22m: supabase.from(...).insert is not a function[39m
[36m [2mâ¯[22m createPayRun src/lib/integrations/ato/stpComplianceService.ts:[2m433:6[22m[39m
    [90m431| [39m  [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m432| [39m    [33m.[39m[35mfrom[39m([32m'stp_pay_runs'[39m)
    [90m433| [39m    [33m.[39m[34minsert[39m({
    [90m   | [39m     [31m^[39m
    [90m434| [39m      workspace_id[33m:[39m workspaceId[33m,[39m
    [90m435| [39m      [33m...[39mpayRunData[33m,[39m
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m221:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould finalize pay run
[31m[1mTypeError[22m: supabase.from(...).update is not a function[39m
[36m [2mâ¯[22m finalizePayRun src/lib/integrations/ato/stpComplianceService.ts:[2m456:6[22m[39m
    [90m454| [39m  [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m455| [39m    [33m.[39m[35mfrom[39m([32m'stp_pay_runs'[39m)
    [90m456| [39m    [33m.[39m[34mupdate[39m({ status[33m:[39m [32m'finalized'[39m })
    [90m   | [39m     [31m^[39m
    [90m457| [39m    [33m.[39m[34meq[39m([32m'workspace_id'[39m[33m,[39m workspaceId)
    [90m458| [39m    [33m.[39m[34meq[39m([32m'id'[39m[33m,[39m payRunId)
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m230:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould calculate PAYG correctly for weekly pay
[31m[1mTypeError[22m: supabase.from(...).insert is not a function[39m
[36m [2mâ¯[22m createPayRun src/lib/integrations/ato/stpComplianceService.ts:[2m433:6[22m[39m
    [90m431| [39m  [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m432| [39m    [33m.[39m[35mfrom[39m([32m'stp_pay_runs'[39m)
    [90m433| [39m    [33m.[39m[34minsert[39m({
    [90m   | [39m     [31m^[39m
    [90m434| [39m      workspace_id[33m:[39m workspaceId[33m,[39m
    [90m435| [39m      [33m...[39mpayRunData[33m,[39m
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m262:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mPay Run Processing[2m > [22mshould calculate super guarantee correctly
[31m[1mTypeError[22m: supabase.from(...).insert is not a function[39m
[36m [2mâ¯[22m createPayRun src/lib/integrations/ato/stpComplianceService.ts:[2m433:6[22m[39m
    [90m431| [39m  [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m432| [39m    [33m.[39m[35mfrom[39m([32m'stp_pay_runs'[39m)
    [90m433| [39m    [33m.[39m[34minsert[39m({
    [90m   | [39m     [31m^[39m
    [90m434| [39m      workspace_id[33m:[39m workspaceId[33m,[39m
    [90m435| [39m      [33m...[39mpayRunData[33m,[39m
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m295:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mYTD Tracking[2m > [22mshould update YTD summary after pay run
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).eq(...).eq is not a function[39m
[36m [2mâ¯[22m getYTDSummary src/lib/integrations/ato/stpComplianceService.ts:[2m482:6[22m[39m
    [90m480| [39m    [33m.[39m[34meq[39m([32m'workspace_id'[39m[33m,[39m workspaceId)
    [90m481| [39m    [33m.[39m[34meq[39m([32m'employee_id'[39m[33m,[39m employeeId)
    [90m482| [39m    [33m.[39m[34meq[39m([32m'financial_year'[39m[33m,[39m financialYear)
    [90m   | [39m     [31m^[39m
    [90m483| [39m    [33m.[39m[34msingle[39m()[33m;[39m
    [90m484| [39m
[90m [2mâ¯[22m updateYTDSummary src/lib/integrations/ato/stpComplianceService.ts:[2m504:25[22m[39m
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m331:19[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mSTP Submissions[2m > [22mshould create STP submission
[31m[1mTypeError[22m: supabase.from(...).insert is not a function[39m
[36m [2mâ¯[22m createSTPSubmission src/lib/integrations/ato/stpComplianceService.ts:[2m545:6[22m[39m
    [90m543| [39m  [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m544| [39m    [33m.[39m[35mfrom[39m([32m'stp_submissions'[39m)
    [90m545| [39m    [33m.[39m[34minsert[39m({
    [90m   | [39m     [31m^[39m
    [90m546| [39m      [33m...[39msubmission[33m,[39m
    [90m547| [39m      status[33m:[39m [32m'draft'[39m[33m,[39m
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m390:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mFinancial Year Boundaries[2m > [22mshould handle pay runs across FY boundary
[31m[1mTypeError[22m: supabase.from(...).insert is not a function[39m
[36m [2mâ¯[22m createPayRun src/lib/integrations/ato/stpComplianceService.ts:[2m433:6[22m[39m
    [90m431| [39m  [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m432| [39m    [33m.[39m[35mfrom[39m([32m'stp_pay_runs'[39m)
    [90m433| [39m    [33m.[39m[34minsert[39m({
    [90m   | [39m     [31m^[39m
    [90m434| [39m      workspace_id[33m:[39m workspaceId[33m,[39m
    [90m435| [39m      [33m...[39mpayRunData[33m,[39m
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m517:26[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/stp-compliance.test.ts[2m > [22mSTP Compliance Integration[2m > [22mWorkspace Isolation[2m > [22mshould filter employees by workspace
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).eq(...).order is not a function[39m
[36m [2mâ¯[22m listActiveEmployees src/lib/integrations/ato/stpComplianceService.ts:[2m413:6[22m[39m
    [90m411| [39m    [33m.[39m[34meq[39m([32m'workspace_id'[39m[33m,[39m workspaceId)
    [90m412| [39m    [33m.[39m[34meq[39m([32m'is_active'[39m[33m,[39m [35mtrue[39m)
    [90m413| [39m    [33m.[39m[34morder[39m([32m'last_name'[39m[33m,[39m { ascending[33m:[39m [35mtrue[39m })[33m;[39m
    [90m   | [39m     [31m^[39m
    [90m414| [39m
    [90m415| [39m  [35mif[39m (error) [35mthrow[39m [35mnew[39m [33mError[39m([32m`Failed to list employees: [39m[36m${[39merror[33m.[39mmessagâ€¦
[90m [2mâ¯[22m tests/integration/stp-compliance.test.ts:[2m534:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify social inbox intent
[31m[1m[7m FAIL [27m[22m[39m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify ads optimization intent
[31m[1m[7m FAIL [27m[22m[39m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify search audit intent
[31m[1m[7m FAIL [27m[22m[39m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify browser replay intent
[31m[1m[7m FAIL [27m[22m[39m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mclassifyIntent[2m > [22mshould classify pattern learning intent
[31m[1m[7m FAIL [27m[22m[39m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mgeneratePlan[2m > [22mshould generate plan for social inbox management
[31m[1m[7m FAIL [27m[22m[39m tests/unit/multi-channel-autonomy.test.ts[2m > [22mOrchestrator Integration[2m > [22mgeneratePlan[2m > [22mshould generate plan for ads optimization
[31m[1mError[22m: [vitest] No "supabase" export is defined on the "@/lib/supabase" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi[33m.[39m[34mmock[39m([32m"@/lib/supabase"[39m[33m,[39m [35masync[39m (importOriginal) [33m=>[39m {
  [35mconst[39m actual [33m=[39m [35mawait[39m [34mimportOriginal[39m()
  [35mreturn[39m {
    [33m...[39mactual[33m,[39m
    [90m// your mocked methods[39m
  }
})

[36m [2mâ¯[22m src/lib/db.ts:[2m5:3[22m[39m
    [90m  3| [39m[90m// Organizations[39m
    [90m  4| [39m[35mexport[39m [35mconst[39m db [33m=[39m {
    [90m  5| [39m  supabase[33m,[39m [90m// Export for direct access when needed[39m
    [90m   | [39m  [31m^[39m
    [90m  6| [39m  getSupabaseServer[33m,[39m [90m// Export server client getter[39m
    [90m  7| [39m  organizations[33m:[39m {
[90m [2mâ¯[22m src/lib/agents/boostBumpAgent.ts:[2m2:31[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould assign weight 10 to OWNER votes
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m ConsensusService.detectConflicts src/lib/operator/consensusService.ts:[2m294:15[22m[39m
    [90m292| [39m    [35mconst[39m votes [33m=[39m [35mawait[39m [35mthis[39m[33m.[39m[34mgetVotes[39m(queueItemId)[33m;[39m
    [90m293| [39m
    [90m294| [39m    [35mif[39m (votes[33m.[39mlength [33m<[39m [34m2[39m) [35mreturn[39m conflicts[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m295| [39m
    [90m296| [39m    [90m// Get queue item[39m
[90m [2mâ¯[22m ConsensusService.castVote src/lib/operator/consensusService.ts:[2m148:5[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m83:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould assign weight 2 to MANAGER votes
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m ConsensusService.detectConflicts src/lib/operator/consensusService.ts:[2m294:15[22m[39m
    [90m292| [39m    [35mconst[39m votes [33m=[39m [35mawait[39m [35mthis[39m[33m.[39m[34mgetVotes[39m(queueItemId)[33m;[39m
    [90m293| [39m
    [90m294| [39m    [35mif[39m (votes[33m.[39mlength [33m<[39m [34m2[39m) [35mreturn[39m conflicts[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m295| [39m
    [90m296| [39m    [90m// Get queue item[39m
[90m [2mâ¯[22m ConsensusService.castVote src/lib/operator/consensusService.ts:[2m148:5[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m112:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould throw error for ANALYST vote attempts
[31m[1mAssertionError[22m: expected [Function] to throw error matching /Analysts can/ but got 'Queue item not found'[39m

[32m- Expected:[39m 
/Analysts can/

[31m+ Received:[39m 
"Queue item not found"

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m123:7[22m[39m
    [90m121| [39m
    [90m122| [39m    [34mit[39m([32m"should throw error for ANALYST vote attempts"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m123| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m124| [39m        service[33m.[39m[34mcastVote[39m([32m"queue-1"[39m[33m,[39m [32m"user-1"[39m[33m,[39m [32m"ANALYST"[39m[33m,[39m [32m"APPROVE"[39m)
    [90m125| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([36m/Analysts can/[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould assign weight 100 for OWNER override
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m ConsensusService.detectConflicts src/lib/operator/consensusService.ts:[2m294:15[22m[39m
    [90m292| [39m    [35mconst[39m votes [33m=[39m [35mawait[39m [35mthis[39m[33m.[39m[34mgetVotes[39m(queueItemId)[33m;[39m
    [90m293| [39m
    [90m294| [39m    [35mif[39m (votes[33m.[39mlength [33m<[39m [34m2[39m) [35mreturn[39m conflicts[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m295| [39m
    [90m296| [39m    [90m// Get queue item[39m
[90m [2mâ¯[22m ConsensusService.castVote src/lib/operator/consensusService.ts:[2m148:5[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m147:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mVote Weight Calculations[2m > [22mshould reject MANAGER override attempts
[31m[1mAssertionError[22m: expected [Function] to throw error matching /owners|override/i but got 'Queue item not found'[39m

[32m- Expected:[39m 
/owners|override/i

[31m+ Received:[39m 
"Queue item not found"

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m161:7[22m[39m
    [90m159| [39m
    [90m160| [39m    [34mit[39m([32m"should reject MANAGER override attempts"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m161| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m162| [39m        service[33m.[39m[34mcastVote[39m(
    [90m163| [39m          [32m"queue-1"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould require min 1 vote and weight 2 for LOW_RISK
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m192:33[22m[39m
    [90m190| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mcheckConsensus[39m([32m"queue-1"[39m)[33m;[39m
    [90m191| [39m
    [90m192| [39m      [34mexpect[39m(result[33m.[39mquorum_met)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m193| [39m      [34mexpect[39m(result[33m.[39mdecision)[33m.[39m[34mtoBe[39m([32m"APPROVED"[39m)[33m;[39m
    [90m194| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould require min 2 votes and weight 4 for MEDIUM_RISK
[31m[1mAssertionError[22m: expected undefined to be 'PENDING' // Object.is equality[39m

[32m- Expected:[39m 
"PENDING"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m214:31[22m[39m
    [90m212| [39m
    [90m213| [39m      [34mexpect[39m(result[33m.[39mquorum_met)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m214| [39m      [34mexpect[39m(result[33m.[39mdecision)[33m.[39m[34mtoBe[39m([32m"PENDING"[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m215| [39m    })[33m;[39m
    [90m216| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould meet MEDIUM_RISK quorum with 2 MANAGER votes
[31m[1mAssertionError[22m: expected undefined to be 4 // Object.is equality[39m

[32m- Expected:[39m 
4

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m236:35[22m[39m
    [90m234| [39m
    [90m235| [39m      [34mexpect[39m(result[33m.[39mquorum_met)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m236| [39m      [34mexpect[39m(result[33m.[39mtotal_weight)[33m.[39m[34mtoBe[39m([34m4[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m237| [39m      [34mexpect[39m(result[33m.[39mdecision)[33m.[39m[34mtoBe[39m([32m"APPROVED"[39m)[33m;[39m
    [90m238| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould require min 2 votes and weight 6 for HIGH_RISK
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m258:33[22m[39m
    [90m256| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mcheckConsensus[39m([32m"queue-1"[39m)[33m;[39m
    [90m257| [39m
    [90m258| [39m      [34mexpect[39m(result[33m.[39mquorum_met)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m259| [39m      [34mexpect[39m(result[33m.[39mtotal_weight)[33m.[39m[34mtoBe[39m([34m4[39m)[33m;[39m
    [90m260| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mQuorum Rules by Risk Level[2m > [22mshould meet HIGH_RISK quorum with OWNER vote
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m279:33[22m[39m
    [90m277| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mcheckConsensus[39m([32m"queue-1"[39m)[33m;[39m
    [90m278| [39m
    [90m279| [39m      [34mexpect[39m(result[33m.[39mquorum_met)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m280| [39m      [34mexpect[39m(result[33m.[39mdecision)[33m.[39m[34mtoBe[39m([32m"APPROVED"[39m)[33m;[39m
    [90m281| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould approve when all votes are APPROVE
[31m[1mAssertionError[22m: expected undefined to be 'APPROVED' // Object.is equality[39m

[32m- Expected:[39m 
"APPROVED"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m303:31[22m[39m
    [90m301| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mcheckConsensus[39m([32m"queue-1"[39m)[33m;[39m
    [90m302| [39m
    [90m303| [39m      [34mexpect[39m(result[33m.[39mdecision)[33m.[39m[34mtoBe[39m([32m"APPROVED"[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m304| [39m      [34mexpect[39m(result[33m.[39mapprove_weight)[33m.[39m[34mtoBe[39m([34m12[39m)[33m;[39m
    [90m305| [39m      [34mexpect[39m(result[33m.[39mreject_weight)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould reject when reject weight exceeds approve weight
[31m[1mAssertionError[22m: expected undefined to be 'REJECTED' // Object.is equality[39m

[32m- Expected:[39m 
"REJECTED"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m326:31[22m[39m
    [90m324| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mcheckConsensus[39m([32m"queue-1"[39m)[33m;[39m
    [90m325| [39m
    [90m326| [39m      [34mexpect[39m(result[33m.[39mdecision)[33m.[39m[34mtoBe[39m([32m"REJECTED"[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m327| [39m      [34mexpect[39m(result[33m.[39mreject_weight)[33m.[39m[34mtoBe[39m([34m10[39m)[33m;[39m
    [90m328| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould return PENDING when no votes cast
[31m[1mAssertionError[22m: expected undefined to be 'PENDING' // Object.is equality[39m

[32m- Expected:[39m 
"PENDING"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m343:31[22m[39m
    [90m341| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mcheckConsensus[39m([32m"queue-1"[39m)[33m;[39m
    [90m342| [39m
    [90m343| [39m      [34mexpect[39m(result[33m.[39mdecision)[33m.[39m[34mtoBe[39m([32m"PENDING"[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m344| [39m      [34mexpect[39m(result[33m.[39mquorum_met)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m345| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould handle DEFER votes as neutral
[31m[1mAssertionError[22m: expected undefined to be 1 // Object.is equality[39m

[32m- Expected:[39m 
1

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m366:34[22m[39m
    [90m364| [39m
    [90m365| [39m      [34mexpect[39m(result[33m.[39mapprove_weight)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m366| [39m      [34mexpect[39m(result[33m.[39mdefer_count)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m367| [39m    })[33m;[39m
    [90m368| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConsensus Determination[2m > [22mshould handle ABSTAIN votes
[31m[1mAssertionError[22m: expected undefined to be 1 // Object.is equality[39m

[32m- Expected:[39m 
1

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m387:36[22m[39m
    [90m385| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mcheckConsensus[39m([32m"queue-1"[39m)[33m;[39m
    [90m386| [39m
    [90m387| [39m      [34mexpect[39m(result[33m.[39mabstain_count)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m388| [39m    })[33m;[39m
    [90m389| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould detect CONFLICTING_VOTES between managers
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).order is not a function[39m
[36m [2mâ¯[22m ConsensusService.getVotes src/lib/operator/consensusService.ts:[2m278:8[22m[39m
    [90m276| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m277| [39m      [33m.[39m[34meq[39m([32m"queue_item_id"[39m[33m,[39m queueItemId)
    [90m278| [39m      [33m.[39m[34morder[39m([32m"created_at"[39m[33m,[39m { ascending[33m:[39m [35mtrue[39m })[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m279| [39m
    [90m280| [39m    [35mif[39m (error) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m ConsensusService.detectConflicts src/lib/operator/consensusService.ts:[2m292:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m412:25[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould detect EXPIRED_REVIEW for old pending items
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).order is not a function[39m
[36m [2mâ¯[22m ConsensusService.getVotes src/lib/operator/consensusService.ts:[2m278:8[22m[39m
    [90m276| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m277| [39m      [33m.[39m[34meq[39m([32m"queue_item_id"[39m[33m,[39m queueItemId)
    [90m278| [39m      [33m.[39m[34morder[39m([32m"created_at"[39m[33m,[39m { ascending[33m:[39m [35mtrue[39m })[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m279| [39m
    [90m280| [39m    [35mif[39m (error) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m ConsensusService.detectConflicts src/lib/operator/consensusService.ts:[2m292:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m439:25[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould not flag EXPIRED_REVIEW for recent items
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).order is not a function[39m
[36m [2mâ¯[22m ConsensusService.getVotes src/lib/operator/consensusService.ts:[2m278:8[22m[39m
    [90m276| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m277| [39m      [33m.[39m[34meq[39m([32m"queue_item_id"[39m[33m,[39m queueItemId)
    [90m278| [39m      [33m.[39m[34morder[39m([32m"created_at"[39m[33m,[39m { ascending[33m:[39m [35mtrue[39m })[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m279| [39m
    [90m280| [39m    [35mif[39m (error) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m ConsensusService.detectConflicts src/lib/operator/consensusService.ts:[2m292:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m462:25[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/consensusService.test.ts[2m > [22mConsensusService[2m > [22mConflict Detection[2m > [22mshould detect QUORUM_DEADLOCK with equal weights
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).order is not a function[39m
[36m [2mâ¯[22m ConsensusService.getVotes src/lib/operator/consensusService.ts:[2m278:8[22m[39m
    [90m276| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m277| [39m      [33m.[39m[34meq[39m([32m"queue_item_id"[39m[33m,[39m queueItemId)
    [90m278| [39m      [33m.[39m[34morder[39m([32m"created_at"[39m[33m,[39m { ascending[33m:[39m [35mtrue[39m })[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m279| [39m
    [90m280| [39m    [35mif[39m (error) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m ConsensusService.detectConflicts src/lib/operator/consensusService.ts:[2m292:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/consensusService.test.ts:[2m490:25[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/deltaEngine.test.ts[2m > [22mDeltaEngine - Edge Cases[2m > [22mshould handle zero values without division errors
[31m[1mAssertionError[22m: expected 'STABLE' to be 'IMPROVING' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- IMPROVING[39m
[31m+ STABLE[39m

[36m [2mâ¯[22m src/lib/__tests__/deltaEngine.test.ts:[2m750:34[22m[39m
    [90m748| [39m
    [90m749| [39m    [34mexpect[39m(result[33m.[39mhealth_score_delta[33m.[39mpercentage_change)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m [90m// Ca[39mâ€¦
    [90m750| [39m    [34mexpect[39m(result[33m.[39moverall_trend)[33m.[39m[34mtoBe[39m([32m"IMPROVING"[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m751| [39m  })[33m;[39m
    [90m752| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould execute an approved proposal successfully
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m96:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould reject non-APPROVED proposals
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m114:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould reject when trusted mode is not ACTIVE
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m138:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould enforce daily execution limit
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m170:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould return proposal not found error
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m185:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecuteProposal[2m > [22mshould calculate correct rollback deadline for LOW risk
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m223:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mgetExecutionHistory[2m > [22mshould return execution history with limit
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).order(...).limit is not a function[39m
[36m [2mâ¯[22m ExecutionEngine.getExecutionHistory src/lib/autonomy/executionEngine.ts:[2m493:8[22m[39m
    [90m491| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
    [90m492| [39m      [33m.[39m[34morder[39m([32m"executed_at"[39m[33m,[39m { ascending[33m:[39m [35mfalse[39m })
    [90m493| [39m      [33m.[39m[34mlimit[39m(limit)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m494| [39m
    [90m495| [39m    [35mif[39m (error) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m288:23[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mgetExecutionHistory[2m > [22mshould return empty array on error
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).order(...).limit is not a function[39m
[36m [2mâ¯[22m ExecutionEngine.getExecutionHistory src/lib/autonomy/executionEngine.ts:[2m493:8[22m[39m
    [90m491| [39m      [33m.[39m[34meq[39m([32m"client_id"[39m[33m,[39m clientId)
    [90m492| [39m      [33m.[39m[34morder[39m([32m"executed_at"[39m[33m,[39m { ascending[33m:[39m [35mfalse[39m })
    [90m493| [39m      [33m.[39m[34mlimit[39m(limit)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m494| [39m
    [90m495| [39m    [35mif[39m (error) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m300:23[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22msnapshot handling[2m > [22mshould create before and after snapshots
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m337:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/executionEngine.test.ts[2m > [22mExecutionEngine[2m > [22mexecution window[2m > [22mshould check execution is within allowed time window
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'status')[39m
[36m [2mâ¯[22m ExecutionEngine.executeProposal src/lib/autonomy/executionEngine.ts:[2m56:18[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [90m// Validate proposal is approved[39m
    [90m 56| [39m    [35mif[39m (proposal[33m.[39mstatus [33m!==[39m [32m"APPROVED"[39m) {
    [90m   | [39m                 [31m^[39m
    [90m 57| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Cannot execute proposal in status: [39m[36m${[39mproposal[33m.[39msâ€¦
    [90m 58| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/executionEngine.test.ts:[2m370:35[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Project Financials[2m > [22mshould fetch all project financials
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m106:28[22m[39m
    [90m104| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mgetProjectFinancials[39m([32m'test-org-id'[39m)[33m;[39m
    [90m105| [39m
    [90m106| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m107| [39m    [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(result[33m.[39mdata))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m108| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Project Financials[2m > [22mshould filter by project ID
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m113:28[22m[39m
    [90m111| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mgetProjectFinancials[39m([32m'test-org-id'[39m[33m,[39m [32m'test-pro[39mâ€¦
    [90m112| [39m
    [90m113| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m114| [39m  })[33m;[39m
    [90m115| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Client Billing[2m > [22mshould fetch all client billing summaries
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m121:28[22m[39m
    [90m119| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mgetClientBilling[39m([32m'test-org-id'[39m)[33m;[39m
    [90m120| [39m
    [90m121| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m122| [39m    [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(result[33m.[39mdata))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m123| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Client Billing[2m > [22mshould filter by contact ID
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m128:28[22m[39m
    [90m126| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mgetClientBilling[39m([32m'test-org-id'[39m[33m,[39m [32m'test-contact[39mâ€¦
    [90m127| [39m
    [90m128| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m129| [39m  })[33m;[39m
    [90m130| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - AI Costs[2m > [22mshould aggregate AI costs by provider and model
[31m[1mAssertionError[22m: expected 0 to be greater than 0[39m
[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m173:33[22m[39m
    [90m171| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m172| [39m    [34mexpect[39m(result[33m.[39mdata)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m173| [39m    [34mexpect[39m(result[33m.[39mdata[33m?.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m174| [39m    [34mexpect[39m(result[33m.[39mdata[33m?.[39m[[34m0[39m][33m.[39mtotalRequests)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m175| [39m    [34mexpect[39m(result[33m.[39mdata[33m?.[39m[[34m0[39m][33m.[39mtotalCost)[33m.[39m[34mtoBeCloseTo[39m([34m0.045[39m[33m,[39m [34m3[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - AI Cost Recording[2m > [22mshould record AI cost with correct calculation
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m190:28[22m[39m
    [90m188| [39m    })[33m;[39m
    [90m189| [39m
    [90m190| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m191| [39m    [34mexpect[39m(result[33m.[39mcostId)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m192| [39m    [34mexpect[39m(result[33m.[39mtotalCost)[33m.[39m[34mtoBeCloseTo[39m([34m0.015[39m[33m,[39m [34m3[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - AI Cost Recording[2m > [22mshould include cache tokens in cost calculation
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m206:28[22m[39m
    [90m204| [39m    })[33m;[39m
    [90m205| [39m
    [90m206| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m207| [39m  })[33m;[39m
    [90m208| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/financialReportEngine.test.ts[2m > [22mFinancial Report Engine - Materialized Views[2m > [22mshould refresh materialized views successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/financialReportEngine.test.ts:[2m214:28[22m[39m
    [90m212| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mrefreshFinancialReports[39m()[33m;[39m
    [90m213| [39m
    [90m214| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m215| [39m  })[33m;[39m
    [90m216| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould return ALLOW when no rules match
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m67:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[81/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould apply BLOCK action when rule conditions match
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m113:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[82/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould apply REQUIRE_QUORUM action with quorum size
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m155:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[83/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould collect coaching hints from COACHING rules
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m200:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[84/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould apply more restrictive action between multiple rules
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m252:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[85/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mGuardrail Evaluation[2m > [22mshould set sandboxOnly when in sandbox mode
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m268:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[86/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould match operator_score < threshold
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m312:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[87/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould not match when operator_score >= threshold
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m354:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[88/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould match domain condition
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m395:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[89/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCondition Evaluation[2m > [22mshould not match when domain differs
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m436:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[90/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould simulate EMAIL_SEND execution
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.runSandboxSimulation src/lib/operator/guardrailPolicyService.ts:[2m347:8[22m[39m
    [90m345| [39m    [90m// Record simulation[39m
    [90m346| [39m    [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m347| [39m      [33m.[39m[35mfrom[39m([32m"sandbox_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m348| [39m      [33m.[39m[34minsert[39m({
    [90m349| [39m        organization_id[33m:[39m organizationId[33m,[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m457:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[91/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould fail EMAIL_SEND simulation when missing fields
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.runSandboxSimulation src/lib/operator/guardrailPolicyService.ts:[2m347:8[22m[39m
    [90m345| [39m    [90m// Record simulation[39m
    [90m346| [39m    [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m347| [39m      [33m.[39m[35mfrom[39m([32m"sandbox_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m348| [39m      [33m.[39m[34minsert[39m({
    [90m349| [39m        organization_id[33m:[39m organizationId[33m,[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m483:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[92/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould simulate CONTENT_PUBLISH with warnings
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.runSandboxSimulation src/lib/operator/guardrailPolicyService.ts:[2m347:8[22m[39m
    [90m345| [39m    [90m// Record simulation[39m
    [90m346| [39m    [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m347| [39m      [33m.[39m[35mfrom[39m([32m"sandbox_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m348| [39m      [33m.[39m[34minsert[39m({
    [90m349| [39m        organization_id[33m:[39m organizationId[33m,[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m507:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[93/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox Simulation[2m > [22mshould simulate DATA_UPDATE execution
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.runSandboxSimulation src/lib/operator/guardrailPolicyService.ts:[2m347:8[22m[39m
    [90m345| [39m    [90m// Record simulation[39m
    [90m346| [39m    [35mconst[39m { data[33m,[39m error } [33m=[39m [35mawait[39m supabase
    [90m347| [39m      [33m.[39m[35mfrom[39m([32m"sandbox_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m348| [39m      [33m.[39m[34minsert[39m({
    [90m349| [39m        organization_id[33m:[39m organizationId[33m,[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m533:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[94/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCoaching Hints[2m > [22mshould record coaching hints when shown
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getCoachingHints src/lib/operator/guardrailPolicyService.ts:[2m472:8[22m[39m
    [90m470| [39m    [35mconst[39m supabase [33m=[39m [35mawait[39m [34mgetSupabaseServer[39m()[33m;[39m
    [90m471| [39m    [35mconst[39m { data[33m:[39m score } [33m=[39m [35mawait[39m supabase
    [90m472| [39m      [33m.[39m[35mfrom[39m([32m"reviewer_scores"[39m)
    [90m   | [39m       [31m^[39m
    [90m473| [39m      [33m.[39m[34mselect[39m([32m"reliability_score, accuracy_score"[39m)
    [90m474| [39m      [33m.[39m[34meq[39m([32m"operator_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m561:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[95/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mCoaching Hints[2m > [22mshould record hint feedback
[31m[1mAssertionError[22m: promise rejected "TypeError: supabase.from is not a function" instead of resolving[39m
[36m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m577:7[22m[39m
    [90m575| [39m      [35mawait[39m [34mexpect[39m(
    [90m576| [39m        service[33m.[39m[34mrecordHintFeedback[39m([32m"hint-1"[39m[33m,[39m [35mtrue[39m[33m,[39m [32m"Very helpful!"[39m)
    [90m577| [39m      )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m578| [39m    })[33m;[39m
    [90m579| [39m  })[33m;[39m

[31m[1mCaused by: TypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.recordHintFeedback src/lib/operator/guardrailPolicyService.ts:[2m518:8[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m575:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[96/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox History[2m > [22mshould fetch sandbox history for organization
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getSandboxHistory src/lib/operator/guardrailPolicyService.ts:[2m539:8[22m[39m
    [90m537| [39m
    [90m538| [39m    [35mlet[39m query [33m=[39m supabase
    [90m539| [39m      [33m.[39m[35mfrom[39m([32m"sandbox_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m540| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m541| [39m      [33m.[39m[34meq[39m([32m"organization_id"[39m[33m,[39m organizationId)
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m597:23[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[97/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mSandbox History[2m > [22mshould filter history by operator
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getSandboxHistory src/lib/operator/guardrailPolicyService.ts:[2m539:8[22m[39m
    [90m537| [39m
    [90m538| [39m    [35mlet[39m query [33m=[39m supabase
    [90m539| [39m      [33m.[39m[35mfrom[39m([32m"sandbox_executions"[39m)
    [90m   | [39m       [31m^[39m
    [90m540| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m541| [39m      [33m.[39m[34meq[39m([32m"organization_id"[39m[33m,[39m organizationId)
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m609:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[98/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/guardrailPolicyService.test.ts[2m > [22mGuardrailPolicyService[2m > [22mRule Precedence[2m > [22mshould skip inactive rules
[31m[1mTypeError[22m: supabase.from is not a function[39m
[36m [2mâ¯[22m GuardrailPolicyService.getApplicableRules src/lib/operator/guardrailPolicyService.ts:[2m183:8[22m[39m
    [90m181| [39m    [90m// Get operator's role[39m
    [90m182| [39m    [35mconst[39m { data[33m:[39m profile } [33m=[39m [35mawait[39m supabase
    [90m183| [39m      [33m.[39m[35mfrom[39m([32m"operator_profiles"[39m)
    [90m   | [39m       [31m^[39m
    [90m184| [39m      [33m.[39m[34mselect[39m([32m"role"[39m)
    [90m185| [39m      [33m.[39m[34meq[39m([32m"user_id"[39m[33m,[39m operatorId)
[90m [2mâ¯[22m GuardrailPolicyService.evaluateGuardrails src/lib/operator/guardrailPolicyService.ts:[2m84:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/guardrailPolicyService.test.ts:[2m648:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[99/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mcreatePlan[2m > [22mshould create a horizon plan with correct defaults
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mcreatePlan[2m > [22mshould handle custom horizon type with specified days
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 30 days for SHORT horizon
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 60 days for MEDIUM horizon
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 90 days for LONG horizon
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mhorizon type days calculation[2m > [22mshould return 90 days for QUARTERLY horizon
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mgeneratePlan[2m > [22mshould generate steps for all priority domains
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mLongHorizonPlannerService[2m > [22mresolveDependencies[2m > [22mshould identify critical path
[31m[1mError[22m: Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[36m [2mâ¯[22m src/lib/__tests__/horizonPlanning.test.ts:[2m63:35[22m[39m
    [90m 61| [39m    }[33m;[39m
    [90m 62| [39m
    [90m 63| [39m    [35mconst[39m { getSupabaseServer } [33m=[39m [34mrequire[39m([32m'@/lib/supabase'[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m 64| [39m    getSupabaseServer[33m.[39m[34mmockResolvedValue[39m(mockSupabase)[33m;[39m
    [90m 65| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'MODULE_NOT_FOUND', requireStack: [ 'D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts' ] }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[100/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcreateSnapshot[2m > [22mshould create snapshot with calculated change percent
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcalculateTrend[2m > [22mshould return UP for positive change > 5%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcalculateTrend[2m > [22mshould return DOWN for negative change < -5%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mcalculateTrend[2m > [22mshould return STABLE for change between -5% and 5%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould return all definitions when no domain specified
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould filter definitions by domain
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould include expected SEO metrics
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetKPIDefinitions[2m > [22mshould include expected CRO metrics
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mgetDomainSummary[2m > [22mshould calculate overall score and health status
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/horizonPlanning.test.ts[2m > [22mKPITrackingService[2m > [22mprojectKPIs[2m > [22mshould generate projections for specified number of days
[31m[1mError[22m: Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts[39m
[36m [2mâ¯[22m src/lib/__tests__/horizonPlanning.test.ts:[2m203:35[22m[39m
    [90m201| [39m    }[33m;[39m
    [90m202| [39m
    [90m203| [39m    [35mconst[39m { getSupabaseServer } [33m=[39m [34mrequire[39m([32m'@/lib/supabase'[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m204| [39m    getSupabaseServer[33m.[39m[34mmockResolvedValue[39m(mockSupabase)[33m;[39m
    [90m205| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'MODULE_NOT_FOUND', requireStack: [ 'D:\Unite-Hub\src\lib\__tests__\horizonPlanning.test.ts' ] }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[101/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould generate valid JSON-LD schema
[31m[1mTypeError[22m: fabricator.generateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m182:33[22m[39m
    [90m180| [39m      }[33m;[39m
    [90m181| [39m
    [90m182| [39m      [35mconst[39m schema [33m=[39m fabricator[33m.[39m[34mgenerateSchema[39m(input)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m183| [39m
    [90m184| [39m      [34mexpect[39m(schema[[32m'@context'[39m])[33m.[39m[34mtoBe[39m([32m'https://schema.org'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[102/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould map entity types correctly
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'call')[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m192:22[22m[39m
    [90m190| [39m    [34mit[39m([32m'should map entity types correctly'[39m[33m,[39m () [33m=>[39m {
    [90m191| [39m      [35mconst[39m mapping [33m=[39m (fabricator [35mas[39m any)[33m.[39mmapEntityTypeToSchema[33m;[39m
    [90m192| [39m      [34mexpect[39m(mapping[33m.[39m[34mcall[39m(fabricator[33m,[39m [32m'brand'[39m))[33m.[39m[34mtoBe[39m([32m'Brand'[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m193| [39m      [34mexpect[39m(mapping[33m.[39m[34mcall[39m(fabricator[33m,[39m [32m'person'[39m))[33m.[39m[34mtoBe[39m([32m'Person'[39m)[33m;[39m
    [90m194| [39m      [34mexpect[39m(mapping[33m.[39m[34mcall[39m(fabricator[33m,[39m [32m'product'[39m))[33m.[39m[34mtoBe[39m([32m'Product'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[103/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould include @id for canonical URL
[31m[1mTypeError[22m: fabricator.generateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m215:33[22m[39m
    [90m213| [39m      }[33m;[39m
    [90m214| [39m
    [90m215| [39m      [35mconst[39m schema [33m=[39m fabricator[33m.[39m[34mgenerateSchema[39m(input)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m216| [39m      [34mexpect[39m(schema[[32m'@id'[39m])[33m.[39m[34mtoBe[39m([32m'https://example.com/page'[39m)[33m;[39m
    [90m217| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[104/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Generation[2m > [22mshould add type-specific properties for organization
[31m[1mTypeError[22m: fabricator.generateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m245:33[22m[39m
    [90m243| [39m      }[33m;[39m
    [90m244| [39m
    [90m245| [39m      [35mconst[39m schema [33m=[39m fabricator[33m.[39m[34mgenerateSchema[39m(input)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m246| [39m      [34mexpect[39m(schema[33m.[39memail)[33m.[39m[34mtoBe[39m([32m'test@test.com'[39m)[33m;[39m
    [90m247| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[105/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould validate complete schema
[31m[1mTypeError[22m: fabricator.validateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m261:33[22m[39m
    [90m259| [39m      }[33m;[39m
    [90m260| [39m
    [90m261| [39m      [35mconst[39m result [33m=[39m fabricator[33m.[39m[34mvalidateSchema[39m(schema)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m262| [39m      [34mexpect[39m(result[33m.[39mvalid)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m263| [39m      [34mexpect[39m(result[33m.[39merrors)[33m.[39m[34mtoEqual[39m([])[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[106/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould detect missing @context
[31m[1mTypeError[22m: fabricator.validateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m272:33[22m[39m
    [90m270| [39m      } [35mas[39m any[33m;[39m
    [90m271| [39m
    [90m272| [39m      [35mconst[39m result [33m=[39m fabricator[33m.[39m[34mvalidateSchema[39m(schema)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m273| [39m      [34mexpect[39m(result[33m.[39mvalid)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m274| [39m      [34mexpect[39m(result[33m.[39merrors)[33m.[39m[34mtoContain[39m([32m'Missing @context'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[107/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould detect missing name
[31m[1mTypeError[22m: fabricator.validateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m283:33[22m[39m
    [90m281| [39m      } [35mas[39m any[33m;[39m
    [90m282| [39m
    [90m283| [39m      [35mconst[39m result [33m=[39m fabricator[33m.[39m[34mvalidateSchema[39m(schema)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m284| [39m      [34mexpect[39m(result[33m.[39mvalid)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m285| [39m      [34mexpect[39m(result[33m.[39merrors)[33m.[39m[34mtoContain[39m([32m'Missing name'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[108/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould detect invalid URL
[31m[1mTypeError[22m: fabricator.validateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m296:33[22m[39m
    [90m294| [39m      }[33m;[39m
    [90m295| [39m
    [90m296| [39m      [35mconst[39m result [33m=[39m fabricator[33m.[39m[34mvalidateSchema[39m(schema)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m297| [39m      [34mexpect[39m(result[33m.[39mvalid)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m298| [39m      [34mexpect[39m(result[33m.[39merrors)[33m.[39m[34mtoContain[39m([32m'Invalid url format'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[109/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mSchema Validation[2m > [22mshould validate sameAs URLs
[31m[1mTypeError[22m: fabricator.validateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m309:33[22m[39m
    [90m307| [39m      }[33m;[39m
    [90m308| [39m
    [90m309| [39m      [35mconst[39m result [33m=[39m fabricator[33m.[39m[34mvalidateSchema[39m(schema)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m310| [39m      [34mexpect[39m(result[33m.[39mvalid)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m311| [39m      [34mexpect[39m(result[33m.[39merrors[33m.[39m[34msome[39m(e [33m=>[39m e[33m.[39m[34mincludes[39m([32m'sameAs'[39m)))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[110/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mHTML Generation[2m > [22mshould generate HTML with title
[31m[1mTypeError[22m: fabricator.generateSchema is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m335:33[22m[39m
    [90m333| [39m      }[33m;[39m
    [90m334| [39m
    [90m335| [39m      [35mconst[39m schema [33m=[39m fabricator[33m.[39m[34mgenerateSchema[39m(input)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m336| [39m      [35mconst[39m html [33m=[39m (fabricator [35mas[39m any)[33m.[39m[34mgenerateHTMLTemplate[39m(input[33m,[39m schâ€¦
    [90m337| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[111/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/leviathan.test.ts[2m > [22mFabricatorService[2m > [22mHTML Generation[2m > [22mshould escape HTML entities
[31m[1mTypeError[22m: fabricator.escapeHtml is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/leviathan.test.ts:[2m343:43[22m[39m
    [90m341| [39m
    [90m342| [39m    [34mit[39m([32m'should escape HTML entities'[39m[33m,[39m () [33m=>[39m {
    [90m343| [39m      [35mconst[39m escaped [33m=[39m (fabricator [35mas[39m any)[33m.[39m[34mescapeHtml[39m([32m'<script>alert("x[39mâ€¦
    [90m   | [39m                                          [31m^[39m
    [90m344| [39m      [34mexpect[39m(escaped)[33m.[39mnot[33m.[39m[34mtoContain[39m([32m'<script>'[39m)[33m;[39m
    [90m345| [39m      [34mexpect[39m(escaped)[33m.[39m[34mtoContain[39m([32m'&lt;script&gt;'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[112/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mOutcome Recording[2m > [22mshould update outcome and trigger score recalculation
[31m[1mAssertionError[22m: promise rejected "TypeError: supabase.from(...).select(...)â€¦" instead of resolving[39m
[36m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m185:7[22m[39m
    [90m183| [39m      [35mawait[39m [34mexpect[39m(
    [90m184| [39m        service[33m.[39m[34mrecordOutcome[39m([32m"rec-1"[39m[33m,[39m [32m"CORRECT"[39m[33m,[39m [32m"Good decision"[39m)
    [90m185| [39m      )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m186| [39m    })[33m;[39m
    [90m187| [39m

[31m[1mCaused by: TypeError[22m: supabase.from(...).select(...).eq(...).single is not a function[39m
[36m [2mâ¯[22m OperatorInsightsService.recordOutcome src/lib/operator/operatorInsightsService.ts:[2m189:8[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m183:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[113/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mOutcome Recording[2m > [22mshould log DECISION_OVERTURNED event for overturned outcomes
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).single is not a function[39m
[36m [2mâ¯[22m OperatorInsightsService.recordOutcome src/lib/operator/operatorInsightsService.ts:[2m189:8[22m[39m
    [90m187| [39m      [33m.[39m[34mselect[39m([32m"operator_id, organization_id, decision"[39m)
    [90m188| [39m      [33m.[39m[34meq[39m([32m"id"[39m[33m,[39m recordId)
    [90m189| [39m      [33m.[39m[34msingle[39m()[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m190| [39m
    [90m191| [39m    [35mif[39m (fetchError) {
[90m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m202:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[114/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mDecay-Weighted Scoring[2m > [22mshould create default scores for operators with no history
[31m[1mAssertionError[22m: expected undefined to be +0 // Object.is equality[39m

[32m- Expected:[39m 
0

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m285:36[22m[39m
    [90m283| [39m
    [90m284| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mupdateReviewerScores[39m([32m"op-1"[39m[33m,[39m [32m"org-1[39mâ€¦
    [90m285| [39m      [34mexpect[39m(result[33m.[39mtotal_reviews)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m286| [39m      [34mexpect[39m(result[33m.[39mreliability_score)[33m.[39m[34mtoBe[39m([34m50[39m)[33m;[39m
    [90m287| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[115/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould detect APPROVAL_BIAS when approval rate exceeds 85%
[31m[1mError[22m: Failed to update bias signal: undefined[39m
[36m [2mâ¯[22m OperatorInsightsService.createBiasSignal src/lib/operator/operatorInsightsService.ts:[2m551:15[22m[39m
    [90m549| [39m
    [90m550| [39m      [35mif[39m (error) {
    [90m551| [39m        [35mthrow[39m [35mnew[39m [33mError[39m([32m`Failed to update bias signal: [39m[36m${[39merror[33m.[39mmessageâ€¦
    [90m   | [39m              [31m^[39m
    [90m552| [39m      }
    [90m553| [39m      [35mreturn[39m data[33m;[39m
[90m [2mâ¯[22m OperatorInsightsService.detectBiases src/lib/operator/operatorInsightsService.ts:[2m439:22[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m321:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[116/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould detect REJECTION_BIAS when rejection rate exceeds 85%
[31m[1mError[22m: Failed to update bias signal: undefined[39m
[36m [2mâ¯[22m OperatorInsightsService.createBiasSignal src/lib/operator/operatorInsightsService.ts:[2m551:15[22m[39m
    [90m549| [39m
    [90m550| [39m      [35mif[39m (error) {
    [90m551| [39m        [35mthrow[39m [35mnew[39m [33mError[39m([32m`Failed to update bias signal: [39m[36m${[39merror[33m.[39mmessageâ€¦
    [90m   | [39m              [31m^[39m
    [90m552| [39m      }
    [90m553| [39m      [35mreturn[39m data[33m;[39m
[90m [2mâ¯[22m OperatorInsightsService.detectBiases src/lib/operator/operatorInsightsService.ts:[2m453:22[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m355:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[117/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould detect SPEED_BIAS when avg review time under 30 seconds
[31m[1mError[22m: Failed to update bias signal: undefined[39m
[36m [2mâ¯[22m OperatorInsightsService.createBiasSignal src/lib/operator/operatorInsightsService.ts:[2m551:15[22m[39m
    [90m549| [39m
    [90m550| [39m      [35mif[39m (error) {
    [90m551| [39m        [35mthrow[39m [35mnew[39m [33mError[39m([32m`Failed to update bias signal: [39m[36m${[39merror[33m.[39mmessageâ€¦
    [90m   | [39m              [31m^[39m
    [90m552| [39m      }
    [90m553| [39m      [35mreturn[39m data[33m;[39m
[90m [2mâ¯[22m OperatorInsightsService.detectBiases src/lib/operator/operatorInsightsService.ts:[2m439:22[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m398:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[118/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorInsightsService.test.ts[2m > [22mOperatorInsightsService[2m > [22mBias Detection[2m > [22mshould not detect biases with insufficient review history
[31m[1mAssertionError[22m: expected [ Array(2) ] to have a length of +0 but got 2[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 0[39m
[31m+ 2[39m

[36m [2mâ¯[22m src/lib/__tests__/operatorInsightsService.test.ts:[2m419:22[22m[39m
    [90m417| [39m
    [90m418| [39m      [35mconst[39m biases [33m=[39m [35mawait[39m service[33m.[39m[34mdetectBiases[39m([32m"op-1"[39m[33m,[39m [32m"org-1"[39m)[33m;[39m
    [90m419| [39m      [34mexpect[39m(biases)[33m.[39m[34mtoHaveLength[39m([34m0[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m420| [39m    })[33m;[39m
    [90m421| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[119/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorRoleService.test.ts[2m > [22mOperatorRoleService[2m > [22mgetApproversForRisk[2m > [22mshould return operators who can approve LOW risk
[31m[1mTypeError[22m: query.eq is not a function[39m
[36m [2mâ¯[22m OperatorRoleService.getApproversForRisk src/lib/operator/operatorRoleService.ts:[2m342:23[22m[39m
    [90m340| [39m    [35mswitch[39m (riskLevel) {
    [90m341| [39m      [35mcase[39m [32m"LOW"[39m[33m:[39m
    [90m342| [39m        query [33m=[39m query[33m.[39m[34meq[39m([32m"can_approve_low"[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m   | [39m                      [31m^[39m
    [90m343| [39m        [35mbreak[39m[33m;[39m
    [90m344| [39m      [35mcase[39m [32m"MEDIUM"[39m[33m:[39m
[90m [2mâ¯[22m src/lib/__tests__/operatorRoleService.test.ts:[2m413:25[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[120/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/operatorRoleService.test.ts[2m > [22mOperatorRoleService[2m > [22mgetApproversForRisk[2m > [22mshould filter by HIGH risk permission
[31m[1mTypeError[22m: query.eq is not a function[39m
[36m [2mâ¯[22m OperatorRoleService.getApproversForRisk src/lib/operator/operatorRoleService.ts:[2m348:23[22m[39m
    [90m346| [39m        [35mbreak[39m[33m;[39m
    [90m347| [39m      [35mcase[39m [32m"HIGH"[39m[33m:[39m
    [90m348| [39m        query [33m=[39m query[33m.[39m[34meq[39m([32m"can_approve_high"[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m   | [39m                      [31m^[39m
    [90m349| [39m        [35mbreak[39m[33m;[39m
    [90m350| [39m    }
[90m [2mâ¯[22m src/lib/__tests__/operatorRoleService.test.ts:[2m426:25[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[121/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/projectCreator.test.ts[2m > [22mprojectCreator[2m > [22mcreateProjectFromProposal[2m > [22mshould create project with correct metadata
[31m[1mAssertionError[22m: expected 'Restaurant Management App - Better Paâ€¦' to be 'Restaurant Management App - Better Paâ€¦' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Restaurant Management App - Better Package[39m
[31m+ Restaurant Management App - Better Package Package[39m

[36m [2mâ¯[22m src/lib/__tests__/projectCreator.test.ts:[2m69:28[22m[39m
    [90m 67| [39m
    [90m 68| [39m      [34mexpect[39m(project[33m.[39mid)[33m.[39m[34mtoMatch[39m([36m/^proj-/[39m)[33m;[39m
    [90m 69| [39m      [34mexpect[39m(project[33m.[39mname)[33m.[39m[34mtoBe[39m([32m'Restaurant Management App - Better Pa[39mâ€¦
    [90m   | [39m                           [31m^[39m
    [90m 70| [39m      [34mexpect[39m(project[33m.[39mdescription)[33m.[39m[34mtoBe[39m([32m'Complete restaurant management[39mâ€¦
    [90m 71| [39m      [34mexpect[39m(project[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'active'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[122/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/projectCreator.test.ts[2m > [22mprojectCreator[2m > [22mTask Generation - With Deliverables[2m > [22mshould set task priorities
[31m[1mAssertionError[22m: expected 'high' to be 'medium' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- medium[39m
[31m+ high[39m

[36m [2mâ¯[22m src/lib/__tests__/projectCreator.test.ts:[2m155:41[22m[39m
    [90m153| [39m
    [90m154| [39m      [90m// Middle tasks should be medium[39m
    [90m155| [39m      [34mexpect[39m(project[33m.[39mtasks[[34m1[39m][33m.[39mpriority)[33m.[39m[34mtoBe[39m([32m'medium'[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m156| [39m      [34mexpect[39m(project[33m.[39mtasks[[34m2[39m][33m.[39mpriority)[33m.[39m[34mtoBe[39m([32m'medium'[39m)[33m;[39m
    [90m157| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[123/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectsForClient[2m > [22mshould fetch projects successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/projectService.test.ts:[2m157:30[22m[39m
    [90m155| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetProjectsForClient[39m(params)[33m;[39m
    [90m156| [39m
    [90m157| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m158| [39m      [34mexpect[39m(result[33m.[39mprojects)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m159| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(result[33m.[39mprojects))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[124/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectsForClient[2m > [22mshould filter by status
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/projectService.test.ts:[2m183:30[22m[39m
    [90m181| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetProjectsForClient[39m(params)[33m;[39m
    [90m182| [39m
    [90m183| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m184| [39m      [90m// All projects should have 'active' status if filtering works[39m
    [90m185| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[125/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectsForClient[2m > [22mshould respect limit parameter
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/projectService.test.ts:[2m196:30[22m[39m
    [90m194| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetProjectsForClient[39m(params)[33m;[39m
    [90m195| [39m
    [90m196| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m197| [39m      [34mexpect[39m(result[33m.[39mprojects)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m198| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[126/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22mgetProjectById[2m > [22mshould fetch project details successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/projectService.test.ts:[2m205:30[22m[39m
    [90m203| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetProjectById[39m([32m'proj-123'[39m[33m,[39m [32m'org-uuid-123'[39m)[33m;[39m
    [90m204| [39m
    [90m205| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m206| [39m      [34mexpect[39m(result[33m.[39mproject)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m207| [39m      [34mexpect[39m(result[33m.[39mproject[33m?.[39mid)[33m.[39m[34mtoBe[39m([32m'proj-123'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[127/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/projectService.test.ts[2m > [22mprojectService[2m > [22massignStaff[2m > [22mshould validate role
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2mâ¯[22m src/lib/__tests__/projectService.test.ts:[2m264:30[22m[39m
    [90m262| [39m
    [90m263| [39m      [90m// Should fail validation or return error[39m
    [90m264| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m265| [39m    })[33m;[39m
    [90m266| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[128/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject when change type is forbidden
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m513:19[22m[39m
    [90m511| [39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m54:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[129/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject ADS domain budget changes
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m513:19[22m[39m
    [90m511| [39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m68:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[130/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject CRO domain mass deletes
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m513:19[22m[39m
    [90m511| [39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m82:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[131/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould reject CONTENT domain major schema changes
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m513:19[22m[39m
    [90m511| [39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m93:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[132/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mvalidateProposal[2m > [22mshould validate allowed change types
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m TrustModeService.isChangeAllowed src/lib/trust/trustModeService.ts:[2m513:19[22m[39m
    [90m511| [39m
    [90m512| [39m    [90m// Check trusted mode status[39m
    [90m513| [39m    [35mconst[39m { data[33m:[39m request } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m514| [39m      [33m.[39m[35mfrom[39m([32m"trusted_mode_requests"[39m)
    [90m515| [39m      [33m.[39m[34mselect[39m([32m"status"[39m)
[90m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m138:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m104:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[133/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould create a proposal with calculated risk level
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m158:19[22m[39m
    [90m156| [39m    [90m// Check if risk level is within allowed limits[39m
    [90m157| [39m    [35mconst[39m supabase [33m=[39m [35mawait[39m [34mgetSupabaseServer[39m()[33m;[39m
    [90m158| [39m    [35mconst[39m { data[33m:[39m scopes } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m159| [39m      [33m.[39m[35mfrom[39m([32m"autonomy_scopes"[39m)
    [90m160| [39m      [33m.[39m[34mselect[39m([32m"max_risk_level_allowed"[39m)
[90m [2mâ¯[22m ProposalEngine.createProposal src/lib/autonomy/proposalEngine.ts:[2m64:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m133:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[134/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould auto-approve LOW risk proposals with ACTIVE trust
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m158:19[22m[39m
    [90m156| [39m    [90m// Check if risk level is within allowed limits[39m
    [90m157| [39m    [35mconst[39m supabase [33m=[39m [35mawait[39m [34mgetSupabaseServer[39m()[33m;[39m
    [90m158| [39m    [35mconst[39m { data[33m:[39m scopes } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m159| [39m      [33m.[39m[35mfrom[39m([32m"autonomy_scopes"[39m)
    [90m160| [39m      [33m.[39m[34mselect[39m([32m"max_risk_level_allowed"[39m)
[90m [2mâ¯[22m ProposalEngine.createProposal src/lib/autonomy/proposalEngine.ts:[2m64:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m162:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[135/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould set PENDING for MEDIUM/HIGH risk with approval
[31m[1mTypeError[22m: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m ProposalEngine.validateProposal src/lib/autonomy/proposalEngine.ts:[2m158:19[22m[39m
    [90m156| [39m    [90m// Check if risk level is within allowed limits[39m
    [90m157| [39m    [35mconst[39m supabase [33m=[39m [35mawait[39m [34mgetSupabaseServer[39m()[33m;[39m
    [90m158| [39m    [35mconst[39m { data[33m:[39m scopes } [33m=[39m [35mawait[39m supabase
    [90m   | [39m                  [31m^[39m
    [90m159| [39m      [33m.[39m[35mfrom[39m([32m"autonomy_scopes"[39m)
    [90m160| [39m      [33m.[39m[34mselect[39m([32m"max_risk_level_allowed"[39m)
[90m [2mâ¯[22m ProposalEngine.createProposal src/lib/autonomy/proposalEngine.ts:[2m64:24[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m190:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[136/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould throw error for invalid change type
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Validation failed' but got 'Cannot destructure property \'data\' â€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Validation failed[39m
[31m+ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m

[36m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m204:7[22m[39m
    [90m202| [39m
    [90m203| [39m    [34mit[39m([32m"should throw error for invalid change type"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m204| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m205| [39m        engine[33m.[39m[34mcreateProposal[39m({
    [90m206| [39m          client_id[33m:[39m [32m"client-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[137/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mcreateProposal[2m > [22mshould require ACTIVE trusted mode for proposals
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Trusted mode not active' but got 'Cannot destructure property \'data\' â€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Trusted mode not active[39m
[31m+ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m

[36m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m223:7[22m[39m
    [90m221| [39m      })[33m;[39m
    [90m222| [39m
    [90m223| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m224| [39m        engine[33m.[39m[34mcreateProposal[39m({
    [90m225| [39m          client_id[33m:[39m [32m"client-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[138/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mapproveProposal[2m > [22mshould throw error for non-PENDING proposal
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Only PENDING proposals can be approved' but got 'Cannot approve proposal in status: APâ€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Only PENDING proposals can be approved[39m
[31m+ Cannot approve proposal in status: APPROVED[39m

[36m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m265:7[22m[39m
    [90m263| [39m      })[33m;[39m
    [90m264| [39m
    [90m265| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m266| [39m        engine[33m.[39m[34mapproveProposal[39m([32m"proposal-uuid"[39m[33m,[39m [32m"admin-uuid"[39m)
    [90m267| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([32m"Only PENDING proposals can be approved"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[139/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mrejectProposal[2m > [22mshould throw error for non-PENDING proposal
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Only PENDING proposals can be rejected' but got 'Cannot destructure property \'data\' â€¦'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Only PENDING proposals can be rejected[39m
[31m+ Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m

[36m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m309:7[22m[39m
    [90m307| [39m      })[33m;[39m
    [90m308| [39m
    [90m309| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m310| [39m        engine[33m.[39m[34mrejectProposal[39m([32m"proposal-uuid"[39m[33m,[39m [32m"admin-uuid"[39m[33m,[39m [32m"Reason"[39m)
    [90m311| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([32m"Only PENDING proposals can be rejected"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[140/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mgenerateFromDelta[2m > [22mshould create proposals from delta changes
[31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 0[39m

[36m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m357:25[22m[39m
    [90m355| [39m      )[33m;[39m
    [90m356| [39m
    [90m357| [39m      [34mexpect[39m(proposals)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m358| [39m    })[33m;[39m
    [90m359| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[141/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mrisk assessment[2m > [22mshould assess HIGH risk for robots.txt changes
[31m[1mError[22m: Proposal validation failed: undefined autonomy is not enabled[39m
[36m [2mâ¯[22m ProposalEngine.createProposal src/lib/autonomy/proposalEngine.ts:[2m67:13[22m[39m
    [90m 65| [39m
    [90m 66| [39m    [35mif[39m ([33m![39mvalidation[33m.[39mvalid) {
    [90m 67| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Proposal validation failed: [39m[36m${[39mvalidation[33m.[39merrorsâ€¦
    [90m   | [39m            [31m^[39m
    [90m 68| [39m    }
    [90m 69| [39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m370:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[142/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mrisk assessment[2m > [22mshould assess MEDIUM risk for large diffs
[31m[1mError[22m: Proposal validation failed: undefined autonomy is not enabled[39m
[36m [2mâ¯[22m ProposalEngine.createProposal src/lib/autonomy/proposalEngine.ts:[2m67:13[22m[39m
    [90m 65| [39m
    [90m 66| [39m    [35mif[39m ([33m![39mvalidation[33m.[39mvalid) {
    [90m 67| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`Proposal validation failed: [39m[36m${[39mvalidation[33m.[39merrorsâ€¦
    [90m   | [39m            [31m^[39m
    [90m 68| [39m    }
    [90m 69| [39m
[90m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m393:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[143/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mgetProposalsByStatus[2m > [22mshould return proposals filtered by status
[31m[1mTypeError[22m: engine.getProposalsByStatus is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m417:38[22m[39m
    [90m415| [39m      })[33m;[39m
    [90m416| [39m
    [90m417| [39m      [35mconst[39m proposals [33m=[39m [35mawait[39m engine[33m.[39m[34mgetProposalsByStatus[39m([32m"client-uuid[39mâ€¦
    [90m   | [39m                                     [31m^[39m
    [90m418| [39m
    [90m419| [39m      [34mexpect[39m(proposals)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[144/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/proposalEngine.test.ts[2m > [22mProposalEngine[2m > [22mgetProposalsByStatus[2m > [22mshould return empty array on error
[31m[1mTypeError[22m: engine.getProposalsByStatus is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/proposalEngine.test.ts:[2m429:38[22m[39m
    [90m427| [39m      })[33m;[39m
    [90m428| [39m
    [90m429| [39m      [35mconst[39m proposals [33m=[39m [35mawait[39m engine[33m.[39m[34mgetProposalsByStatus[39m([32m"client-uuid[39mâ€¦
    [90m   | [39m                                     [31m^[39m
    [90m430| [39m
    [90m431| [39m      [34mexpect[39m(proposals)[33m.[39m[34mtoHaveLength[39m([34m0[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[145/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/rollbackEngine.test.ts[2m > [22mRollbackEngine[2m > [22mreverse diff generation[2m > [22mshould correctly reverse old_value/new_value pairs
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'Reverse diff:', â€¦(1) ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   "Reverse diff:",[90m
[32m-   StringContaining "Original Title",[90m
[31m+   "Applying soft undo for proposal proposal-uuid",[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  Array [[22m
[2m    "Reverse diff:",[22m
[32m-   StringContaining "Original Title",[90m
[31m+   "{[90m
[31m+   \"old_value\": \"New Title\",[90m
[31m+   \"new_value\": \"New Title\"[90m
[31m+ }",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m2[22m
[31m[39m
[36m [2mâ¯[22m src/lib/__tests__/rollbackEngine.test.ts:[2m446:26[22m[39m
    [90m444| [39m
    [90m445| [39m      [90m// Verify reverse diff was logged[39m
    [90m446| [39m      [34mexpect[39m(consoleSpy)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                         [31m^[39m
    [90m447| [39m        [32m"Reverse diff:"[39m[33m,[39m
    [90m448| [39m        expect[33m.[39m[34mstringContaining[39m([32m"Original Title"[39m)

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[146/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mPrompt Generation[2m > [22mshould generate structure check prompt
[31m[1mAssertionError[22m: expected '\nYou are a technical validator ensurâ€¦' to contain 'validate'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- validate[39m
[31m+[39m
[31m+ You are a technical validator ensuring JSON structure compliance.[39m
[31m+[39m
[31m+ **Input Draft:**[39m
[31m+ {"sections": [], "packages": []}[39m
[31m+[39m
[31m+ **Original Idea (for context):**[39m
[31m+ Title: Build a Professional Website[39m
[31m+ Description: I need a modern, responsive website for my consulting business with contact forms and portfolio showcase.[39m
[31m+[39m
[31m+ **Your Task:**[39m
[31m+ 1. Validate JSON structure is correct[39m
[31m+ 2. Ensure all required fields are present[39m
[31m+ 3. Verify Good/Better/Best packages are properly differentiated[39m
[31m+ 4. Fix any structural errors[39m
[31m+ 5. Ensure deliverables are specific and measurable[39m
[31m+[39m
[31m+ **Required Fields:**[39m
[31m+ - sections: array with id, title, description, order[39m
[31m+ - packages: array with tier, label, summary, deliverables, timeline[39m
[31m+[39m
[31m+ **Output:**[39m
[31m+ Return ONLY the corrected JSON structure (no markdown, no explanation).[39m
[31m+ If draft is valid, return it unchanged.[39m
[31m+[39m

[36m [2mâ¯[22m src/lib/__tests__/scopeAI.test.ts:[2m58:22[22m[39m
    [90m 56| [39m
    [90m 57| [39m      [34mexpect[39m(prompt)[33m.[39m[34mtoContain[39m(draftOutput)[33m;[39m
    [90m 58| [39m      [34mexpect[39m(prompt)[33m.[39m[34mtoContain[39m([32m'validate'[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m 59| [39m      [34mexpect[39m(prompt)[33m.[39m[34mtoContain[39m([32m'JSON'[39m)[33m;[39m
    [90m 60| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[147/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mIntegration Tests (requires OPENROUTER_API_KEY)[2m > [22mshould generate complete scope via hybrid pipeline
[31m[1mError[22m: OpenRouter API error (draft_generation): {"error":{"message":"No cookie auth credentials found","code":401}}[39m
[36m [2mâ¯[22m Function.callOpenRouter src/lib/ai/scopeAI.ts:[2m340:13[22m[39m
    [90m338| [39m    [35mif[39m ([33m![39mresponse[33m.[39mok) {
    [90m339| [39m      [35mconst[39m errorText [33m=[39m [35mawait[39m response[33m.[39m[34mtext[39m()[33m;[39m
    [90m340| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`OpenRouter API error ([39m[36m${[39mstage[36m}[39m[32m): [39m[36m${[39merrorText[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m341| [39m    }
    [90m342| [39m
[90m [2mâ¯[22m Function.generateHybridScope src/lib/ai/scopeAI.ts:[2m66:27[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/scopeAI.test.ts:[2m115:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[148/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mIntegration Tests (requires OPENROUTER_API_KEY)[2m > [22mshould track costs for all pipeline stages
[31m[1mError[22m: OpenRouter API error (draft_generation): {"error":{"message":"No cookie auth credentials found","code":401}}[39m
[36m [2mâ¯[22m Function.callOpenRouter src/lib/ai/scopeAI.ts:[2m340:13[22m[39m
    [90m338| [39m    [35mif[39m ([33m![39mresponse[33m.[39mok) {
    [90m339| [39m      [35mconst[39m errorText [33m=[39m [35mawait[39m response[33m.[39m[34mtext[39m()[33m;[39m
    [90m340| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`OpenRouter API error ([39m[36m${[39mstage[36m}[39m[32m): [39m[36m${[39merrorText[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m341| [39m    }
    [90m342| [39m
[90m [2mâ¯[22m Function.generateHybridScope src/lib/ai/scopeAI.ts:[2m66:27[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/scopeAI.test.ts:[2m147:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[149/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/scopeAI.test.ts[2m > [22mScopeAI Hybrid Engine[2m > [22mIntegration Tests (requires OPENROUTER_API_KEY)[2m > [22mshould generate increasing scope for Good â†’ Better â†’ Best
[31m[1mError[22m: OpenRouter API error (draft_generation): {"error":{"message":"No cookie auth credentials found","code":401}}[39m
[36m [2mâ¯[22m Function.callOpenRouter src/lib/ai/scopeAI.ts:[2m340:13[22m[39m
    [90m338| [39m    [35mif[39m ([33m![39mresponse[33m.[39mok) {
    [90m339| [39m      [35mconst[39m errorText [33m=[39m [35mawait[39m response[33m.[39m[34mtext[39m()[33m;[39m
    [90m340| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m`OpenRouter API error ([39m[36m${[39mstage[36m}[39m[32m): [39m[36m${[39merrorText[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m341| [39m    }
    [90m342| [39m
[90m [2mâ¯[22m Function.generateHybridScope src/lib/ai/scopeAI.ts:[2m66:27[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/scopeAI.test.ts:[2m158:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[150/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/scopeService.ai.test.ts[2m > [22mscopeService AI Integration[2m > [22mgenerateAIScope[2m > [22mshould handle malformed responses
[31m[1mAssertionError[22m: expected 'Unknown error' to contain 'API error: 400'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- API error: 400[39m
[31m+ Unknown error[39m

[36m [2mâ¯[22m src/lib/__tests__/scopeService.ai.test.ts:[2m161:28[22m[39m
    [90m159| [39m
    [90m160| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m161| [39m      [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'API error: 400'[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m162| [39m    })[33m;[39m
    [90m163| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[151/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould get full graph for organization
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).order is not a function[39m
[36m [2mâ¯[22m StrategyGraphService.getNodes src/lib/strategy/strategyGraphService.ts:[2m215:8[22m[39m
    [90m213| [39m      [33m.[39m[34mselect[39m([32m"*"[39m)
    [90m214| [39m      [33m.[39m[34meq[39m([32m"organization_id"[39m[33m,[39m organizationId)
    [90m215| [39m      [33m.[39m[34morder[39m([32m"priority"[39m[33m,[39m { ascending[33m:[39m [35mfalse[39m })[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m216| [39m
    [90m217| [39m    [35mif[39m (options[33m?.[39mdomain) {
[90m [2mâ¯[22m StrategyGraphService.getGraph src/lib/strategy/strategyGraphService.ts:[2m311:19[22m[39m
[90m [2mâ¯[22m src/lib/__tests__/strategyGraph.test.ts:[2m256:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[152/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould get dependencies of a node
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).eq is not a function[39m
[36m [2mâ¯[22m StrategyGraphService.getDependencies src/lib/strategy/strategyGraphService.ts:[2m494:8[22m[39m
    [90m492| [39m      [33m.[39m[34mselect[39m([32m"target_node_id"[39m)
    [90m493| [39m      [33m.[39m[34meq[39m([32m"source_node_id"[39m[33m,[39m nodeId)
    [90m494| [39m      [33m.[39m[34meq[39m([32m"edge_type"[39m[33m,[39m [32m"DEPENDS_ON"[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m495| [39m
    [90m496| [39m    [35mif[39m ([33m![39medges [33m||[39m edges[33m.[39mlength [33m===[39m [34m0[39m) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m src/lib/__tests__/strategyGraph.test.ts:[2m277:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[153/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould get dependents of a node
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).eq is not a function[39m
[36m [2mâ¯[22m StrategyGraphService.getDependents src/lib/strategy/strategyGraphService.ts:[2m522:8[22m[39m
    [90m520| [39m      [33m.[39m[34mselect[39m([32m"source_node_id"[39m)
    [90m521| [39m      [33m.[39m[34meq[39m([32m"target_node_id"[39m[33m,[39m nodeId)
    [90m522| [39m      [33m.[39m[34meq[39m([32m"edge_type"[39m[33m,[39m [32m"DEPENDS_ON"[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m523| [39m
    [90m524| [39m    [35mif[39m ([33m![39medges [33m||[39m edges[33m.[39mlength [33m===[39m [34m0[39m) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m src/lib/__tests__/strategyGraph.test.ts:[2m289:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[154/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyGraphService[2m > [22mGraph Traversal[2m > [22mshould return empty array when no dependencies
[31m[1mTypeError[22m: supabase.from(...).select(...).eq(...).eq is not a function[39m
[36m [2mâ¯[22m StrategyGraphService.getDependencies src/lib/strategy/strategyGraphService.ts:[2m494:8[22m[39m
    [90m492| [39m      [33m.[39m[34mselect[39m([32m"target_node_id"[39m)
    [90m493| [39m      [33m.[39m[34meq[39m([32m"source_node_id"[39m[33m,[39m nodeId)
    [90m494| [39m      [33m.[39m[34meq[39m([32m"edge_type"[39m[33m,[39m [32m"DEPENDS_ON"[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m495| [39m
    [90m496| [39m    [35mif[39m ([33m![39medges [33m||[39m edges[33m.[39mlength [33m===[39m [34m0[39m) [35mreturn[39m [][33m;[39m
[90m [2mâ¯[22m src/lib/__tests__/strategyGraph.test.ts:[2m297:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[155/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyPlannerService[2m > [22mProposal Management[2m > [22mshould get proposals for organization
[31m[1mAssertionError[22m: expected [ { id: 'n1', â€¦(12) }, â€¦(1) ] to have a length of 1 but got 2[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 2[39m

[36m [2mâ¯[22m src/lib/__tests__/strategyGraph.test.ts:[2m537:22[22m[39m
    [90m535| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgetProposals[39m([32m"org-1"[39m)[33m;[39m
    [90m536| [39m
    [90m537| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m538| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mtitle)[33m.[39m[34mtoBe[39m([32m"SEO Strategy"[39m)[33m;[39m
    [90m539| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[156/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyGraph.test.ts[2m > [22mStrategyPlannerService[2m > [22mProposal Management[2m > [22mshould filter proposals by status
[31m[1mTypeError[22m: query.eq is not a function[39m
[36m [2mâ¯[22m StrategyPlannerService.getProposals src/lib/strategy/strategyPlannerService.ts:[2m345:21[22m[39m
    [90m343| [39m
    [90m344| [39m    [35mif[39m (status) {
    [90m345| [39m      query [33m=[39m query[33m.[39m[34meq[39m([32m"status"[39m[33m,[39m status)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m346| [39m    }
    [90m347| [39m
[90m [2mâ¯[22m src/lib/__tests__/strategyGraph.test.ts:[2m561:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[157/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mstartRefinementCycle[2m > [22mshould create a new refinement cycle
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mstartRefinementCycle[2m > [22mshould increment cycle number
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return A for achievement >= 90%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return B for achievement >= 80%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return C for achievement >= 70%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return D for achievement >= 60%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculatePerformanceGrade[2m > [22mshould return F for achievement < 60%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return CRITICAL for drift > 30%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return HIGH for drift > 20%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return MEDIUM for drift > 10%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateSeverity[2m > [22mshould return LOW for drift <= 10%
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould return positive score for over-achievement
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould return negative score for under-achievement
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould cap at -100
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mStrategyRefinementService[2m > [22mcalculateReinforcementScore[2m > [22mshould cap at +100
[31m[1mError[22m: Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[36m [2mâ¯[22m src/lib/__tests__/strategyRefinement.test.ts:[2m72:35[22m[39m
    [90m 70| [39m    }[33m;[39m
    [90m 71| [39m
    [90m 72| [39m    [35mconst[39m { getSupabaseServer } [33m=[39m [34mrequire[39m([32m'@/lib/supabase'[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m 73| [39m    getSupabaseServer[33m.[39m[34mmockResolvedValue[39m(mockSupabase)[33m;[39m
    [90m 74| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'MODULE_NOT_FOUND', requireStack: [ 'D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts' ] }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[158/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mgetDomainDependencies[2m > [22mshould return all dependencies when no domain specified
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mgetDomainDependencies[2m > [22mshould filter dependencies by domain
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mgetDomainDependencies[2m > [22mshould include CONTENT -> SEO dependency
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateEntropy[2m > [22mshould return 1 for perfectly balanced allocation
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateEntropy[2m > [22mshould return 0 for completely unbalanced allocation
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateEntropy[2m > [22mshould return intermediate value for partial balance
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateGini[2m > [22mshould return 0 for perfect equality
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22mcalculateGini[2m > [22mshould return high value for high inequality
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22midentifyImbalances[2m > [22mshould identify over-optimized domains
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mCrossDomainCoordinatorService[2m > [22midentifyImbalances[2m > [22mshould identify under-invested domains
[31m[1mError[22m: Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[36m [2mâ¯[22m src/lib/__tests__/strategyRefinement.test.ts:[2m200:35[22m[39m
    [90m198| [39m    }[33m;[39m
    [90m199| [39m
    [90m200| [39m    [35mconst[39m { getSupabaseServer } [33m=[39m [34mrequire[39m([32m'@/lib/supabase'[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m201| [39m    getSupabaseServer[33m.[39m[34mmockResolvedValue[39m(mockSupabase)[33m;[39m
    [90m202| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'MODULE_NOT_FOUND', requireStack: [ 'D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts' ] }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[159/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate positive signal for exceeding target
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate negative signal for under-achievement
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate negative signal for missed deadline
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateExecutionSignals[2m > [22mshould generate signal for resource over-utilization
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateSimulationSignals[2m > [22mshould generate positive signal for high confidence best path
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mgenerateSimulationSignals[2m > [22mshould generate negative signal for low confidence
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return STRENGTHEN for strongly positive signals
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return WEAKEN for moderately negative signals
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return PAUSE for strongly negative signals
[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategyRefinement.test.ts[2m > [22mReinforcementAdjustmentEngine[2m > [22mcalculateAdjustment[2m > [22mshould return MAINTAIN for neutral signals
[31m[1mError[22m: Cannot find module '@/lib/supabase'
Require stack:
- D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts[39m
[36m [2mâ¯[22m src/lib/__tests__/strategyRefinement.test.ts:[2m299:35[22m[39m
    [90m297| [39m    }[33m;[39m
    [90m298| [39m
    [90m299| [39m    [35mconst[39m { getSupabaseServer } [33m=[39m [34mrequire[39m([32m'@/lib/supabase'[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m300| [39m    getSupabaseServer[33m.[39m[34mmockResolvedValue[39m(mockSupabase)[33m;[39m
    [90m301| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'MODULE_NOT_FOUND', requireStack: [ 'D:\Unite-Hub\src\lib\__tests__\strategyRefinement.test.ts' ] }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[160/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate recommendations from audit data
[31m[1mTypeError[22m: service.generateRecommendations is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m49:45[22m[39m
    [90m 47| [39m      }[33m;[39m
    [90m 48| [39m
    [90m 49| [39m      [35mconst[39m recommendations [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateRecommendations[39m(
    [90m   | [39m                                            [31m^[39m
    [90m 50| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m 51| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[161/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould prioritize critical health score drops
[31m[1mTypeError[22m: service.generateRecommendations is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m68:45[22m[39m
    [90m 66| [39m      }[33m;[39m
    [90m 67| [39m
    [90m 68| [39m      [35mconst[39m recommendations [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateRecommendations[39m(
    [90m   | [39m                                            [31m^[39m
    [90m 69| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m 70| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[162/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate keyword recommendations for significant losses
[31m[1mTypeError[22m: service.generateRecommendations is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m87:45[22m[39m
    [90m 85| [39m      }[33m;[39m
    [90m 86| [39m
    [90m 87| [39m      [35mconst[39m recommendations [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateRecommendations[39m(
    [90m   | [39m                                            [31m^[39m
    [90m 88| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m 89| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[163/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate backlink recommendations for significant losses
[31m[1mTypeError[22m: service.generateRecommendations is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m106:45[22m[39m
    [90m104| [39m      }[33m;[39m
    [90m105| [39m
    [90m106| [39m      [35mconst[39m recommendations [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateRecommendations[39m(
    [90m   | [39m                                            [31m^[39m
    [90m107| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m108| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[164/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould generate technical recommendations for critical issues
[31m[1mTypeError[22m: service.generateRecommendations is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m126:45[22m[39m
    [90m124| [39m      }[33m;[39m
    [90m125| [39m
    [90m126| [39m      [35mconst[39m recommendations [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateRecommendations[39m(
    [90m   | [39m                                            [31m^[39m
    [90m127| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m128| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[165/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgenerateRecommendations[2m > [22mshould return empty array for healthy audit with no issues
[31m[1mTypeError[22m: service.generateRecommendations is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m147:45[22m[39m
    [90m145| [39m      }[33m;[39m
    [90m146| [39m
    [90m147| [39m      [35mconst[39m recommendations [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateRecommendations[39m(
    [90m   | [39m                                            [31m^[39m
    [90m148| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m149| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[166/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mcreateSnapshot[2m > [22mshould create a strategy snapshot with all fields
[31m[1mTypeError[22m: service.createSnapshot is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m173:38[22m[39m
    [90m171| [39m      }[33m;[39m
    [90m172| [39m
    [90m173| [39m      [35mconst[39m snapshot [33m=[39m [35mawait[39m service[33m.[39m[34mcreateSnapshot[39m(snapshotData)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m174| [39m
    [90m175| [39m      [34mexpect[39m(snapshot)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[167/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould record an APPROVED decision
[31m[1mTypeError[22m: service.submitSignoff is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m183:37[22m[39m
    [90m181| [39m  [34mdescribe[39m([32m"submitSignoff"[39m[33m,[39m () [33m=>[39m {
    [90m182| [39m    [34mit[39m([32m"should record an APPROVED decision"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m183| [39m      [35mconst[39m signoff [33m=[39m [35mawait[39m service[33m.[39m[34msubmitSignoff[39m({
    [90m   | [39m                                    [31m^[39m
    [90m184| [39m        client_id[33m:[39m [32m"client-uuid"[39m[33m,[39m
    [90m185| [39m        audit_id[33m:[39m [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[168/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould record a REJECTED decision with notes
[31m[1mTypeError[22m: service.submitSignoff is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m198:37[22m[39m
    [90m196| [39m
    [90m197| [39m    [34mit[39m([32m"should record a REJECTED decision with notes"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m198| [39m      [35mconst[39m signoff [33m=[39m [35mawait[39m service[33m.[39m[34msubmitSignoff[39m({
    [90m   | [39m                                    [31m^[39m
    [90m199| [39m        client_id[33m:[39m [32m"client-uuid"[39m[33m,[39m
    [90m200| [39m        audit_id[33m:[39m [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[169/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould record a MODIFIED decision with changes
[31m[1mTypeError[22m: service.submitSignoff is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m214:37[22m[39m
    [90m212| [39m
    [90m213| [39m    [34mit[39m([32m"should record a MODIFIED decision with changes"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m214| [39m      [35mconst[39m signoff [33m=[39m [35mawait[39m service[33m.[39m[34msubmitSignoff[39m({
    [90m   | [39m                                    [31m^[39m
    [90m215| [39m        client_id[33m:[39m [32m"client-uuid"[39m[33m,[39m
    [90m216| [39m        audit_id[33m:[39m [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[170/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22msubmitSignoff[2m > [22mshould handle signoff for entire audit (no recommendation_id)
[31m[1mTypeError[22m: service.submitSignoff is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m233:37[22m[39m
    [90m231| [39m
    [90m232| [39m    [34mit[39m([32m"should handle signoff for entire audit (no recommendation_id)"[39mâ€¦
    [90m233| [39m      [35mconst[39m signoff [33m=[39m [35mawait[39m service[33m.[39m[34msubmitSignoff[39m({
    [90m   | [39m                                    [31m^[39m
    [90m234| [39m        client_id[33m:[39m [32m"client-uuid"[39m[33m,[39m
    [90m235| [39m        audit_id[33m:[39m [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[171/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgetSignoffHistory[2m > [22mshould return signoff history for a client
[31m[1mTypeError[22m: service.getSignoffHistory is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m249:37[22m[39m
    [90m247| [39m  [34mdescribe[39m([32m"getSignoffHistory"[39m[33m,[39m () [33m=>[39m {
    [90m248| [39m    [34mit[39m([32m"should return signoff history for a client"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m249| [39m      [35mconst[39m history [33m=[39m [35mawait[39m service[33m.[39m[34mgetSignoffHistory[39m([32m"client-uuid"[39m[33m,[39m [32m"[39mâ€¦
    [90m   | [39m                                    [31m^[39m
    [90m250| [39m
    [90m251| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(history))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[172/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mgetSignoffHistory[2m > [22mshould filter by audit_id
[31m[1mTypeError[22m: service.getSignoffHistory is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m255:37[22m[39m
    [90m253| [39m
    [90m254| [39m    [34mit[39m([32m"should filter by audit_id"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m255| [39m      [35mconst[39m history [33m=[39m [35mawait[39m service[33m.[39m[34mgetSignoffHistory[39m([32m"client-uuid"[39m[33m,[39m [32m"[39mâ€¦
    [90m   | [39m                                    [31m^[39m
    [90m256| [39m
    [90m257| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(history))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[173/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mupdateSnapshotStatus[2m > [22mshould update status to APPROVED when all recommendations approved
[31m[1mTypeError[22m: service.updateSnapshotStatus is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m263:36[22m[39m
    [90m261| [39m  [34mdescribe[39m([32m"updateSnapshotStatus"[39m[33m,[39m () [33m=>[39m {
    [90m262| [39m    [34mit[39m([32m"should update status to APPROVED when all recommendations appr[39mâ€¦
    [90m263| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mupdateSnapshotStatus[39m(
    [90m   | [39m                                   [31m^[39m
    [90m264| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m265| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[174/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mupdateSnapshotStatus[2m > [22mshould update status to PARTIAL when some approved
[31m[1mTypeError[22m: service.updateSnapshotStatus is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m273:36[22m[39m
    [90m271| [39m
    [90m272| [39m    [34mit[39m([32m"should update status to PARTIAL when some approved"[39m[33m,[39m [35masync[39m () â€¦
    [90m273| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mupdateSnapshotStatus[39m(
    [90m   | [39m                                   [31m^[39m
    [90m274| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m275| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[175/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySignoff.test.ts[2m > [22mStrategySignoffService[2m > [22mupdateSnapshotStatus[2m > [22mshould update status to REJECTED when all rejected
[31m[1mTypeError[22m: service.updateSnapshotStatus is not a function[39m
[36m [2mâ¯[22m src/lib/__tests__/strategySignoff.test.ts:[2m283:36[22m[39m
    [90m281| [39m
    [90m282| [39m    [34mit[39m([32m"should update status to REJECTED when all rejected"[39m[33m,[39m [35masync[39m () â€¦
    [90m283| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mupdateSnapshotStatus[39m(
    [90m   | [39m                                   [31m^[39m
    [90m284| [39m        [32m"client-uuid"[39m[33m,[39m
    [90m285| [39m        [32m"audit-uuid"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[176/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySimulation.test.ts[2m > [22mStrategySimulationService[2m > [22mSimulation Results[2m > [22mshould get simulations list for organization
[31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 0[39m

[36m [2mâ¯[22m src/lib/__tests__/strategySimulation.test.ts:[2m165:22[22m[39m
    [90m163| [39m
    [90m164| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgetSimulations[39m([32m"org-1"[39m)[33m;[39m
    [90m165| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m166| [39m    })[33m;[39m
    [90m167| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[177/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/strategySimulation.test.ts[2m > [22mStrategySimulationService[2m > [22mSimulation Results[2m > [22mshould filter simulations by status
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m src/lib/__tests__/strategySimulation.test.ts:[2m176:22[22m[39m
    [90m174| [39m
    [90m175| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgetSimulations[39m([32m"org-1"[39m[33m,[39m { status[33m:[39m [32m"[39mâ€¦
    [90m176| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m177| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m"COMPLETED"[39m)[33m;[39m
    [90m178| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[178/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Container Lifecycle[2m > [22mshould start container successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m88:28[22m[39m
    [90m 86| [39m  [34mit[39m([32m'should start container successfully'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m 87| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mstartTenantContainer[39m([32m'550e8400-e29b-41d4-a716[39mâ€¦
    [90m 88| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m 89| [39m    [34mexpect[39m(result[33m.[39mcontainerId)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 90| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[179/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Container Lifecycle[2m > [22mshould stop container successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m131:28[22m[39m
    [90m129| [39m  [34mit[39m([32m'should stop container successfully'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m130| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mstopTenantContainer[39m([32m'550e8400-e29b-41d4-a716-[39mâ€¦
    [90m131| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m132| [39m  })[33m;[39m
    [90m133| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[180/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Container Lifecycle[2m > [22mshould restart container successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m156:28[22m[39m
    [90m154| [39m  [34mit[39m([32m'should restart container successfully'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m155| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mrestartTenantContainer[39m([32m'550e8400-e29b-41d4-a7[39mâ€¦
    [90m156| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m157| [39m  })[33m;[39m
    [90m158| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[181/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould get container status when running
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m163:28[22m[39m
    [90m161| [39m  [34mit[39m([32m'should get container status when running'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m162| [39m    [35mconst[39m status [33m=[39m [35mawait[39m [34mgetContainerStatus[39m([32m'550e8400-e29b-41d4-a716-4[39mâ€¦
    [90m163| [39m    [34mexpect[39m(status[33m.[39mrunning)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m164| [39m    [34mexpect[39m(status[33m.[39mcontainerId)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m165| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[182/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould perform health check successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m188:28[22m[39m
    [90m186| [39m  [34mit[39m([32m'should perform health check successfully'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m187| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mperformHealthCheck[39m([32m'550e8400-e29b-41d4-a716-4[39mâ€¦
    [90m188| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m189| [39m    [34mexpect[39m(result[33m.[39mhealthy)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m190| [39m    [34mexpect[39m(result[33m.[39mresponseTimeMs)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[183/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould detect unhealthy container
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m202:28[22m[39m
    [90m200| [39m
    [90m201| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mperformHealthCheck[39m([32m'550e8400-e29b-41d4-a716-4[39mâ€¦
    [90m202| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m203| [39m    [34mexpect[39m(result[33m.[39mhealthy)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m204| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[184/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Status Monitoring[2m > [22mshould handle health check timeout
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m212:28[22m[39m
    [90m210| [39m
    [90m211| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mperformHealthCheck[39m([32m'550e8400-e29b-41d4-a716-4[39mâ€¦
    [90m212| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m213| [39m    [34mexpect[39m(result[33m.[39mhealthy)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m214| [39m    [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[185/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantOrchestrator.test.ts[2m > [22mTenant Orchestrator - Resource Metrics[2m > [22mshould get resource metrics successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantOrchestrator.test.ts:[2m221:28[22m[39m
    [90m219| [39m  [34mit[39m([32m'should get resource metrics successfully'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m220| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mgetResourceMetrics[39m([32m'550e8400-e29b-41d4-a716-4[39mâ€¦
    [90m221| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m222| [39m    [34mexpect[39m(result[33m.[39mmetrics)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m223| [39m    [34mexpect[39m(result[33m.[39mmetrics[33m?.[39mcpuPercent)[33m.[39m[34mtoBe[39m([34m0.50[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[186/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/tenantProvisioner.test.ts[2m > [22mTenant Provisioner - Provisioning[2m > [22mshould provision tenant successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/tenantProvisioner.test.ts:[2m259:28[22m[39m
    [90m257| [39m
    [90m258| [39m    [35mconst[39m result [33m=[39m [35mawait[39m [34mprovisionTenant[39m(config)[33m;[39m
    [90m259| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m260| [39m    [34mexpect[39m(result[33m.[39mcontainerId)[33m.[39m[34mtoBe[39m([32m'container-id'[39m)[33m;[39m
    [90m261| [39m    [34mexpect[39m(result[33m.[39mexternalPort)[33m.[39m[34mtoBe[39m([34m3001[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[187/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould return entries with totals
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m391:30[22m[39m
    [90m389| [39m      })[33m;[39m
    [90m390| [39m
    [90m391| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m392| [39m      [34mexpect[39m(result[33m.[39mentries)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m393| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[188/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by status
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m401:30[22m[39m
    [90m399| [39m      })[33m;[39m
    [90m400| [39m
    [90m401| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m402| [39m    })[33m;[39m
    [90m403| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[189/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by date range
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m411:30[22m[39m
    [90m409| [39m      })[33m;[39m
    [90m410| [39m
    [90m411| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m412| [39m    })[33m;[39m
    [90m413| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[190/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by project
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m420:30[22m[39m
    [90m418| [39m      })[33m;[39m
    [90m419| [39m
    [90m420| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m421| [39m    })[33m;[39m
    [90m422| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[191/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeEntries[2m > [22mshould filter by staff
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m429:30[22m[39m
    [90m427| [39m      })[33m;[39m
    [90m428| [39m
    [90m429| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m430| [39m    })[33m;[39m
    [90m431| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[192/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeSummary[2m > [22mshould calculate today totals
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m440:30[22m[39m
    [90m438| [39m      )[33m;[39m
    [90m439| [39m
    [90m440| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m441| [39m      [35mif[39m (result[33m.[39msummary) {
    [90m442| [39m        [34mexpect[39m(result[33m.[39msummary[33m.[39mtoday)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[193/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeSummary[2m > [22mshould calculate week totals
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m455:30[22m[39m
    [90m453| [39m      )[33m;[39m
    [90m454| [39m
    [90m455| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m456| [39m      [35mif[39m (result[33m.[39msummary) {
    [90m457| [39m        [34mexpect[39m(result[33m.[39msummary[33m.[39mweek)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[194/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetTimeSummary[2m > [22mshould calculate month totals
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m467:30[22m[39m
    [90m465| [39m      )[33m;[39m
    [90m466| [39m
    [90m467| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m468| [39m      [35mif[39m (result[33m.[39msummary) {
    [90m469| [39m        [34mexpect[39m(result[33m.[39msummary[33m.[39mmonth)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[195/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/timeService.test.ts[2m > [22mTime Service - Query Operations[2m > [22mgetPendingApprovals[2m > [22mshould return pending entries
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/timeService.test.ts:[2m478:30[22m[39m
    [90m476| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetPendingApprovals[39m(mockOrgId)[33m;[39m
    [90m477| [39m
    [90m478| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m479| [39m      [34mexpect[39m(result[33m.[39mentries)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m480| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[196/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22mrevokeTrustedMode[2m > [22mshould set status to REVOKED
[31m[1mError[22m: Trusted mode request not found[39m
[36m [2mâ¯[22m TrustModeService.revokeTrustedMode src/lib/trust/trustModeService.ts:[2m473:13[22m[39m
    [90m471| [39m
    [90m472| [39m    [35mif[39m (fetchError [33m||[39m [33m![39mrequest) {
    [90m473| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Trusted mode request not found"[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m474| [39m    }
    [90m475| [39m
[90m [2mâ¯[22m src/lib/__tests__/trustModeService.test.ts:[2m480:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[197/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould allow change within scope
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/trustModeService.test.ts:[2m516:30[22m[39m
    [90m514| [39m      )[33m;[39m
    [90m515| [39m
    [90m516| [39m      [34mexpect[39m(result[33m.[39mallowed)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m517| [39m    })[33m;[39m
    [90m518| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[198/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould reject if Trusted Mode not active
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2mâ¯[22m src/lib/__tests__/trustModeService.test.ts:[2m532:30[22m[39m
    [90m530| [39m      )[33m;[39m
    [90m531| [39m
    [90m532| [39m      [34mexpect[39m(result[33m.[39mallowed)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m533| [39m      [34mexpect[39m(result[33m.[39mreason)[33m.[39m[34mtoContain[39m([32m"not active"[39m)[33m;[39m
    [90m534| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[199/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould reject if risk level exceeds maximum
[31m[1mAssertionError[22m: expected 'Trusted Mode is not active for this câ€¦' to contain 'exceeds maximum'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- exceeds maximum[39m
[31m+ Trusted Mode is not active for this client[39m

[36m [2mâ¯[22m src/lib/__tests__/trustModeService.test.ts:[2m558:29[22m[39m
    [90m556| [39m
    [90m557| [39m      [34mexpect[39m(result[33m.[39mallowed)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m558| [39m      [34mexpect[39m(result[33m.[39mreason)[33m.[39m[34mtoContain[39m([32m"exceeds maximum"[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m559| [39m    })[33m;[39m
    [90m560| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[200/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/trustModeService.test.ts[2m > [22mTrustModeService[2m > [22misChangeAllowed[2m > [22mshould reject forbidden change types
[31m[1mAssertionError[22m: expected 'Risk level HIGH exceeds maximum allowâ€¦' to contain 'forbidden'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- forbidden[39m
[31m+ Risk level HIGH exceeds maximum allowed LOW[39m

[36m [2mâ¯[22m src/lib/__tests__/trustModeService.test.ts:[2m586:29[22m[39m
    [90m584| [39m
    [90m585| [39m      [34mexpect[39m(result[33m.[39mallowed)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m586| [39m      [34mexpect[39m(result[33m.[39mreason)[33m.[39m[34mtoContain[39m([32m"forbidden"[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m587| [39m    })[33m;[39m
    [90m588| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[201/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Line Items Preparation[2m > [22mshould prepare line items from time entries
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/xeroSync.test.ts:[2m194:28[22m[39m
    [90m192| [39m    )[33m;[39m
    [90m193| [39m
    [90m194| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m195| [39m    [34mexpect[39m(result[33m.[39mlineItems)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m196| [39m    [34mexpect[39m(result[33m.[39mlineItems[33m![39m[[34m0[39m])[33m.[39m[34mtoMatchObject[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[202/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Line Items Preparation[2m > [22mshould handle no approved entries found
[31m[1mAssertionError[22m: expected 'supabase.from(...).select(...).in(...â€¦' to be 'No approved, unsynced entries found' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- No approved, unsynced entries found[39m
[31m+ supabase.from(...).select(...).in(...).eq(...).eq(...).eq is not a function[39m

[36m [2mâ¯[22m src/lib/__tests__/xeroSync.test.ts:[2m226:26[22m[39m
    [90m224| [39m
    [90m225| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m226| [39m    [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'No approved, unsynced entries found'[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m227| [39m  })[33m;[39m
    [90m228| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[203/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Line Items Preparation[2m > [22mshould handle database errors
[31m[1mAssertionError[22m: expected 'supabase.from(...).select(...).in(...â€¦' to be 'Database error' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Database error[39m
[31m+ supabase.from(...).select(...).in(...).eq(...).eq(...).eq is not a function[39m

[36m [2mâ¯[22m src/lib/__tests__/xeroSync.test.ts:[2m249:26[22m[39m
    [90m247| [39m
    [90m248| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m249| [39m    [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'Database error'[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m250| [39m  })[33m;[39m
    [90m251| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[204/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Sync Operation (Stub)[2m > [22mshould simulate successful sync
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/xeroSync.test.ts:[2m301:28[22m[39m
    [90m299| [39m    })[33m;[39m
    [90m300| [39m
    [90m301| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m302| [39m    [34mexpect[39m(result[33m.[39msyncedCount)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m303| [39m    [34mexpect[39m(result[33m.[39mfailedCount)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[205/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Sync Operation (Stub)[2m > [22mshould handle sync of multiple entries
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/xeroSync.test.ts:[2m375:28[22m[39m
    [90m373| [39m    })[33m;[39m
    [90m374| [39m
    [90m375| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m376| [39m    [34mexpect[39m(result[33m.[39msyncedCount)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m377| [39m    [34mexpect[39m(result[33m.[39mxeroTimesheetIds)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[206/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Edge Cases[2m > [22mshould handle entries without hourly rate
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/xeroSync.test.ts:[2m483:28[22m[39m
    [90m481| [39m    )[33m;[39m
    [90m482| [39m
    [90m483| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m484| [39m    [34mexpect[39m(result[33m.[39mlineItems[33m![39m[[34m0[39m][33m.[39mratePerUnit)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
    [90m485| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[207/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/xeroSync.test.ts[2m > [22mXero Sync - Edge Cases[2m > [22mshould only sync approved entries
[31m[1mAssertionError[22m: expected 'supabase.from(...).select(...).in(...â€¦' to be 'No approved, unsynced entries found' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- No approved, unsynced entries found[39m
[31m+ supabase.from(...).select(...).in(...).eq(...).eq(...).eq is not a function[39m

[36m [2mâ¯[22m src/lib/__tests__/xeroSync.test.ts:[2m509:26[22m[39m
    [90m507| [39m
    [90m508| [39m    [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m509| [39m    [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'No approved, unsynced entries found'[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m510| [39m  })[33m;[39m
    [90m511| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[208/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/multi-channel/channel-manager.test.ts[2m > [22mChannelManager Integration Tests[2m > [22mChannel Execution[2m > [22mshould execute email channel successfully
[31m[1mAssertionError[22m: expected undefined to be 'email' // Object.is equality[39m

[32m- Expected:[39m 
"email"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m tests/integration/multi-channel/channel-manager.test.ts:[2m32:30[22m[39m
    [90m 30| [39m
    [90m 31| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 32| [39m      [34mexpect[39m(result[33m.[39mchannel)[33m.[39m[34mtoBe[39m([32m'email'[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 33| [39m    })[33m;[39m
    [90m 34| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[209/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/multi-channel/channel-manager.test.ts[2m > [22mChannelManager Integration Tests[2m > [22mChannel Execution[2m > [22mshould execute SMS channel with phone validation
[31m[1mAssertionError[22m: expected undefined to be 'sms' // Object.is equality[39m

[32m- Expected:[39m 
"sms"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m tests/integration/multi-channel/channel-manager.test.ts:[2m49:30[22m[39m
    [90m 47| [39m
    [90m 48| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 49| [39m      [34mexpect[39m(result[33m.[39mchannel)[33m.[39m[34mtoBe[39m([32m'sms'[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 50| [39m    })[33m;[39m
    [90m 51| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[210/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/multi-channel/channel-manager.test.ts[2m > [22mChannelManager Integration Tests[2m > [22mError Handling[2m > [22mshould handle invalid channel type
[31m[1mAssertionError[22m: promise resolved "{ success: false, â€¦(2) }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [Error: rejected promise][39m
[31m+ Object {[39m
[31m+   "error": "Unsupported channel type: invalid",[39m
[31m+   "success": false,[39m
[31m+   "type": "invalid",[39m
[31m+ }[39m

[36m [2mâ¯[22m tests/integration/multi-channel/channel-manager.test.ts:[2m146:7[22m[39m
    [90m144| [39m          metadata[33m:[39m {}[33m,[39m
    [90m145| [39m        })
    [90m146| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m147| [39m    })[33m;[39m
    [90m148| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[211/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/components/skeletons.test.tsx[2m > [22mContentListSkeleton[2m > [22mshould render default number of skeletons (6)
[31m[1mAssertionError[22m: expected 24 to be 6 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 6[39m
[31m+ 24[39m

[36m [2mâ¯[22m tests/unit/components/skeletons.test.tsx:[2m40:26[22m[39m
    [90m 38| [39m
    [90m 39| [39m    [35mconst[39m cards [33m=[39m container[33m.[39m[34mquerySelectorAll[39m([32m'[class*="bg-muted"]'[39m)[33m;[39m
    [90m 40| [39m    [34mexpect[39m(cards[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m6[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m 41| [39m  })[33m;[39m
    [90m 42| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[212/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/components/skeletons.test.tsx[2m > [22mContentListSkeleton[2m > [22mshould render custom number of skeletons
[31m[1mAssertionError[22m: expected 12 to be 3 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 12[39m

[36m [2mâ¯[22m tests/unit/components/skeletons.test.tsx:[2m47:26[22m[39m
    [90m 45| [39m
    [90m 46| [39m    [35mconst[39m cards [33m=[39m container[33m.[39m[34mquerySelectorAll[39m([32m'[class*="bg-muted"]'[39m)[33m;[39m
    [90m 47| [39m    [34mexpect[39m(cards[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m 48| [39m  })[33m;[39m
    [90m 49| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[213/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/components/skeletons.test.tsx[2m > [22mContentListSkeleton[2m > [22mshould handle large count
[31m[1mAssertionError[22m: expected 80 to be 20 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 20[39m
[31m+ 80[39m

[36m [2mâ¯[22m tests/unit/components/skeletons.test.tsx:[2m68:26[22m[39m
    [90m 66| [39m
    [90m 67| [39m    [35mconst[39m cards [33m=[39m container[33m.[39m[34mquerySelectorAll[39m([32m'[class*="bg-muted"]'[39m)[33m;[39m
    [90m 68| [39m    [34mexpect[39m(cards[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m20[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m 69| [39m  })[33m;[39m
    [90m 70| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[214/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/components/skeletons.test.tsx[2m > [22mStatsGridSkeleton[2m > [22mshould render default number of stat cards (4)
[31m[1mAssertionError[22m: expected 16 to be 4 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 4[39m
[31m+ 16[39m

[36m [2mâ¯[22m tests/unit/components/skeletons.test.tsx:[2m102:26[22m[39m
    [90m100| [39m
    [90m101| [39m    [35mconst[39m cards [33m=[39m container[33m.[39m[34mquerySelectorAll[39m([32m'[class*="bg-muted"]'[39m)[33m;[39m
    [90m102| [39m    [34mexpect[39m(cards[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m4[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m103| [39m  })[33m;[39m
    [90m104| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[215/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/components/skeletons.test.tsx[2m > [22mStatsGridSkeleton[2m > [22mshould render custom number of stat cards
[31m[1mAssertionError[22m: expected 24 to be 6 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 6[39m
[31m+ 24[39m

[36m [2mâ¯[22m tests/unit/components/skeletons.test.tsx:[2m109:26[22m[39m
    [90m107| [39m
    [90m108| [39m    [35mconst[39m cards [33m=[39m container[33m.[39m[34mquerySelectorAll[39m([32m'[class*="bg-muted"]'[39m)[33m;[39m
    [90m109| [39m    [34mexpect[39m(cards[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m6[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m110| [39m  })[33m;[39m
    [90m111| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[216/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/auth.test.ts[2m > [22mAuthentication API Integration Tests[2m > [22mPOST /api/auth/initialize-user[2m > [22mshould return 200 and skip initialization without authentication
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/integration/api/auth.test.ts:[2m84:31[22m[39m
    [90m 82| [39m      [35mconst[39m response [33m=[39m [35mawait[39m [33mPOST[39m(req)[33m;[39m
    [90m 83| [39m      [90m// Route returns 200 with "skipping initialization" message when[39mâ€¦
    [90m 84| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m 85| [39m
    [90m 86| [39m      [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[217/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/auth.test.ts[2m > [22mAuthentication API Integration Tests[2m > [22mError Handling[2m > [22mshould return JSON response when not authenticated
[31m[1mAssertionError[22m: expected { success: false, â€¦(3) } to have property "message"[39m
[36m [2mâ¯[22m tests/integration/api/auth.test.ts:[2m218:20[22m[39m
    [90m216| [39m      [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m217| [39m      [90m// Route returns 200 with message, not error[39m
    [90m218| [39m      [34mexpect[39m(data)[33m.[39m[34mtoHaveProperty[39m([32m'message'[39m)[33m;[39m
    [90m   | [39m                   [31m^[39m
    [90m219| [39m      [34mexpect[39m(data[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Not authenticated'[39m)[33m;[39m
    [90m220| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[218/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/content.test.ts[2m > [22mContent API - GET /api/content[2m > [22mshould return 401 when not authenticated
[31m[1mAssertionError[22m: expected 400 to be 401 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 401[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/api/content.test.ts:[2m57:29[22m[39m
    [90m 55| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [33mGET[39m(req)[33m;[39m
    [90m 56| [39m
    [90m 57| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m401[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 58| [39m    [35mconst[39m data [33m=[39m [35mawait[39m [34mparseJsonResponse[39m(response)[33m;[39m
    [90m 59| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[219/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/content.test.ts[2m > [22mContent API - GET /api/content[2m > [22mshould return content list for authenticated user
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/api/content.test.ts:[2m106:29[22m[39m
    [90m104| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [33mGET[39m(req)[33m;[39m
    [90m105| [39m
    [90m106| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m107| [39m    [35mconst[39m data [33m=[39m [35mawait[39m [34mparseJsonResponse[39m(response)[33m;[39m
    [90m108| [39m    [34mexpect[39m(data[33m.[39mdata [33m||[39m data)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[220/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/content.test.ts[2m > [22mContent API - GET /api/content[2m > [22mshould filter content by workspace ID
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/api/content.test.ts:[2m129:29[22m[39m
    [90m127| [39m
    [90m128| [39m    [90m// Response should only contain content from the specified workspa[39mâ€¦
    [90m129| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m130| [39m  })[33m;[39m
    [90m131| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[221/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/content.test.ts[2m > [22mContent API - POST /api/content[2m > [22mshould return 401 when not authenticated
[31m[1mAssertionError[22m: expected 400 to be 401 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 401[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/api/content.test.ts:[2m174:29[22m[39m
    [90m172| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [33mPOST[39m(req)[33m;[39m
    [90m173| [39m
    [90m174| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m401[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m175| [39m  })[33m;[39m
    [90m176| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[222/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/content.test.ts[2m > [22mContent API - POST /api/content[2m > [22mshould create new content when authenticated
[31m[1mAssertionError[22m: expected [ 200, 201 ] to include 400[39m
[36m [2mâ¯[22m tests/integration/api/content.test.ts:[2m224:24[22m[39m
    [90m222| [39m
    [90m223| [39m    [90m// Depending on implementation[39m
    [90m224| [39m    [34mexpect[39m([[34m200[39m[33m,[39m [34m201[39m])[33m.[39m[34mtoContain[39m(response[33m.[39mstatus)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m225| [39m  })[33m;[39m
    [90m226| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[223/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/integration/api/content.test.ts[2m > [22mContent API - Error Handling[2m > [22mshould handle database errors gracefully
[31m[1mAssertionError[22m: expected [ 500, 200 ] to include 400[39m
[36m [2mâ¯[22m tests/integration/api/content.test.ts:[2m326:24[22m[39m
    [90m324| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [33mGET[39m(req)[33m;[39m
    [90m325| [39m
    [90m326| [39m    [34mexpect[39m([[34m500[39m[33m,[39m [34m200[39m])[33m.[39m[34mtoContain[39m(response[33m.[39mstatus)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m327| [39m  })[33m;[39m
    [90m328| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[224/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/ato-client.test.ts[2m > [22mATOClient[2m > [22mEnvironment factory[2m > [22mshould create client from environment variables
[31m[1mError[22m: Cannot find module '@/lib/integrations/ato/ato-client'
Require stack:
- D:\Unite-Hub\tests\unit\lib\ato-client.test.ts[39m
[36m [2mâ¯[22m tests/unit/lib/ato-client.test.ts:[2m112:35[22m[39m
    [90m110| [39m      process[33m.[39menv[33m.[39m[33mATO_SANDBOX_MODE[39m [33m=[39m [32m'true'[39m[33m;[39m
    [90m111| [39m
    [90m112| [39m      [35mconst[39m { createATOClient } [33m=[39m [34mrequire[39m([32m'@/lib/integrations/ato/ato-[39mâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m113| [39m      [35mconst[39m client [33m=[39m [34mcreateATOClient[39m()[33m;[39m
    [90m114| [39m      [34mexpect[39m(client)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'MODULE_NOT_FOUND', requireStack: [ 'D:\Unite-Hub\tests\unit\lib\ato-client.test.ts' ] }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[225/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser Client[2m > [22mshould create browser client with correct config
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'https://test.supabase.co', â€¦(2) ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m tests/unit/lib/supabase.test.ts:[2m62:28[22m[39m
    [90m 60| [39m      supabase[33m.[39mauth[33m;[39m
    [90m 61| [39m
    [90m 62| [39m      [34mexpect[39m(createClient)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                           [31m^[39m
    [90m 63| [39m        [32m'https://test.supabase.co'[39m[33m,[39m
    [90m 64| [39m        [32m'test-anon-key'[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[226/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser Client[2m > [22mshould use lazy initialization for browser client
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m tests/unit/lib/supabase.test.ts:[2m88:28[22m[39m
    [90m 86| [39m      supabase[33m.[39mauth[33m;[39m
    [90m 87| [39m
    [90m 88| [39m      [34mexpect[39m(createClient)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m 89| [39m    })[33m;[39m
    [90m 90| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[227/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser Client[2m > [22mshould throw error if environment variables missing
[31m[1mAssertionError[22m: expected [Function] to throw an error[39m

[32m- Expected:[39m 
null

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m tests/unit/lib/supabase.test.ts:[2m106:10[22m[39m
    [90m104| [39m      [34mexpect[39m(() [33m=>[39m {
    [90m105| [39m        supabase[33m.[39mauth[33m;[39m
    [90m106| [39m      })[33m.[39m[34mtoThrow[39m([36m/Supabase environment variables are not configured/[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m107| [39m
    [90m108| [39m      [90m// Restore env vars[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[228/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mServer Client[2m > [22mshould create server client with cookie handling
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'https://test.supabase.co', â€¦(2) ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m tests/unit/lib/supabase.test.ts:[2m121:34[22m[39m
    [90m119| [39m      [35mawait[39m [34mgetSupabaseServer[39m()[33m;[39m
    [90m120| [39m
    [90m121| [39m      [34mexpect[39m(createServerClient)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                 [31m^[39m
    [90m122| [39m        [32m'https://test.supabase.co'[39m[33m,[39m
    [90m123| [39m        [32m'test-anon-key'[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[229/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/supabase.test.ts[2m > [22mSupabase Client[2m > [22mBrowser vs Server Usage[2m > [22mshould use getSupabaseServer for server-side operations
[31m[1mAssertionError[22m: expected undefined not to be undefined[39m
[36m [2mâ¯[22m tests/unit/lib/supabase.test.ts:[2m187:33[22m[39m
    [90m185| [39m
    [90m186| [39m      [34mexpect[39m(serverClient)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m187| [39m      [34mexpect[39m(serverClient[33m.[39mauth)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m188| [39m    })[33m;[39m
    [90m189| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[230/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidateCheckDigit[2m > [22mshould validate 8-digit TFN check digit
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m88:56[22m[39m
    [90m 86| [39m      [90m// These are test TFNs that pass the check digit algorithm[39m
    [90m 87| [39m      [90m// Note: Real TFNs should not be used in tests[39m
    [90m 88| [39m      [34mexpect[39m(validator[33m.[39m[34mvalidateCheckDigit[39m([32m'87654321'[39m))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                                       [31m^[39m
    [90m 89| [39m    })[33m;[39m
    [90m 90| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[231/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidateCheckDigit[2m > [22mshould validate 9-digit TFN check digit
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m93:57[22m[39m
    [90m 91| [39m    [90m// Valid 9-digit TFNs[39m
    [90m 92| [39m    [34mit[39m([32m'should validate 9-digit TFN check digit'[39m[33m,[39m () [33m=>[39m {
    [90m 93| [39m      [34mexpect[39m(validator[33m.[39m[34mvalidateCheckDigit[39m([32m'123456782'[39m))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                                        [31m^[39m
    [90m 94| [39m    })[33m;[39m
    [90m 95| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[232/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidate[2m > [22mshould validate correct 8-digit TFN
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m114:30[22m[39m
    [90m112| [39m    [34mit[39m([32m'should validate correct 8-digit TFN'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m113| [39m      [35mconst[39m result [33m=[39m [35mawait[39m validator[33m.[39m[34mvalidate[39m([32m'87654321'[39m)[33m;[39m
    [90m114| [39m      [34mexpect[39m(result[33m.[39misValid)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m115| [39m      [34mexpect[39m(result[33m.[39mtfn)[33m.[39m[34mtoBe[39m([32m'876 543 21'[39m)[33m;[39m
    [90m116| [39m      [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[233/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidate[2m > [22mshould validate correct 9-digit TFN
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m121:30[22m[39m
    [90m119| [39m    [34mit[39m([32m'should validate correct 9-digit TFN'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m120| [39m      [35mconst[39m result [33m=[39m [35mawait[39m validator[33m.[39m[34mvalidate[39m([32m'123456782'[39m)[33m;[39m
    [90m121| [39m      [34mexpect[39m(result[33m.[39misValid)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m122| [39m      [34mexpect[39m(result[33m.[39mtfn)[33m.[39m[34mtoBe[39m([32m'123 456 782'[39m)[33m;[39m
    [90m123| [39m      [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[234/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidate[2m > [22mshould handle TFN with spaces
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m140:30[22m[39m
    [90m138| [39m    [34mit[39m([32m'should handle TFN with spaces'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m139| [39m      [35mconst[39m result [33m=[39m [35mawait[39m validator[33m.[39m[34mvalidate[39m([32m'876 543 21'[39m)[33m;[39m
    [90m140| [39m      [34mexpect[39m(result[33m.[39misValid)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m141| [39m      [34mexpect[39m(result[33m.[39mtfn)[33m.[39m[34mtoBe[39m([32m'876 543 21'[39m)[33m;[39m
    [90m142| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[235/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mvalidateBatch[2m > [22mshould validate multiple TFNs
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m155:34[22m[39m
    [90m153| [39m
    [90m154| [39m      [34mexpect[39m(results)[33m.[39m[34mtoHaveLength[39m([34m3[39m)[33m;[39m
    [90m155| [39m      [34mexpect[39m(results[[34m0[39m][33m.[39misValid)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m156| [39m      [34mexpect[39m(results[[34m1[39m][33m.[39misValid)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m157| [39m      [34mexpect[39m(results[[34m2[39m][33m.[39misValid)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[236/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mCheck digit algorithm[2m > [22mshould use correct weighting factors for 8-digit
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m213:57[22m[39m
    [90m211| [39m      [90m// This test verifies the algorithm is working as expected[39m
    [90m212| [39m      [35mconst[39m valid8digit [33m=[39m [32m'87654321'[39m[33m;[39m
    [90m213| [39m      [34mexpect[39m(validator[33m.[39m[34mvalidateCheckDigit[39m(valid8digit))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                                        [31m^[39m
    [90m214| [39m    })[33m;[39m
    [90m215| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[237/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mCheck digit algorithm[2m > [22mshould use correct weighting factors for 9-digit
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m219:57[22m[39m
    [90m217| [39m      [90m// Weighting: [1, 4, 3, 7, 5, 8, 6, 9][39m
    [90m218| [39m      [35mconst[39m valid9digit [33m=[39m [32m'123456782'[39m[33m;[39m
    [90m219| [39m      [34mexpect[39m(validator[33m.[39m[34mvalidateCheckDigit[39m(valid9digit))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                                        [31m^[39m
    [90m220| [39m    })[33m;[39m
    [90m221| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[238/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/tfn-validator.test.ts[2m > [22mTFNValidator[2m > [22mCheck digit algorithm[2m > [22mshould handle check digit > 9 subtraction rule
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/lib/tfn-validator.test.ts:[2m225:57[22m[39m
    [90m223| [39m      [90m// When check digit calculation > 9, subtract 9[39m
    [90m224| [39m      [90m// This is tested implicitly in the valid TFNs above[39m
    [90m225| [39m      [34mexpect[39m(validator[33m.[39m[34mvalidateCheckDigit[39m([32m'123456782'[39m))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                                        [31m^[39m
    [90m226| [39m    })[33m;[39m
    [90m227| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[239/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mcheckAndSendAlerts[2m > [22mshould generate alerts for expiring credentials
[31m[1m[7m FAIL [27m[22m[39m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mcheckAndSendAlerts[2m > [22mshould not create duplicate alerts within 24 hours
[31m[1m[7m FAIL [27m[22m[39m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mcheckAndSendAlerts[2m > [22mshould classify alerts by severity correctly
[31m[1m[7m FAIL [27m[22m[39m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mconfigureAlertRule[2m > [22mshould create alert rule successfully
[31m[1m[7m FAIL [27m[22m[39m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22macknowledgeAlert[2m > [22mshould acknowledge alert successfully
[31m[1m[7m FAIL [27m[22m[39m tests/unit/services/credential-alert-service.test.ts[2m > [22mCredentialAlertService[2m > [22mgetAlerts[2m > [22mshould retrieve unacknowledged alerts
[31m[1mError[22m: Synthex not initialized. Run: synthex init[39m
[36m [2mâ¯[22m new CredentialAlertService src/cli/services/monitoring/credential-alerts.ts:[2m65:13[22m[39m
    [90m 63| [39m    [35mconst[39m config [33m=[39m [35mthis[39m[33m.[39mconfigManager[33m.[39m[34mloadConfig[39m()[33m;[39m
    [90m 64| [39m    [35mif[39m ([33m![39mconfig) {
    [90m 65| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'Synthex not initialized. Run: synthex init'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m 66| [39m    }
    [90m 67| [39m
[90m [2mâ¯[22m tests/unit/services/credential-alert-service.test.ts:[2m21:20[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[240/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mHealth Check Endpoint[2m > [22mshould include latency measurements
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[241/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/lib/__tests__/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mHealth Check Endpoint[2m > [22mshould handle rate limiting
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/lib/__tests__/integration/api.test.ts:[2m52:27[22m[39m
    [90m 50| [39m      [90m// At least one should be rate limited (429)[39m
    [90m 51| [39m      [35mconst[39m rateLimited [33m=[39m responses[33m.[39m[34msome[39m(r [33m=>[39m r[33m.[39mstatus [33m===[39m [34m429[39m)[33m;[39m
    [90m 52| [39m      [34mexpect[39m(rateLimited)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m 53| [39m    })[33m;[39m
    [90m 54| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[242/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould successfully transcribe an audio file
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m156:29[22m[39m
    [90m154| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m155| [39m
    [90m156| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m157| [39m    [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m158| [39m    [34mexpect[39m(data[33m.[39mtranscript)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[243/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould reject non-audio/video files
[31m[1mAssertionError[22m: expected 500 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m191:29[22m[39m
    [90m189| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m190| [39m
    [90m191| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m192| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'Cannot transcribe'[39m)[33m;[39m
    [90m193| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[244/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould handle already transcribed files
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m226:29[22m[39m
    [90m224| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m225| [39m
    [90m226| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m227| [39m    [34mexpect[39m(data[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Already transcribed'[39m)[33m;[39m
    [90m228| [39m    [34mexpect[39m(mockCreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[245/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould handle OpenAI API errors gracefully
[31m[1mAssertionError[22m: expected 400 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m254:29[22m[39m
    [90m252| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m253| [39m
    [90m254| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m255| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'Transcription failed'[39m)[33m;[39m
    [90m256| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[246/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould enforce workspace isolation
[31m[1mAssertionError[22m: expected 500 to be 404 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 404[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m300:29[22m[39m
    [90m298| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m299| [39m
    [90m300| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m301| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'access denied'[39m)[33m;[39m
    [90m302| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[247/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mPOST /api/media/transcribe[2m > [22mshould log to audit trail on success
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m321:29[22m[39m
    [90m319| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [33mPOST[39m(mockRequest [35mas[39m [33mNextRequest[39m)[33m;[39m
    [90m320| [39m
    [90m321| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m322| [39m    [34mexpect[39m(mockSupabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'auditLogs'[39m)[33m;[39m
    [90m323| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[248/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mGET /api/media/transcribe[2m > [22mshould retrieve existing transcription
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m378:29[22m[39m
    [90m376| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m377| [39m
    [90m378| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m379| [39m    [34mexpect[39m(data[33m.[39mtranscript)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m380| [39m    [34mexpect[39m(data[33m.[39mtranscript[33m.[39mfull_text)[33m.[39m[34mtoBe[39m([32m'Test transcription'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[249/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/transcribe.test.ts[2m > [22mGET /api/media/transcribe[2m > [22mshould return 404 if transcription not found
[31m[1mAssertionError[22m: expected 500 to be 404 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 404[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/transcribe.test.ts:[2m412:29[22m[39m
    [90m410| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m411| [39m
    [90m412| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m413| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'not yet completed'[39m)[33m;[39m
    [90m414| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[250/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould successfully upload a video file
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m118:29[22m[39m
    [90m116| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m117| [39m
    [90m118| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m119| [39m    [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m120| [39m    [34mexpect[39m(data[33m.[39mmedia)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[251/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould enforce workspace access
[31m[1mAssertionError[22m: expected 500 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m219:29[22m[39m
    [90m217| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m218| [39m
    [90m219| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m220| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m221| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[252/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould rollback storage upload on database error
[31m[1mAssertionError[22m: expected 'Internal server error' to contain 'database'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- database[39m
[31m+ Internal server error[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m262:24[22m[39m
    [90m260| [39m
    [90m261| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m262| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'database'[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m263| [39m    [34mexpect[39m(mockRemove)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m [90m// Verify rollback[39m
    [90m264| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[253/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mPOST /api/media/upload[2m > [22mshould accept valid tags
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m286:29[22m[39m
    [90m284| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m285| [39m
    [90m286| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m287| [39m    [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m288| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[254/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould list all media files for workspace
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m350:29[22m[39m
    [90m348| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m349| [39m
    [90m350| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m351| [39m    [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m352| [39m    [34mexpect[39m(data[33m.[39mmedia_files)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[255/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould filter by file type
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m367:29[22m[39m
    [90m365| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m366| [39m
    [90m367| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m368| [39m    [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m369| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[256/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould require workspace_id parameter
[31m[1mAssertionError[22m: expected 500 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m382:29[22m[39m
    [90m380| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m381| [39m
    [90m382| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m383| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'workspace_id'[39m)[33m;[39m
    [90m384| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[257/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/api/media/upload.test.ts[2m > [22mGET /api/media/upload[2m > [22mshould require authentication
[31m[1mAssertionError[22m: expected 500 to be 401 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 401[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/unit/api/media/upload.test.ts:[2m402:29[22m[39m
    [90m400| [39m    [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m401| [39m
    [90m402| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m401[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m403| [39m    [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'Unauthorized'[39m)[33m;[39m
    [90m404| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[258/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22mimport_client_emails intent[2m > [22mshould classify email import requests
[31m[1mAssertionError[22m: expected 'unknown' to be 'import_client_emails' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- import_client_emails[39m
[31m+ unknown[39m

[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m137:31[22m[39m
    [90m135| [39m      [35mfor[39m ([35mconst[39m prompt [35mof[39m prompts) {
    [90m136| [39m        [35mconst[39m result [33m=[39m [34mclassifyIntent[39m(prompt)[33m;[39m
    [90m137| [39m        [34mexpect[39m(result[33m.[39mintent)[33m.[39m[34mtoBe[39m([32m'import_client_emails'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m138| [39m        [34mexpect[39m(result[33m.[39mconfidence)[33m.[39m[34mtoBeGreaterThan[39m([34m0.3[39m)[33m;[39m
    [90m139| [39m      }

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[259/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22mimport_client_emails intent[2m > [22mshould classify email sync requests
[31m[1mAssertionError[22m: expected 'unknown' to be 'import_client_emails' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- import_client_emails[39m
[31m+ unknown[39m

[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m152:31[22m[39m
    [90m150| [39m      [35mfor[39m ([35mconst[39m prompt [35mof[39m prompts) {
    [90m151| [39m        [35mconst[39m result [33m=[39m [34mclassifyIntent[39m(prompt)[33m;[39m
    [90m152| [39m        [34mexpect[39m(result[33m.[39mintent)[33m.[39m[34mtoBe[39m([32m'import_client_emails'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m153| [39m      }
    [90m154| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[260/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22msummarise_client_ideas intent[2m > [22mshould classify idea summary requests
[31m[1mAssertionError[22m: expected 'unknown' to be 'summarise_client_ideas' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- summarise_client_ideas[39m
[31m+ unknown[39m

[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m169:31[22m[39m
    [90m167| [39m      [35mfor[39m ([35mconst[39m prompt [35mof[39m prompts) {
    [90m168| [39m        [35mconst[39m result [33m=[39m [34mclassifyIntent[39m(prompt)[33m;[39m
    [90m169| [39m        [34mexpect[39m(result[33m.[39mintent)[33m.[39m[34mtoBe[39m([32m'summarise_client_ideas'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m170| [39m        [34mexpect[39m(result[33m.[39mconfidence)[33m.[39m[34mtoBeGreaterThan[39m([34m0.3[39m)[33m;[39m
    [90m171| [39m      }

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[261/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Classification[2m > [22msummarise_client_ideas intent[2m > [22mshould classify intelligence requests
[31m[1mAssertionError[22m: expected 'import_client_emails' to be 'summarise_client_ideas' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- summarise_client_ideas[39m
[31m+ import_client_emails[39m

[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m183:31[22m[39m
    [90m181| [39m      [35mfor[39m ([35mconst[39m prompt [35mof[39m prompts) {
    [90m182| [39m        [35mconst[39m result [33m=[39m [34mclassifyIntent[39m(prompt)[33m;[39m
    [90m183| [39m        [34mexpect[39m(result[33m.[39mintent)[33m.[39m[34mtoBe[39m([32m'summarise_client_ideas'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m184| [39m      }
    [90m185| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[262/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22mimport_client_emails plan[2m > [22mshould generate correct plan for import_client_emails
[31m[1mAssertionError[22m: expected 'unknown' to be 'import_client_emails' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- import_client_emails[39m
[31m+ unknown[39m

[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m249:27[22m[39m
    [90m247| [39m      [35mconst[39m plan [33m=[39m [35mawait[39m [34mgeneratePlan[39m(request)[33m;[39m
    [90m248| [39m
    [90m249| [39m      [34mexpect[39m(plan[33m.[39mintent)[33m.[39m[34mtoBe[39m([32m'import_client_emails'[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m250| [39m      [34mexpect[39m(plan[33m.[39msteps)[33m.[39m[34mtoHaveLength[39m([34m4[39m)[33m;[39m
    [90m251| [39m      [34mexpect[39m(plan[33m.[39msteps[[34m0[39m][33m.[39maction)[33m.[39m[34mtoBe[39m([32m'validate_connection'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[263/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22mimport_client_emails plan[2m > [22mshould have sequential dependencies
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'dependsOn')[39m
[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m266:28[22m[39m
    [90m264| [39m
    [90m265| [39m      [34mexpect[39m(plan[33m.[39msteps[[34m0[39m][33m.[39mdependsOn)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
    [90m266| [39m      [34mexpect[39m(plan[33m.[39msteps[[34m1[39m][33m.[39mdependsOn)[33m.[39m[34mtoEqual[39m([[34m0[39m])[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m267| [39m      [34mexpect[39m(plan[33m.[39msteps[[34m2[39m][33m.[39mdependsOn)[33m.[39m[34mtoEqual[39m([[34m1[39m])[33m;[39m
    [90m268| [39m      [34mexpect[39m(plan[33m.[39msteps[[34m3[39m][33m.[39mdependsOn)[33m.[39m[34mtoEqual[39m([[34m2[39m])[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[264/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22msummarise_client_ideas plan[2m > [22mshould generate correct plan for summarise_client_ideas
[31m[1mAssertionError[22m: expected 'unknown' to be 'summarise_client_ideas' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- summarise_client_ideas[39m
[31m+ unknown[39m

[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m282:27[22m[39m
    [90m280| [39m      [35mconst[39m plan [33m=[39m [35mawait[39m [34mgeneratePlan[39m(request)[33m;[39m
    [90m281| [39m
    [90m282| [39m      [34mexpect[39m(plan[33m.[39mintent)[33m.[39m[34mtoBe[39m([32m'summarise_client_ideas'[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m283| [39m      [34mexpect[39m(plan[33m.[39msteps)[33m.[39m[34mtoHaveLength[39m([34m3[39m)[33m;[39m
    [90m284| [39m      [34mexpect[39m(plan[33m.[39msteps[[34m0[39m][33m.[39maction)[33m.[39m[34mtoBe[39m([32m'fetch_client_data'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[265/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22msummarise_client_ideas plan[2m > [22mshould include clientId in inputs
[31m[1mAssertionError[22m: expected { Object (prompt) } to have property "clientId" with value 'contact-789'[39m

[32m- Expected:[39m 
"contact-789"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m299:36[22m[39m
    [90m297| [39m      [35mconst[39m plan [33m=[39m [35mawait[39m [34mgeneratePlan[39m(request)[33m;[39m
    [90m298| [39m
    [90m299| [39m      [34mexpect[39m(plan[33m.[39msteps[[34m0[39m][33m.[39minputs)[33m.[39m[34mtoHaveProperty[39m([32m'clientId'[39m[33m,[39m clientIdâ€¦
    [90m   | [39m                                   [31m^[39m
    [90m300| [39m    })[33m;[39m
    [90m301| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[266/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/agents/orchestrator-email-intents.test.ts[2m > [22mEmail Intent Plan Generation[2m > [22mestimated tokens[2m > [22mshould estimate tokens based on step count
[31m[1mAssertionError[22m: expected 2000 to be greater than 6000[39m
[36m [2mâ¯[22m tests/unit/lib/agents/orchestrator-email-intents.test.ts:[2m316:42[22m[39m
    [90m314| [39m
    [90m315| [39m      [90m// Import has more steps, should have higher estimate[39m
    [90m316| [39m      [34mexpect[39m(importPlan[33m.[39mestimatedTokens)[33m.[39m[34mtoBeGreaterThan[39m(
    [90m   | [39m                                         [31m^[39m
    [90m317| [39m        connectPlan[33m.[39mestimatedTokens
    [90m318| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[267/327]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/lib/email-ingestion/emailIdeaExtractor.test.ts[2m > [22mEmailIdeaExtractor[2m > [22mextractIdeas[2m > [22mshould include processing time in result
[31m[1mAssertionError[22m: expected 0 to be greater than 0[39m
[36m [2mâ¯[22m tests/unit/lib/email-ingestion/emailIdeaExtractor.test.ts:[2m282:39[22m[39m
    [90m280| [39m      [35mconst[39m result [33m=[39m [35mawait[39m extractor[33m.[39m[34mextractIdeas[39m(mockEmail)[33m;[39m
    [90m281| [39m
    [90m282| [39m      [34mexpect[39m(result[33m.[39mprocessingTimeMs)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m   | [39m                                      [31m^[39m
    [90m283| [39m      [34mexpect[39m([35mtypeof[39m result[33m.[39mprocessingTimeMs)[33m.[39m[34mtoBe[39m([32m'number'[39m)[33m;[39m
    [90m284| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[268/327]âŽ¯[22m[39m

[2m Test Files [22m [1m[31m44 failed[39m[22m[2m | [22m[1m[32m89 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (134)[39m
[2m      Tests [22m [1m[31m326 failed[39m[22m[2m | [22m[1m[32m2712 passed[39m[22m[2m | [22m[33m9 skipped[39m[90m (3047)[39m
[2m   Start at [22m 14:35:48
[2m   Duration [22m 51.65s[2m (transform 21.28s, setup 32.32s, collect 33.78s, tests 89.33s, environment 10.66s, prepare 29.88s)[22m

