# Component Marketplace Implementation Plan

**Project**: Component Marketplace/Inspiration Library for Unite-Hub & Synthex
**Status**: PLANNING PHASE (awaiting user approval)
**Date**: 2025-12-02
**Coordination**: Snake Pattern + Plan Mode

---

## Executive Summary

Building a **curated component marketplace** that keeps clients engaged while providing professional-grade UI options.

### What This Enables

- **For Site Builders** (your team): Code export, Autopilot integration, variant generation
- **For Site Owners** (clients): Visual browsing, one-click integration, brand color customization
- **For Your Business**: Stickiness driver, data insights into component preferences

### Why This Works

- Leverages 5 existing marketplace patterns already in Unite-Hub codebase
- Uses proven Next.js API patterns, RLS isolation, Supabase multi-tenancy
- Integrates with existing dashboard architecture (minimal disruption)
- Follows established frontend component patterns (shadcn/ui)

---

## Architecture Overview

### System Components

```
┌──────────────────────────────────────────────────┐
│      Component Marketplace System                │
├──────────────────────────────────────────────────┤
│                                                  │
│  Frontend Layer                                  │
│  ├─ Browse Page (/dashboard/marketplace)       │
│  ├─ Component Card + Preview Modal             │
│  ├─ Search + Filter System                     │
│  └─ Favorites/Collections Sidebar              │
│           ↓                                      │
│  API Layer (/api/marketplace/*)                │
│  ├─ GET /list (paginated, filtered)           │
│  ├─ GET /search (debounced query)             │
│  ├─ GET /[id] (single component detail)       │
│  ├─ POST /[id]/favorite (toggle favorite)     │
│  ├─ GET /[id]/export-code (React + Tail)     │
│  └─ GET /collections (grouped by theme)       │
│           ↓                                      │
│  Database Layer (Supabase PostgreSQL)          │
│  ├─ marketplace_components (main table)        │
│  ├─ component_variants (dark/light/mobile)    │
│  ├─ component_collections (themed sets)       │
│  ├─ component_favorites (user bookmarks)      │
│  └─ component_metrics (usage/ratings)         │
│                                                  │
└──────────────────────────────────────────────────┘
```

### Integration Points

**Existing Patterns Being Adapted**:

1. Template Library (TemplateLibrary.tsx) → Component Grid
2. Marketplace Client (marketplaceClient.ts) → Component API Client
3. Video Demo Grid (filtering/search) → Component Browser
4. RLS Helper Functions → Workspace isolation for marketplace
5. Pagination + API helpers → List/search endpoints

---

## Implementation Roadmap

### Phase 1: Foundation (Database + APIs)

**Estimated**: 2-3 hours
**Deliverables**: Database schema + 5 API routes

**Tasks**:

1. Create migration for 5 database tables
   - `marketplace_components` (main library)
   - `component_variants` (dark/light/mobile variants)
   - `component_collections` (curated themed sets)
   - `component_favorites` (user bookmarks)
   - `component_metrics` (usage stats)

2. Write RLS policies (workspace isolation)
   - SELECT: All authenticated users in workspace can view
   - INSERT/UPDATE/DELETE: Admins only (curator role)
   - Favorites: Personal records scoped to user

3. Create API routes
   - `GET /api/marketplace/list` (paginated, filtered)
   - `GET /api/marketplace/search` (keyword search)
   - `GET /api/marketplace/[id]` (single component)
   - `POST /api/marketplace/[id]/favorite` (toggle)
   - `GET /api/marketplace/collections` (themed groups)

4. Seed initial component data
   - 20-30 template components from research
   - 3-5 curated collections ("Minimalist", "SaaS", etc.)

### Phase 2: Frontend UI

**Estimated**: 2-3 hours
**Deliverables**: Dashboard page + 4 reusable components

**Tasks**:

1. Create `/dashboard/marketplace` page (container)
   - State management (search, filters, pagination)
   - Data fetching logic
   - Error handling

2. Build ComponentGrid.tsx
   - Animated grid with Framer Motion
   - Responsive 2-3 column layout
   - Empty state handling

3. Build ComponentCard.tsx
   - Thumbnail + metadata display
   - Favorite toggle button
   - "Preview" button → opens modal
   - "Export Code" dropdown

4. Build ComponentFilters.tsx
   - Category filter (buttons)
   - Style filter (pills)
   - Sort options (newest, popular, rating)
   - Clear filters button

5. Build ComponentSearch.tsx
   - Debounced search (300ms)
   - Clear button
   - Character count display

6. Build ComponentPreview.tsx
   - Modal with live component preview
   - Color customizer (brand colors)
   - Code display tab
   - "Add to Site" button for clients
   - "Copy Code" for builders

### Phase 3: Advanced Features (Post-Launch)

**Estimated**: 2-4 hours
**Deliverables**: Code export + AI variant generation

**Tasks**:

1. Code export system
   - React component (TSX) copy
   - Tailwind CSS classes extraction
   - NPM import statements
   - Storybook story export

2. AI variant generation
   - Claude generates dark mode variant
   - Mobile-responsive variant
   - RTL variant (if needed)
   - Custom theme variant

3. Component ratings system
   - 5-star rating
   - Written reviews
   - "Helpful" counter

4. Usage analytics
   - Track component views
   - Track exports
   - Track "add to site" clicks
   - Show trending components

---

## Database Schema (Complete)

### Table 1: marketplace_components

```sql
CREATE TABLE marketplace_components (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  workspace_id UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,

  -- Metadata
  name TEXT NOT NULL,
  description TEXT,
  category TEXT NOT NULL CHECK (category IN (
    'header', 'hero', 'card', 'form', 'footer', 'navigation',
    'button', 'modal', 'sidebar', 'table', 'timeline', 'other'
  )),
  style_tag TEXT NOT NULL CHECK (style_tag IN (
    'minimalist', 'colorful', 'dark', 'glassmorphic', 'brutalist',
    'neumorphic', 'retro', 'modern', 'playful', 'corporate'
  )),

  -- Component Code
  component_code TEXT NOT NULL,
  tailwind_classes TEXT,
  html_preview TEXT,
  dependencies JSONB DEFAULT '[]'::jsonb,

  -- Variants
  has_dark_mode BOOLEAN DEFAULT false,
  has_mobile_variant BOOLEAN DEFAULT false,
  has_custom_variants BOOLEAN DEFAULT false,

  -- Metadata
  is_featured BOOLEAN DEFAULT false,
  accessibility_score INT CHECK (accessibility_score >= 0 AND accessibility_score <= 100),
  performance_score INT CHECK (performance_score >= 0 AND performance_score <= 100),

  -- Stats
  view_count INT DEFAULT 0,
  export_count INT DEFAULT 0,
  favorite_count INT DEFAULT 0,
  rating NUMERIC(3,2) DEFAULT NULL CHECK (rating IS NULL OR (rating >= 0 AND rating <= 5)),
  rating_count INT DEFAULT 0,

  -- Tracking
  created_by UUID NOT NULL REFERENCES auth.users(id) ON DELETE SET NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

  UNIQUE(workspace_id, name)
);

CREATE INDEX idx_marketplace_components_workspace ON marketplace_components(workspace_id);
CREATE INDEX idx_marketplace_components_category ON marketplace_components(category);
CREATE INDEX idx_marketplace_components_style ON marketplace_components(style_tag);
CREATE INDEX idx_marketplace_components_featured ON marketplace_components(is_featured);
CREATE INDEX idx_marketplace_components_rating ON marketplace_components(rating DESC);
```

### Table 2: component_variants

```sql
CREATE TABLE component_variants (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  component_id UUID NOT NULL REFERENCES marketplace_components(id) ON DELETE CASCADE,
  workspace_id UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,

  name TEXT NOT NULL,
  variant_type TEXT NOT NULL CHECK (variant_type IN (
    'dark_mode', 'light_mode', 'mobile', 'tablet', 'rtl', 'compact', 'expanded', 'custom'
  )),

  component_code TEXT NOT NULL,
  html_preview TEXT,
  changes JSONB,

  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

  UNIQUE(component_id, variant_type)
);

CREATE INDEX idx_component_variants_component ON component_variants(component_id);
```

### Table 3: component_collections

```sql
CREATE TABLE component_collections (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  workspace_id UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,

  name TEXT NOT NULL,
  description TEXT,
  theme_color TEXT,

  component_ids UUID[] DEFAULT ARRAY[]::UUID[],

  is_featured BOOLEAN DEFAULT false,
  order_index INT,

  view_count INT DEFAULT 0,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

  UNIQUE(workspace_id, name)
);

CREATE INDEX idx_component_collections_workspace ON component_collections(workspace_id);
CREATE INDEX idx_component_collections_featured ON component_collections(is_featured);
```

### Table 4: component_favorites

```sql
CREATE TABLE component_favorites (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  workspace_id UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  component_id UUID NOT NULL REFERENCES marketplace_components(id) ON DELETE CASCADE,

  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

  UNIQUE(workspace_id, user_id, component_id)
);

CREATE INDEX idx_component_favorites_user ON component_favorites(user_id);
CREATE INDEX idx_component_favorites_component ON component_favorites(component_id);
```

### Table 5: component_metrics

```sql
CREATE TABLE component_metrics (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  component_id UUID NOT NULL REFERENCES marketplace_components(id) ON DELETE CASCADE,
  workspace_id UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,

  metric_date DATE NOT NULL,
  views_count INT DEFAULT 0,
  exports_count INT DEFAULT 0,
  favorites_count INT DEFAULT 0,
  preview_opens INT DEFAULT 0,

  avg_load_time_ms NUMERIC(6,2),

  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

  UNIQUE(component_id, metric_date)
);

CREATE INDEX idx_component_metrics_component ON component_metrics(component_id);
CREATE INDEX idx_component_metrics_date ON component_metrics(metric_date);
```

### RLS Policies

```sql
-- marketplace_components: Public read (all workspace members), admin write
CREATE POLICY "components_workspace_select" ON marketplace_components
  FOR SELECT USING (
    workspace_id IN (
      SELECT w.id FROM workspaces w
      JOIN user_organizations uo ON uo.org_id = w.org_id
      WHERE uo.user_id = auth.uid() AND uo.is_active = true
    )
  );

CREATE POLICY "components_admin_insert" ON marketplace_components
  FOR INSERT WITH CHECK (
    EXISTS (
      SELECT 1 FROM workspaces w
      JOIN user_organizations uo ON uo.org_id = w.org_id
      WHERE w.id = workspace_id
      AND uo.user_id = auth.uid()
      AND uo.role IN ('owner', 'admin')
      AND uo.is_active = true
    )
  );

-- component_favorites: Users can only manage their own favorites
CREATE POLICY "favorites_user_select" ON component_favorites
  FOR SELECT USING (user_id = auth.uid());

CREATE POLICY "favorites_user_insert" ON component_favorites
  FOR INSERT WITH CHECK (user_id = auth.uid());

CREATE POLICY "favorites_user_delete" ON component_favorites
  FOR DELETE USING (user_id = auth.uid());
```

---

## API Routes (5 Core Endpoints)

### Route 1: GET /api/marketplace/list

**Purpose**: List components with pagination, filtering, sorting
**Query Parameters**:
- `workspaceId` (required, UUID)
- `page` (optional, default: 1)
- `pageSize` (optional, default: 20, max: 100)
- `category` (optional, filter by category)
- `style` (optional, filter by style_tag)
- `sortBy` (optional: newest, popular, rating, alphabetical)
- `showFavorites` (optional: true/false)

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "comp-123",
      "name": "Header Component",
      "category": "header",
      "style_tag": "minimalist",
      "description": "...",
      "is_featured": false,
      "view_count": 150,
      "rating": 4.5,
      "isFavorited": false,
      "has_dark_mode": true
    }
  ],
  "meta": {
    "total": 250,
    "page": 1,
    "pageSize": 20,
    "totalPages": 13
  }
}
```

### Route 2: GET /api/marketplace/search

**Purpose**: Keyword search across components
**Query Parameters**:
- `workspaceId` (required)
- `query` (required, search term)
- `limit` (optional, default: 20)

**Response**: Same as list, but filtered by search term

### Route 3: GET /api/marketplace/[id]

**Purpose**: Get single component with full details
**Response**:
```json
{
  "success": true,
  "data": {
    "id": "comp-123",
    "name": "Hero Section",
    "category": "hero",
    "description": "...",
    "component_code": "<React TSX code>",
    "tailwind_classes": "flex items-center justify-between...",
    "html_preview": "<div>...</div>",
    "dependencies": ["react-icons", "framer-motion"],
    "variants": [
      {
        "id": "var-456",
        "name": "Dark Mode",
        "type": "dark_mode",
        "component_code": "..."
      }
    ],
    "accessibility_score": 95,
    "performance_score": 92,
    "rating": 4.8,
    "view_count": 500,
    "isFavorited": false
  }
}
```

### Route 4: POST /api/marketplace/[id]/favorite

**Purpose**: Toggle favorite status
**Body**: (empty or `{ "action": "add"|"remove" }`)
**Response**:
```json
{
  "success": true,
  "isFavorited": true,
  "favorite_count": 42
}
```

### Route 5: GET /api/marketplace/collections

**Purpose**: Get curated component collections
**Query Parameters**:
- `workspaceId` (required)
- `featured` (optional: true for featured only)

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "coll-123",
      "name": "SaaS Landing",
      "description": "Components for SaaS landing pages",
      "theme_color": "#3B82F6",
      "components": [
        { "id": "comp-1", "name": "Header", "thumbnail": "..." },
        { "id": "comp-2", "name": "Hero", "thumbnail": "..." }
      ],
      "view_count": 250
    }
  ]
}
```

---

## Implementation Approach (Snake Pattern)

### Head (Orchestrator) - What User Sees
```
USER REQUEST: "Build component marketplace"
                    ↓
ORCHESTRATOR (clean message):
"Starting component marketplace implementation.
- Phase 1: Database + APIs (2-3 hrs)
- Phase 2: Dashboard UI (2-3 hrs)
- Phase 3: Advanced features (post-launch)
Proceeding with foundation layer."
```

### Eyes (Truth Layer) - Silent Checks
- ✅ Database schema valid?
- ✅ RLS policies correct?
- ✅ No conflicts with existing tables?
- ✅ Workspace isolation enforced?

### Body (Specialists) - Underground Work
1. **Backend Agent**: Build migrations, RLS policies, API routes
2. **Frontend Agent**: Build dashboard page, components, styling
3. **Test Infrastructure**: Write tests, verify functionality
4. **Build Diagnostics**: Check for TypeScript errors, build issues

### Nervous System (Transparency Reporter) - Logs Everything
```
/logs/marketplace/
├── migration_execution.log
├── api_implementation.log
├── component_tests.log
└── deployment_checklist.log
```

---

## Clarifications Needed (Before Implementation)

### 1. Component Source Strategy

**Question**: Where do the initial 30-50 components come from?

**Options**:

- **A) Research & Template** (2 hours)
  - I research Kokonut, Cult-UI, Style UI patterns
  - Create 20-30 template component scaffolds
  - You fill in actual code from reference sites

- **B) AI Generation** (1 hour)
  - I generate 20-30 components using Claude API
  - Based on design patterns from research
  - You review + customize

- **C) Curated Selection** (3+ hours)
  - You provide list of specific components you want
  - I build them one by one

**Recommendation**: **Option A + B combo**
- I research 5 sites + generate 15 template components
- You curate + enhance with your own code samples

### 2. Feature Priority

**Question**: Which features matter most for launch?

**Option 1**: MVP (core only)
- ✅ Browse + Search + Filter
- ✅ Favorites system
- ✅ Simple preview
- ❌ Code export
- ❌ Variants system

**Option 2**: Core + Export
- ✅ Browse + Search + Filter
- ✅ Favorites
- ✅ Full preview with code display
- ✅ Copy-to-clipboard code
- ❌ Variants
- ❌ AI generation

**Option 3**: Full Launch
- ✅ Everything in Phase 1 + 2
- ✅ Code export + formatting
- ✅ Variant system
- ✅ Usage analytics

**Recommendation**: **Option 2** - provides value immediately, variants can be Phase 2

### 3. Scope: Unite-Hub vs Synthex

**Question**: Is this for both platforms or just one?

**Options**:

- **A) Unite-Hub only** - Curated library for your internal clients
- **B) Synthex only** - Marketplace for end clients building their sites
- **C) Both** - Shared library with workspace-specific customizations

**Recommendation**: **Option C** - Start with Unite-Hub, extend to Synthex Phase 2

---

## Success Metrics

### Phase 1 Success
- [ ] All 5 API routes return correct responses
- [ ] RLS policies prevent unauthorized access
- [ ] Pagination works correctly
- [ ] Search performance < 200ms
- [ ] Database query indexes optimized

### Phase 2 Success
- [ ] Dashboard page loads in < 1 second
- [ ] Components grid responsive (2 col mobile, 3 col desktop)
- [ ] Search debouncing works (no excessive API calls)
- [ ] Favorite toggle works smoothly
- [ ] Preview modal renders code correctly

### Launch Success
- [ ] 30+ components seeded
- [ ] 3+ curated collections
- [ ] Users can favorite + view history
- [ ] Code export produces valid React code
- [ ] No TypeScript errors, all tests pass

---

## Timeline & Effort Estimate

| Phase | Task | Effort | Owner |
|-------|------|--------|-------|
| 1 | Database schema + RLS | 1 hour | Backend Agent |
| 1 | API routes (5 endpoints) | 1.5 hours | Backend Agent |
| 1 | Seed data (30 components) | 1 hour | You (curated) |
| 2 | Dashboard page setup | 0.5 hour | Frontend Agent |
| 2 | ComponentGrid + ComponentCard | 1 hour | Frontend Agent |
| 2 | Search + Filter system | 1 hour | Frontend Agent |
| 2 | Preview modal + code display | 1 hour | Frontend Agent |
| 3 | Tests + documentation | 1.5 hours | Test Agent |
| 3 | Code export system | 1.5 hours | Backend Agent |
| 3 | AI variant generation | 2 hours | Content Agent |
| **TOTAL** | | **~11-13 hours** | **Orchestrator** |

---

## Approved For Implementation?

This plan requires **user approval** before proceeding to implementation.

### Questions to Confirm:

1. **Component Source**: Do you prefer Option A (research templates), B (AI generated), or C (you provide list)?

2. **Feature Priority**: Should we build MVP (browse/search/favorites) or Core+Export (+ code export)?

3. **Timeline**: Is 5-6 hours for MVP acceptable, or should we scope it smaller?

4. **Synthex Integration**: Should this system support multiple platforms (Unite-Hub + Synthex), or just one for now?

5. **Custom Features**: Are there any specific features not mentioned that are critical for your use case?

### Next Steps (Upon Approval):

1. ✅ You approve this plan + clarify 5 questions above
2. ✅ I switch to **Orchestrator Head** (visible only)
3. ✅ Specialists work **underground** (no noise)
4. ✅ You get **single, clean updates** when phases complete
5. ✅ Transparency logs stored separately (no spam)

---

**Ready to proceed?**
